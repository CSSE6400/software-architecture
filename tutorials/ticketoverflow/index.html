Last Updated on 2023/05/17
                                <span class="rotatebox" style="transform: rotate(-25deg);">  Teacher Version </span>                                                 

<?xml version="1.0" encoding="iso-8859-1" ?> 
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">  
<!--http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd-->  
<html xmlns="http://www.w3.org/1999/xhtml"  
> 
<head> <title>TicketOverflow</title> 
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /> 
<meta name="generator" content="TeX4ht (https://tug.org/tex4ht/)" /> 
<meta name="originator" content="TeX4ht (https://tug.org/tex4ht/)" /> 
<!-- fn-in,html,htex4ht,xhtml --> 
<meta name="src" content="main.tex" /> 
<link rel="stylesheet" type="text/css" href="main.css" /> 
<link rel="stylesheet" href="https://latex.now.sh/style.css"> 
<link rel="stylesheet" href="/notes.css"> 
<style>body {max-width: 100ch;} 
dl dd {text-align: left}</style> 
</head><body 
>
   <div class="maketitle"><a 
 id="Q1-1-1"></a>
_________________________________________________________________________________________________
<h2 class="titleHead">TicketOverflow</h2>                                                                               Software Architecture
   <div class="date" >May 4, 2023</div>                                                                                                                                                           <div class="author" >Evan
Hughes</div>
_____________________________________________________________________________________________
   </div>
   <div class="tcolorbox tcolorbox" id="tcolobox-1">    
<div class="tcolorbox-title">
<!--l. 23--><p class="indent" >   Info</p></div> 
<div class="tcolorbox-content"><!--l. 23--><p class="noindent" >For 2023 this tutorial is a presentation and not an activity. Please ignore the timing for each activity.
</p> 
</div> 
</div>
   <h3 class="sectionHead"><span class="titlemark">1    </span> <a 
 id="x1-10001"></a>Brief</h3>
<!--l. 27--><p class="noindent" >Recent controversy has brought attention to the monopoly held by certain ticketing companies. In hopes of an
eventual collapse of the current monopoly, we aim to develop TicketOverflow, an online concert ticket booking
system.
</p>
<!--l. 32--><p class="noindent" ><span class="paragraphHead"><a 
 id="x1-2000"></a><span 
class="Cabin-Bold-tlf-t1-x-x-120">Task</span></span>
   You are working for TicketOverflow, a new competitor in the online ticket booking space. TicketOverflow uses a
microservices based architecture to implement their new platform. The CEO saw on your resume that you took
Software Architecture and has assigned you to design and implement the ticket purchasing service. This service
must be scalable to cope with a large influx of bookings.
</p><!--l. 39--><p class="indent" >   You also need to implement a mock of the users service. This service is being implemented by another team at
TicketOverflow. You need to implement a mock to allow your ticket purchasing service to be tested. Your mock of
this service will use a hard-coded list of users.
</p>
<!--l. 44--><p class="noindent" ><span class="paragraphHead"><a 
 id="x1-3000"></a><span 
class="Cabin-Bold-tlf-t1-x-x-120">Requirements</span></span>
   As you may be aware, ticket booking platforms have intense peaks of traffic. At the scale that TicketOverflow
hopes to operate, it would be inappropriate to run the servers required to meet demand at all times. Thus,
our service must be elastic &#8212; able to scale up to meet demand and able to scale down to preserve
costs.
</p><!--l. 52--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">2    </span> <a 
 id="x1-40002"></a>Outline</h3>
                                                                                                    
                                                                                                    
<!--l. 54--><p class="noindent" >
</p>
   <h4 class="likesubsectionHead"><a 
 id="x1-5000"></a>Introduction (5 minutes)</h4>
<!--l. 55--><p class="noindent" >Introduction to the brief and resources including the API specification and quality scenarios.
</p><!--l. 58--><p class="noindent" >
</p>
   <h4 class="likesubsectionHead"><a 
 id="x1-6000"></a>Planning (10 minutes)</h4>
<!--l. 59--><p class="noindent" >In small groups, begin a discussion, the discussion may include:
</p><!--l. 63--><p class="indent" >
      </p><dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
   1. </dt><dd 
class="enumerate-enumitem">What are the key requirements introduced by the quality scenarios?
      </dd><dt class="enumerate-enumitem">
   2. </dt><dd 
class="enumerate-enumitem">What strategies can you implement to support these scenarios?
      </dd><dt class="enumerate-enumitem">
   3. </dt><dd 
class="enumerate-enumitem">What AWS resources would prove helpful?
      </dd><dt class="enumerate-enumitem">
   4. </dt><dd 
class="enumerate-enumitem">What are the likely bottlenecks?</dd></dl>
   <div class="tcolorbox tcolorbox" id="tcolobox-2">    
<div class="tcolorbox-title">
                                                                                                    
                                                                                                    
<!--l. 81--><p class="indent" >   For the teacher</p></div> 
<div class="tcolorbox-content"><h4 class="subsectionHead"><span class="titlemark">2.1    </span> <a 
 id="x1-70002.1"></a>What are the key requirements introduced by the quality scenarios?</h4>
           <ul class="itemize1">
           <li class="itemize">
           <!--l. 81--><p class="noindent" >Q1, Q2, Q3 all introduce load to the system for ticket purchasing
           </p></li>
           <li class="itemize">
           <!--l. 81--><p class="noindent" >Q4 introduces load on the concerts endpoint for every purchase
           </p></li>
           <li class="itemize">
           <!--l. 81--><p class="noindent" >Q5 introduces that we need to handle load on the same endpoint for multiple entries and the
           printing of tickets at scale.
           </p></li>
           <li class="itemize">
           <!--l. 81--><p class="noindent" >Q6 adds priorities to the mix for ticket printing
           </p></li>
           <li class="itemize">
           <!--l. 81--><p class="noindent" >Q7 adds the need to cancel / alter async process that are in flight
           </p></li>
           <li class="itemize">
           <!--l. 81--><p class="noindent" >Q8 introduces a large amount of load thats expected to push the system to the limit, so I
           should expect to crash and have to recover.
           </p></li>
           <li class="itemize">
           <!--l. 81--><p class="noindent" >API specifies that concert seating must be updated within 3 minutes.</p></li></ul>
 
</div> 
</div>
<div class="tcolorbox tcolorbox" id="tcolobox-3">    
<div class="tcolorbox-title">
<!--l. 84--><p class="indent" >   For the teacher</p></div> 
<div class="tcolorbox-content"><h4 class="subsectionHead"><span class="titlemark">2.2    </span> <a 
 id="x1-80002.2"></a>What strategies can you implement to support these scenarios?</h4>
 
</div> 
</div>
<div class="tcolorbox tcolorbox" id="tcolobox-4">    
<div class="tcolorbox-title">
<!--l. 90--><p class="indent" >   For the teacher</p></div> 
<div class="tcolorbox-content"><!--l. 90--><p class="noindent" ><span class="paragraphHead"><a 
 id="x1-9000"></a><span 
class="Cabin-Bold-tlf-t1-x-x-120">Ticket Rendering</span></span>
Looking at the hamilton documentation we have been given the expected runtime and memory usage to
create an individual ticket. We can see that the process is CPU intensive and small on memory and takes a
few seconds. We could possibly get away with running this sequently but with the CPU required we may
want to offload.
</p><!--l. 90--><p class="noindent" ><span id="textcolor1"><span 
class="Cabin-Bold-tlf-t1-x-x-120">+ Queue Ticket Rendering to offload processing</span></span>  </p> 
</div> 
</div>
<div class="tcolorbox tcolorbox" id="tcolobox-5">    
<div class="tcolorbox-title">
                                                                                                    
                                                                                                    
<!--l. 101--><p class="indent" >   For the teacher</p></div> 
<div class="tcolorbox-content"><!--l. 101--><p class="noindent" ><span class="paragraphHead"><a 
 id="x1-10000"></a><span 
class="Cabin-Bold-tlf-t1-x-x-120">Ticket Priority</span></span>
Given the scenarios we can see that there is a significant amount of time between the two concerts so we
could apply more novel approaches to the problem.
</p>
           <ul class="itemize1">
           <li class="itemize">
           <!--l. 101--><p class="noindent" >Create buckets of priority and assign jobs based on the concert time compared to todays date.
           <img 
src="images/bucket-queue.png" alt="PIC"  
width="360" height="360"  />
           </p></li>
           <li class="itemize">
           <!--l. 101--><p class="noindent" >Stage queued jobs into a table where a queue manager selectivly pulls jobs from the table
           based on priority. <span id="textcolor2">The queue manager would keep the queue fed with a small amount of jobs
           such that it is just enough for the workers.</span> <img 
src="images/staging-queue.png" alt="PIC"  
width="360" height="360"  /></p></li></ul>
<!--l. 101--><p class="noindent" ><span id="textcolor3"><span 
class="Cabin-Bold-tlf-t1-x-x-120">+ Buckets for priority due to simplicity but the staging table is more versatile</span></span>  </p> 
</div> 
</div>
<div class="tcolorbox tcolorbox" id="tcolobox-6">    
<div class="tcolorbox-title">
<!--l. 116--><p class="indent" >   For the teacher</p></div> 
<div class="tcolorbox-content"><!--l. 116--><p class="noindent" ><span class="paragraphHead"><a 
 id="x1-11000"></a><span 
class="Cabin-Bold-tlf-t1-x-x-120">Seating Rendering</span></span>
As above we see that seating requires more time due to CPU load but is relativly the same. We must
proactivly render the seating to ensure that we can meet the 3 minute requirement. Some stratergies for
this:
</p>
           <ul class="itemize1">
           <li class="itemize">
           <!--l. 116--><p class="noindent" >Render with every ticket purchase. <span id="textcolor4">Means we cant render tickets in parallel if they also render
           the seating.</span>
           </p></li>
           <li class="itemize">
           <!--l. 116--><p class="noindent" >Queue a render for every purchase.
           </p></li>
           <li class="itemize">
           <!--l. 116--><p class="noindent" >Queue on an exclusive queue for every purchase. <span id="textcolor5">A queue that only allows 1 of every ID to be
           in the queue at a time.</span>
           </p></li>
           <li class="itemize">
           <!--l. 116--><p class="noindent" >Cron to render seating every minute if there are more tickets than last render.</p></li></ul>
<!--l. 116--><p class="noindent" >The exclusive queue design would allow for seating to be updated as fast as possible while also reducing
the resources required in large loads. On the other hand the cron job is a elegant design in simplicity while
also meeting the expectations of the users.
</p><!--l. 116--><p class="noindent" ><span id="textcolor6"><span 
class="Cabin-Bold-tlf-t1-x-x-120">+ Cron to queue rendering of seating</span></span>  </p> 
</div> 
</div>
<div class="tcolorbox tcolorbox" id="tcolobox-7">    
<div class="tcolorbox-title">
                                                                                                    
                                                                                                    
<!--l. 125--><p class="indent" >   For the teacher</p></div> 
<div class="tcolorbox-content"><!--l. 125--><p class="noindent" ><span class="paragraphHead"><a 
 id="x1-12000"></a><span 
class="Cabin-Bold-tlf-t1-x-x-120">Printing Invalidation</span></span>
Depending on your queue implementation you may be able to cancel jobs that are in fly. Optionally by
resetting the ticket status when our render job gets processed it can skip the printing step. To avoid race
conditions we can use a lock on the concert when changes are being processed.
</p><!--l. 125--><p class="noindent" >Other methods could be storing a version of a concert and when printing we also get the version of the
concert. When requesting a printed ticket we can check the versions and if they do not match then we can
invalidate the ticket.
</p><!--l. 125--><p class="noindent" ><span id="textcolor7"><span 
class="Cabin-Bold-tlf-t1-x-x-120">+ Check ticket status during printing</span></span>  </p> 
</div> 
</div>
<div class="tcolorbox tcolorbox" id="tcolobox-8">    
<div class="tcolorbox-title">
<!--l. 138--><p class="indent" >   For the teacher</p></div> 
<div class="tcolorbox-content"><!--l. 138--><p class="noindent" ><span class="paragraphHead"><a 
 id="x1-13000"></a><span 
class="Cabin-Bold-tlf-t1-x-x-120">Ticket Purchasing</span></span>
Purchasing a ticket requires making sure that we have not oversold the concert.
</p>
           <ul class="itemize1">
           <li class="itemize">
           <!--l. 138--><p class="noindent" >Count all tickets before selling a new one. <span id="textcolor8">This can potentially allow overselling if two requests
           are made at the same time.</span>
           </p></li>
           <li class="itemize">
           <!--l. 138--><p class="noindent" >Lock the concert when selling a ticket. <span id="textcolor9">This would cause a bottleneck on the concert endpoint.</span>
           </p></li>
           <li class="itemize">
           <!--l. 138--><p class="noindent" >Use a atomic counter to count the tickets for each concert.
           </p></li>
           <li class="itemize">
           <!--l. 138--><p class="noindent" >Use multiple atomic counters to distribute waiting for a lock. <span id="textcolor10">By splitting the counters into
           buckets of tickets we can allow the client to random select a bucket which may have tickets
           available.</span></p></li></ul>
<!--l. 138--><p class="noindent" ><span id="textcolor11"><span 
class="Cabin-Bold-tlf-t1-x-x-120">+ Use one or more atomic counters to count tickets</span></span>  </p> 
</div> 
</div>
   <div class="tcolorbox tcolorbox" id="tcolobox-9">    
<div class="tcolorbox-title">
                                                                                                    
                                                                                                    
<!--l. 153--><p class="indent" >   For the teacher</p></div> 
<div class="tcolorbox-content"><h4 class="subsectionHead"><span class="titlemark">2.3    </span> <a 
 id="x1-140002.3"></a>What AWS resources would prove helpful?</h4>
           <ul class="itemize1">
           <li class="itemize">
           <!--l. 153--><p class="noindent" >Lambda for compute
           </p></li>
           <li class="itemize">
           <!--l. 153--><p class="noindent" >ECS for compute
           </p></li>
           <li class="itemize">
           <!--l. 153--><p class="noindent" >EC2 for compute
           </p></li>
           <li class="itemize">
           <!--l. 153--><p class="noindent" >DynamoDB for querying/caching/locking
           </p></li>
           <li class="itemize">
           <!--l. 153--><p class="noindent" >RDS for querying
           </p></li>
           <li class="itemize">
           <!--l. 153--><p class="noindent" >Redis for caching/locking/queueing
           </p></li>
           <li class="itemize">
           <!--l. 153--><p class="noindent" >S3 for storage
           </p></li>
           <li class="itemize">
           <!--l. 153--><p class="noindent" >SQS for queueing</p></li></ul>
 
</div> 
</div>
   <div class="tcolorbox tcolorbox" id="tcolobox-10">    
<div class="tcolorbox-title">
<!--l. 159--><p class="indent" >   For the teacher</p></div> 
<div class="tcolorbox-content"><h4 class="subsectionHead"><span class="titlemark">2.4    </span> <a 
 id="x1-150002.4"></a>What are the likely bottlenecks?</h4>
<!--l. 159--><p class="noindent" >Ticket purchasing is the most likely bottleneck due to the atomic counters needed.  </p> 
</div> 
</div>
<!--l. 161--><p class="noindent" >
</p>
   <h4 class="likesubsectionHead"><a 
 id="x1-16000"></a>Design (20 minutes)</h4>
<!--l. 163--><p class="noindent" >In your group, design an appropriate system. You need to consider the flow of an API request through your
system, use the API specification to ensure all use cases have been considered.
</p>
   <div class="tcolorbox tcolorbox" id="tcolobox-11">    
<div class="tcolorbox-title">
<!--l. 169--><p class="indent" >   For the teacher</p></div> 
<div class="tcolorbox-content"><!--l. 169--><p class="noindent" ><img 
src="resources/ticketoverflow.png" alt="PIC"  
width="493" height="494"  />  </p> 
</div> 
</div>
                                                                                                    
                                                                                                    
<!--l. 171--><p class="noindent" >
</p>
   <h4 class="likesubsectionHead"><a 
 id="x1-17000"></a>Presentation (15 minutes)</h4>
<!--l. 173--><p class="noindent" >In the remaining time, each group should present their proposed design. This is an opportunity for discussion
amoungst the class to point out limitations of the proposed system designs.
</p><!--l. 177--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">3    </span> <a 
 id="x1-180003"></a>Quality Scenarios</h3>
<!--l. 179--><p class="noindent" ><span class="paragraphHead"><a 
 id="x1-19000"></a><span 
class="Cabin-Bold-tlf-t1-x-x-120">Q1: Small concert</span></span>
   As TicketOverflow is starting out, it will need to scale to the size of a small concert. Playhouse at QPAC is one
of the first venues to sign up for the service. Their customers purchase tickets in advance over a longer period of
time.
</p>
<!--l. 185--><p class="noindent" ><span class="paragraphHead"><a 
 id="x1-20000"></a><span 
class="Cabin-Bold-tlf-t1-x-x-120">Q2: Pre-sale for Hamilton</span></span>
   Hamilton is now showing at the Lyric Theatre at QPAC and the pre-sale tickets are released for a limited time.
The tickets are in high demand, and there are a large number of customers trying to purchase tickets at the same
time.
</p>
<!--l. 189--><p class="noindent" ><span class="paragraphHead"><a 
 id="x1-21000"></a><span 
class="Cabin-Bold-tlf-t1-x-x-120">Q3: General sale for Hamilton</span></span>
   The general sale for Hamilton has started, and there is a surge of customers trying to purchase
tickets at the same time. This leads to a high traffic volume on the website, which puts a strain on
TicketOverflow.
</p>
<!--l. 193--><p class="noindent" ><span class="paragraphHead"><a 
 id="x1-22000"></a><span 
class="Cabin-Bold-tlf-t1-x-x-120">Q4: Seating plan launch</span></span>
   The frontend team at TicketOverflow have developed a new ticket purchasing interface that shows users the
seating plan before they purchase. A large concert is being used to trial this new feature. You need to ensure
that the rendering of the seating plan does not interfere with the high volume of associated ticket
purchases.
</p>
<!--l. 198--><p class="noindent" ><span class="paragraphHead"><a 
 id="x1-23000"></a><span 
class="Cabin-Bold-tlf-t1-x-x-120">Q5: Evening shows at QPAC</span></span>
   All QPAC venues are now supported in TicketOverflow. Each evening there are multiple concerts that run
concurrently. TicketOverflow must be able to handle a steady stream of parallel purchases, ticket generation, and
seating plan generation.
                                                                                                    
                                                                                                    
</p>
<!--l. 203--><p class="noindent" ><span class="paragraphHead"><a 
 id="x1-24000"></a><span 
class="Cabin-Bold-tlf-t1-x-x-120">Q6: Priority tickets</span></span>
   Tickets recently went on sale for a large concert in four months time. Some of the ticket purchasers are
downloading their tickets in advance. Meanwhile an evening show for a smaller concert is starting in a few
minutes. The evening show attendees should be able to download their tickets without being impacted by the
later concert.
</p>
<!--l. 209--><p class="noindent" ><span class="paragraphHead"><a 
 id="x1-25000"></a><span 
class="Cabin-Bold-tlf-t1-x-x-120">Q7: Copyright infringement</span></span>
   Due to a copyright notice, &#8220;Elsa on Ice&#8221;, has to be renamed to &#8220;Bob on Ice&#8221;. Unfortunately, this is a last minute
name change while many users are logging in to generate their tickets. Your system must ensure that they are not
shown incorrect tickets and gracefully handles re-generation of tickets.
</p><!--l. 214--><p class="indent" >   You are not required to queue up re-printing all the tickets that have already been printed.
As indicated in the API specification for the update concert endpoint (<a 
href="https://csse6400.uqcloud.net/assessment/ticketoverflow/#api-Concert-be" ><span 
class="ectt-1200">/concerts/id</span>
<span 
class="ectt-1200">PUT</span></a><span class="footnote-mark"><a 
href="#fn1x0" id="fn1x0-bk"><sup class="textsuperscript">1</sup></a></span><a 
 id="x1-25001f1"></a>),
&#8220;any existing tickets that have been generated need to be removed.&#8221; This means that, for the concert which is
updated, all tickets that have a <span 
class="ectt-1200">PRINTED </span>status must have that status changed to <span 
class="ectt-1200">NOT_PRINTED</span>. You need to
ensure that tickets with a <span 
class="ectt-1200">PENDING </span>status cannot print tickets with outdated information. It is the client&#8217;s
responsibility to determine that the ticket status has changed and to re-print the ticket. Your system has to
manage the load.
</p>
<!--l. 224--><p class="noindent" ><span class="paragraphHead"><a 
 id="x1-26000"></a><span 
class="Cabin-Bold-tlf-t1-x-x-120">Q8: Taylor Swift tour</span></span>
   Taylor Swift has chosen TicketOverflow for the release of her Eras Tour. It is estimated that there will be about
2.8 million purchases during this time. Your service should do its best to remain responsive during the launch of
the tour.
</p>
   <div class="footnotes"><a 
 id="x1-25002x"></a>
<!--l. 216--><p class="indent" >       <span class="footnote-mark"><a 
href="#fn1x0-bk" id="fn1x0"><sup class="textsuperscript">1</sup></a></span><a 
href="https://csse6400.uqcloud.net/assessment/ticketoverflow/\#api-Concert-be" class="url" ><span 
class="ectt-1000">https://csse6400.uqcloud.net/assessment/ticketoverflow/\#api-Concert-be</span></a></p>                    </div>
 
</body></html> 

                                                                                                    


