Last Updated on 2025/03/28
                                                                                                    

<?xml version="1.0" encoding="iso-8859-1" ?> 
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">  
<!--http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd-->  
<html xmlns="http://www.w3.org/1999/xhtml"  
> 
<head> <title>Database &amp; Container Deployment</title> 
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /> 
<meta name="generator" content="TeX4ht (https://tug.org/tex4ht/)" /> 
<meta name="originator" content="TeX4ht (https://tug.org/tex4ht/)" /> 
<!-- fn-in,html,htex4ht,xhtml --> 
<meta name="src" content="main.tex" /> 
<link rel="stylesheet" type="text/css" href="main.css" /> 
<link rel="stylesheet" href="https://latex.now.sh/style.css"> 
<link rel="stylesheet" href="/notes.css"> 
<style>body {max-width: 100ch;} 
dl dd {text-align: left}</style> 
</head><body 
>
   <div class="maketitle"><a 
 id="Q1-1-1"></a>
_________________________________________________________________________________________________
<h2 class="titleHead">Database &amp; Container Deployment</h2>                                         Software Architecture
   <div class="date" >March 25, 2025</div>                                                                                             <div class="author" >Evan Hughes, Brae Webb &amp; Richard
Thomas</div>
____________________________________________________________________________________________
   </div>
   <hr class="figure" /><div class="figure" 
>
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    
<div class="center" 
>
<!--l. 17--><p class="noindent" >
</p><!--l. 18--><p class="noindent" ><img 
src="images/cloud-whale.png" alt="PIC"  
width="28" height="28"  /></p></div>
</div><hr class="endfigure" />
   <div class="tcolorbox tcolorbox" id="tcolobox-1">     
<div class="tcolorbox-title">
<!--l. 24--><p class="indent" >   Aside</p></div> 
<div class="tcolorbox-content"><!--l. 24--><p class="noindent" >Github       Classroom       links       for       this       practical       can       be       found       on       Edstem       
<a 
href="https://edstem.org/au/courses/21491/discussion/2429006" class="url" ><span 
class="ectt-1200">https://edstem.org/au/courses/21491/discussion/2429006</span></a> </p> 
</div> 
</div>
   
   <h3 class="sectionHead"><span class="titlemark">1    </span> <a 
 id="x1-10001"></a>This Week</h3>
<!--l. 27--><p class="noindent" >This week we are going to deploy our todo application, now called TaskOverflow, on AWS infrastructure using a
hosted database and a single server website.
</p><!--l. 31--><p class="indent" >   Specifically, this week you need to: </p>
      <ul class="itemize1">
      <li class="itemize">
      <!--l. 33--><p class="noindent" >Deploy an AWS Relational Database Service (RDS) using Terraform.
      </p></li>
      <li class="itemize">
      <!--l. 34--><p class="noindent" >Deploy the TaskOverflow container on AWS infrastructure using an ECS cluster.</p></li></ul>
   
   <h3 class="sectionHead"><span class="titlemark">2    </span> <a 
 id="x1-20002"></a>Terraform in AWS Learner Labs</h3>
<!--l. 38--><p class="noindent" >Following the steps from the week four practical, start a Learner Lab in AWS Academy. For this practical, you do
not need to create any resources using the AWS Console. The console can be used to verify that Terraform has
correctly provisioned resources.
</p><!--l. 44--><p class="indent" >
      </p><ol  class="enumerate1" >
<li 
  class="enumerate" id="x1-2002x1">
      <!--l. 45--><p class="noindent" >Using  the  GitHub  Classroom  link  for  this  practical  provided  by  your  tutor  on  edstem,  create  a
      repository to work within.
      </p></li>
<li 
  class="enumerate" id="x1-2004x2">
      <!--l. 47--><p class="noindent" >Clone the repository or open an environment in GitHub CodeSpaces<span class="footnote-mark"><a 
href="#fn1x0" id="fn1x0-bk"><sup class="textsuperscript">1</sup></a></span><a 
 id="x1-2005f1"></a>
      </p></li>
<li 
  class="enumerate" id="x1-2008x3">
      <!--l. 49--><p class="noindent" >Start the Learner Lab then, once the lab has started, click on &#8216;AWS Details&#8217; to display information
      about the lab.
      </p><!--l. 52--><p class="noindent" ><img 
src="images/aws-details.png" alt="PIC"  
width="367" height="367"  />
                                                                                                    
                                                                                                    
      </p></li>
<li 
  class="enumerate" id="x1-2010x4">
      <!--l. 54--><p class="noindent" >Click  on  the  first  &#8216;Show&#8217;  button  next  to  &#8216;AWS  CLI&#8217;  which  will  display  a  text  block  starting  with
      <span 
class="ectt-1200">[default]</span>.
      </p></li>
<li 
  class="enumerate" id="x1-2012x5">
      <!--l. 55--><p class="noindent" >Within your repository create a <span 
class="ectt-1200">credentials </span>file and copy the contents of the text block into the
      file. <span 
class="Cabin-Bold-tlf-t1-x-x-120">Do </span><span class="underline"><span 
class="Cabin-Bold-tlf-t1-x-x-120">not</span></span> <span 
class="Cabin-Bold-tlf-t1-x-x-120">share this file contents &#8212; do </span><span class="underline"><span 
class="Cabin-Bold-tlf-t1-x-x-120">not</span></span> <span 
class="Cabin-Bold-tlf-t1-x-x-120">commit it</span>.
      </p></li>
<li 
  class="enumerate" id="x1-2014x6">
      <!--l. 57--><p class="noindent" >Create a <span 
class="ectt-1200">main.tf </span>file in the your repository with the following contents:    </p><div class="framedenv" id="code-1">
      <!--l. 58--><p class="noindent" ><span 
class="ectt-1200">» cat main.tf</span> </p></div>   <div class="framedenv" id="code-1"><!--l. 58--><pre class="listings" id="listing-1"><span class="label"><a 
 id="x1-2015r1"></a></span><span style="color:#006699"><span 
class="ectt-1200">terraform</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-2016r2"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#006699"><span 
class="ectt-1200">required_providers</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-2017r3"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">aws</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-2018r4"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">source</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">hashicorp</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">aws</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-2019r5"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">version</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">~&#x003E;</span></span><span style="color:#669900"> </span><span style="color:#669900"><span 
class="ectt-1200">5.0</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-2020r6"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">}</span></span> 
<span class="label"><a 
 id="x1-2021r7"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">}</span></span> 
<span class="label"><a 
 id="x1-2022r8"></a></span><span style="color:#000000"><span 
class="ectt-1200">}</span></span> 
<span class="label"><a 
 id="x1-2023r9"></a></span> 
<span class="label"><a 
 id="x1-2024r10"></a></span><span style="color:#006699"><span 
class="ectt-1200">provider</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">aws</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-2025r11"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">region</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">us</span></span><span style="color:#669900"><span 
class="ectt-1200">-</span></span><span style="color:#669900"><span 
class="ectt-1200">east</span></span><span style="color:#669900"><span 
class="ectt-1200">-1</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-2026r12"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">shared_credentials_files</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">[</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">./</span></span><span style="color:#669900"><span 
class="ectt-1200">credentials</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">]</span></span> 
<span class="label"><a 
 id="x1-2027r13"></a></span><span style="color:#000000"><span 
class="ectt-1200">}</span></span>
       
<span class="label"><a 
 id="x1-2028r14"></a></span></pre>
      </div>
      </li>
<li 
  class="enumerate" id="x1-2030x7">
      <!--l. 74--><p class="noindent" >We need to initialise Terraform which will fetch the required dependencies. This is done with the <span 
class="ectt-1200">terraform</span>
      <span 
class="ectt-1200">init </span>command.  </p><div class="framedenv" id="shaded*-1">
      <!--l. 76-->
      <pre class="lstlisting" id="listing-2"><span class="label"><a 
 id="x1-2031r1"></a></span><span style="color:#000000"><span 
class="ectt-1200">$</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">terraform</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">init</span></span><span 
class="ectt-1200">&#x00A0;</span></pre>
      
      </div>
      <!--l. 78--><p class="noindent" >This command will create a <span 
class="ectt-1200">.terraform </span>directory which stores providers and a provider lock file,
      <span 
class="ectt-1200">.terraform.lock.hcl</span>.
      </p></li>
<li 
  class="enumerate" id="x1-2033x8">
      <!--l. 80--><p class="noindent" >To verify that we have setup Terraform correctly, use <span 
class="ectt-1200">terraform plan</span>.  </p><div class="framedenv" id="shaded*-1">
      <!--l. 81-->
      <pre class="lstlisting" id="listing-3"><span class="label"><a 
 id="x1-2034r1"></a></span><span style="color:#000000"><span 
class="ectt-1200">$</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">terraform</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">plan</span></span><span 
class="ectt-1200">&#x00A0;</span></pre>
      
      </div>
      <!--l. 83--><p class="noindent" >As we currently have no resources configured, it should find that no changes are required. Note that this
      does not ensure our credentials are correctly configured as Terraform has no reason to try authenticating
      yet.
</p>
      </li></ol>
   
                                                                                                    
                                                                                                    
   <h3 class="sectionHead"><span class="titlemark">3    </span> <a 
 id="x1-30003"></a>Deploying a Database in AWS</h3>
   <div class="tcolorbox tcolorbox" id="tcolobox-2">     
<div class="tcolorbox-title">
<!--l. 95--><p class="indent" >   Warning</p></div> 
<div class="tcolorbox-content"><!--l. 95--><p class="noindent" >This section manually deploys a PostgreSQL RDS instance, this is intended as a demonstration by
your tutor. You should attempt to deploy your infrastructure using Terraform rather than manually.
</p> 
</div> 
</div>
<!--l. 101--><p class="noindent" >To get started let us jump into the lab environment and have a look at AWS RDS which is an AWS managed
database service. To get to the RDS service either search for it or browse Services -&#x003E; Database -&#x003E; Aurora and RDS,
as shown below.
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    
<!--l. 106--><p class="noindent" ><img 
src="images/aws_1.png" alt="PIC"  
width="409" height="-614"  />
                                                                                                    
                                                                                                    
</p>
   </div><hr class="endfigure" />
<!--l. 109--><p class="noindent" >Now we are in the management interface for all our RDS instances. Select &#8220;DB Instances (0/40)&#8221; or click
&#8220;Databases&#8221; on the left panel.
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    
<!--l. 114--><p class="noindent" ><img 
src="images/aws_2.png" alt="PIC"  
width="525" height="525"  />
                                                                                                    
                                                                                                    
</p>
   </div><hr class="endfigure" />
<!--l. 117--><p class="noindent" >This page should appear familiar as it is very similar to the AWS EC2 instance page. Let us create a new database
by clicking on the &#8220;Create Database&#8221; button.
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    
<!--l. 122--><p class="noindent" ><img 
src="images/aws_3.png" alt="PIC"  
width="525" height="525"  />
                                                                                                    
                                                                                                    
</p>
   </div><hr class="endfigure" />
   <div class="tcolorbox tcolorbox" id="tcolobox-3">     
<div class="tcolorbox-title">
<!--l. 128--><p class="indent" >   Warning</p></div> 
<div class="tcolorbox-content"><!--l. 128--><p class="noindent" >In the next section we cannot use the Easy Create option as it tries to create an IAM account, which
is disabled in Learner Labs.  </p> 
</div> 
</div>
<!--l. 135--><p class="indent" >
                                                                                                    
                                                                                                    
</p><!--l. 136--><p class="noindent" >We will create a standard database so select standard and PostgreSQL. We will use version 17, which is a fairly
recent release.
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    
<!--l. 141--><p class="noindent" ><img 
src="images/db1.png" alt="PIC"  
width="525" height="-255"  />
                                                                                                    
                                                                                                    
</p>
   </div><hr class="endfigure" />
<!--l. 144--><p class="indent" >
                                                                                                    
                                                                                                    
</p><!--l. 145--><p class="noindent" >For today, we are going to use &#8220;Free Tier&#8221; but in the future, you may wish to explore the different deployment
options. Please peruse the available options.
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    
<!--l. 155--><p class="noindent" ><img 
src="images/db2.png" alt="PIC"  
width="525" height="481"  />
                                                                                                    
                                                                                                    
</p>
   </div><hr class="endfigure" />
<!--l. 158--><p class="indent" >
                                                                                                    
                                                                                                    
</p><!--l. 159--><p class="noindent" >Now we need to name our database and create credentials to use when connecting from our application. Enter
memorable credentials as these will be used later.
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    
<!--l. 164--><p class="noindent" ><img 
src="images/db3.png" alt="PIC"  
width="525" height="496"  />
                                                                                                    
                                                                                                    
</p>
   </div><hr class="endfigure" />
<!--l. 167--><p class="noindent" >For exploring the process select t3.micro, which should be adequate for our needs.
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    
<!--l. 176--><p class="noindent" ><img 
src="images/db4.png" alt="PIC"  
width="525" height="525"  />
                                                                                                    
                                                                                                    
</p>
   </div><hr class="endfigure" />
<!--l. 179--><p class="indent" >
                                                                                                    
                                                                                                    
</p><!--l. 180--><p class="noindent" >For storage we will leave all the default options.
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    
<!--l. 184--><p class="noindent" ><img 
src="images/db5.png" alt="PIC"  
width="525" height="525"  />
                                                                                                    
                                                                                                    
</p>
   </div><hr class="endfigure" />
<!--l. 191--><p class="noindent" >In connectivity we will leave the <span 
class="Cabin-Bold-tlf-t1-x-x-120">Compute resource </span>and <span 
class="Cabin-Bold-tlf-t1-x-x-120">VPC </span>with their default values. We need to
make our instance publicly available. Usually you do <span 
class="Cabin-BoldItalic-tlf-t1-x-x-120">not </span>want to expose your databases publicly and,
would instead, have a server sitting in-front (e.g. an API, application or web server). For our learning
purposes though we are going to expose it directly just like we did with our EC2 instances earlier in the
course.
</p><!--l. 198--><p class="indent" >   When selecting public access as yes, we have to create a new Security Group. Give this Security Group a
sensible name.
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    
<!--l. 202--><p class="noindent" ><img 
src="images/db6.png" alt="PIC"  
width="525" height="525"  />
                                                                                                    
                                                                                                    
</p>
   </div><hr class="endfigure" />
<!--l. 205--><p class="noindent" >We will leave the authentication as password based and monitoring with its default values. We need to expand
the &#8220;Additional configuration&#8221; section. Fill in the &#8220;Initial Database Name&#8221; field as &#8220;todo&#8221;, this will automatically
create the database to which our todo application expects to connect.
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    
<!--l. 217--><p class="noindent" ><img 
src="images/db7.png" alt="PIC"  
width="525" height="525"  />
                                                                                                    
                                                                                                    
</p>
   </div><hr class="endfigure" />
<!--l. 220--><p class="noindent" >Now we can click create database, which will take some time.
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    
<!--l. 224--><p class="noindent" ><img 
src="images/db8.png" alt="PIC"  
width="525" height="525"  />
                                                                                                    
                                                                                                    
</p>
   </div><hr class="endfigure" />
<!--l. 227--><p class="noindent" >It may take several minutes to create. If we had selected to enable automated backups, the database would do an
initial backup when it is created.
</p><!--l. 231--><p class="indent" >   AWS will suggest add-ons for the newly created database. The suggested add-ons are useful features for a
production environment. We do not need them for the purposes of this practical.
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    
<!--l. 236--><p class="noindent" ><img 
src="images/aws_4.png" alt="PIC"  
width="525" height="525"  />
                                                                                                    
                                                                                                    
</p>
   </div><hr class="endfigure" />
<!--l. 239--><p class="noindent" >When the database has been created, you can select it to view the configuration and details. In this menu
we also see the endpoint address, which we will need to configure our TaskOverflow application to
use.
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    
<!--l. 244--><p class="noindent" ><img 
src="images/aws_5.png" alt="PIC"  
width="525" height="525"  />
                                                                                                    
                                                                                                    
</p>
   </div><hr class="endfigure" />
   
   <h3 class="sectionHead"><span class="titlemark">4    </span> <a 
 id="x1-40004"></a>RDS Database with Terraform</h3>
<!--l. 250--><p class="noindent" >Now would be a good time to browse the documentation for the RDS database in Terraform. You will want to get
practice at reading and understanding Terraform documentation.
</p><!--l. 253--><p class="noindent" ><a 
href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/db_instance" class="url" ><span 
class="ectt-1200">https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/db_instance</span></a>
</p><!--l. 255--><p class="indent" >   Using our manual configuration, we can come up with a resource with the appropriate parameters as
below:
</p><!--l. 257--><p class="indent" >   </p><div class="framedenv" id="code-1">
<!--l. 257--><p class="indent" >   <span 
class="ectt-1200">» cat main.tf</span> </p></div>   <div class="framedenv" id="code-1"><!--l. 257--><pre class="listings" id="listing-4"><span class="label"><a 
 id="x1-4001r1"></a></span><span style="color:#000000"><span 
class="ectt-1200">locals</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-4002r2"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">database_username</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">administrator</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-4003r3"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">database_password</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">foobarbaz</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#33997E"><span 
class="ectt-1200">#</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">This</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">is</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">bad</span></span><span style="color:#33997E"><span 
class="ectt-1200">!</span></span> 
<span class="label"><a 
 id="x1-4004r4"></a></span><span style="color:#000000"><span 
class="ectt-1200">}</span></span> 
<span class="label"><a 
 id="x1-4005r5"></a></span> 
<span class="label"><a 
 id="x1-4006r6"></a></span><span style="color:#006699"><span 
class="ectt-1200">resource</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">aws_db_instance</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">taskoverflow_database</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-4007r7"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">allocated_storage</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">20</span></span> 
<span class="label"><a 
 id="x1-4008r8"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">max_allocated_storage</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">1000</span></span> 
<span class="label"><a 
 id="x1-4009r9"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">engine</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">postgres</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-4010r10"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">engine_version</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">17</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-4011r11"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">instance_class</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">db</span></span><span style="color:#669900"><span 
class="ectt-1200">.</span></span><span style="color:#669900"><span 
class="ectt-1200">t3</span></span><span style="color:#669900"><span 
class="ectt-1200">.</span></span><span style="color:#669900"><span 
class="ectt-1200">micro</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-4012r12"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">db_name</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">todo</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-4013r13"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">username</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">local</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">database_username</span></span> 
<span class="label"><a 
 id="x1-4014r14"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">password</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">local</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">database_password</span></span> 
<span class="label"><a 
 id="x1-4015r15"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">parameter_group_name</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">default</span></span><span style="color:#669900"><span 
class="ectt-1200">.</span></span><span style="color:#669900"><span 
class="ectt-1200">postgres17</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-4016r16"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">skip_final_snapshot</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">true</span></span> 
<span class="label"><a 
 id="x1-4017r17"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">vpc_security_group_ids</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">[</span></span><span style="color:#000000"><span 
class="ectt-1200">aws_security_group</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">taskoverflow_database</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">id</span></span><span style="color:#000000"><span 
class="ectt-1200">]</span></span> 
<span class="label"><a 
 id="x1-4018r18"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">publicly_accessible</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">true</span></span> 
<span class="label"><a 
 id="x1-4019r19"></a></span> 
<span class="label"><a 
 id="x1-4020r20"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">tags</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-4021r21"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">Name</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">taskoverflow_database</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-4022r22"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">}</span></span> 
<span class="label"><a 
 id="x1-4023r23"></a></span><span style="color:#000000"><span 
class="ectt-1200">}</span></span>
 
<span class="label"><a 
 id="x1-4024r24"></a></span></pre>
   </div>
<!--l. 283--><p class="indent" >   When we created the database using the AWS Console, we needed an appropriate security group so that we
could access the database. We can create the security group using Terraform as well.
</p><!--l. 287--><p class="indent" >   </p><div class="framedenv" id="code-1">
<!--l. 287--><p class="indent" >   <span 
class="ectt-1200">» cat main.tf</span> </p></div>   <div class="framedenv" id="code-1"><!--l. 287--><pre class="listings" id="listing-5"><span class="label"><a 
 id="x1-4025r1"></a></span><span style="color:#006699"><span 
class="ectt-1200">resource</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">aws_security_group</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">taskoverflow_database</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-4026r2"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">name</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">taskoverflow_database</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-4027r3"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">description</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">Allow</span></span><span style="color:#669900"> </span><span style="color:#669900"><span 
class="ectt-1200">inbound</span></span><span style="color:#669900"> </span><span style="color:#669900"><span 
class="ectt-1200">Postgresql</span></span><span style="color:#669900"> </span><span style="color:#669900"><span 
class="ectt-1200">traffic</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-4028r4"></a></span> 
<span class="label"><a 
 id="x1-4029r5"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">ingress</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-4030r6"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">from_port</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">5432</span></span> 
<span class="label"><a 
 id="x1-4031r7"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">to_port</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">5432</span></span> 
<span class="label"><a 
 id="x1-4032r8"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">protocol</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">tcp</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-4033r9"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">cidr_blocks</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">[</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">0.0.0.0/0</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">]</span></span> 
<span class="label"><a 
 id="x1-4034r10"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">}</span></span> 
<span class="label"><a 
 id="x1-4035r11"></a></span> 
<span class="label"><a 
 id="x1-4036r12"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">egress</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-4037r13"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">from_port</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">0</span></span> 
<span class="label"><a 
 id="x1-4038r14"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">to_port</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">0</span></span> 
<span class="label"><a 
 id="x1-4039r15"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">protocol</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">-1</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-4040r16"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">cidr_blocks</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">[</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">0.0.0.0/0</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">]</span></span> 
<span class="label"><a 
 id="x1-4041r17"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">ipv6_cidr_blocks</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">[</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">::/0</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">]</span></span> 
<span class="label"><a 
 id="x1-4042r18"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">}</span></span> 
<span class="label"><a 
 id="x1-4043r19"></a></span> 
<span class="label"><a 
 id="x1-4044r20"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">tags</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-4045r21"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">Name</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">taskoverflow_database</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-4046r22"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">}</span></span> 
<span class="label"><a 
 id="x1-4047r23"></a></span><span style="color:#000000"><span 
class="ectt-1200">}</span></span>
 
<span class="label"><a 
 id="x1-4048r24"></a></span></pre>
   </div>
   
   <h3 class="sectionHead"><span class="titlemark">5    </span> <a 
 id="x1-50005"></a>Container on AWS</h3>
<!--l. 316--><p class="noindent" >As we mentioned in the Infrastructure as Code notes <span class="cite">[<a 
href="#Xiac-notes">1</a>]</span>, in this course we will use Docker to configure machines
and Terraform to configure infrastructure. AWS has the ability to deploy Docker containers using a service known
as Elastic Container Service (ECS). We will cover ECS and briefly contrast it to manual deployment via
EC2.
</p><!--l. 321--><p class="indent" >   For this practical we have made available a Docker container running the TaskOverflow application, which
you can use for your AWS deployment. This container is available on GitHub under the CSSE6400
organisation:
</p><!--l. 325--><p class="indent" >   <a 
href="https://ghcr.io/csse6400/taskoverflow:latest" class="url" ><span 
class="ectt-1200">https://ghcr.io/csse6400/taskoverflow:latest</span></a>
</p><!--l. 327--><p class="indent" >   This container is very similar to what you have been building in the practicals but contains a simple UI and some extra features
for the future practicals.<span class="footnote-mark"><a 
href="#fn2x0" id="fn2x0-bk"><sup class="textsuperscript">2</sup></a></span><a 
 id="x1-5001f2"></a>
   
</p>
   <h4 class="subsectionHead"><span class="titlemark">5.1    </span> <a 
 id="x1-60005.1"></a>Setup</h4>
<!--l. 332--><p class="noindent" >Of all the different ways that we can deploy our application, we have decided to offload the database to
AWS RDS. This means that we can move all the "state" of our application out of our containerised
environment.
</p><!--l. 335--><p class="indent" >   To begin, we will reuse the Terraform from above for deploying the RDS database. Extend the existing local
Terraform variables to include the address of the container, so that we have:
</p><!--l. 338--><p class="indent" >   </p><div class="framedenv" id="code-1">
<!--l. 338--><p class="indent" >   <span 
class="ectt-1200">» cat main.tf</span> </p></div>   <div class="framedenv" id="code-1"><!--l. 338--><pre class="listings" id="listing-6"><span class="label"><a 
 id="x1-6001r1"></a></span><span style="color:#000000"><span 
class="ectt-1200">locals</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-6002r2"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">image</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">ghcr</span></span><span style="color:#669900"><span 
class="ectt-1200">.</span></span><span style="color:#669900"><span 
class="ectt-1200">io</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">csse6400</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">taskoverflow</span></span><span style="color:#669900"><span 
class="ectt-1200">:</span></span><span style="color:#669900"><span 
class="ectt-1200">latest</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-6003r3"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">database_username</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">administrator</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-6004r4"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">database_password</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">foobarbaz</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#33997E"><span 
class="ectt-1200">#</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">this</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">is</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">bad</span></span> 
<span class="label"><a 
 id="x1-6005r5"></a></span><span style="color:#000000"><span 
class="ectt-1200">}</span></span>
 
<span class="label"><a 
 id="x1-6006r6"></a></span></pre>
                                                                                                    
                                                                                                    
   </div>
<!--l. 346--><p class="indent" >   This already sets up an RDS instance of Postgres and a security group to allow access to it. Now we can run
<span 
class="ectt-1200">terraform init </span>and <span 
class="ectt-1200">terraform apply </span>to create our database. Like when creating the database from the AWS
console, this may take several minutes. Once the database has been created, go to the AWS console and check its
status and details.
</p><!--l. 351--><p class="indent" >   We have also added a local variable for us to use later. Variables in Terraform can be populated via two
mechanisms, they can be in a variables block which can be overridden, or they can be in a locals block which can
be used to store values that are used in multiple places.
   
</p>
   <h4 class="subsectionHead"><span class="titlemark">5.2    </span> <a 
 id="x1-70005.2"></a>ECS Deployment</h4>
   <hr class="figure" /><div class="figure" 
>
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    
<!--l. 360--><p class="noindent" ><img 
src="diagrams/ecsdeployment.png" alt="PIC"  
width="525" height="-1152"  />
                                                                                                    
                                                                                                    
</p>
   </div><hr class="endfigure" />
<!--l. 363--><p class="indent" >   ECS mimics a similar environment as Docker Compose but as an AWS service.
</p><!--l. 365--><p class="indent" >   To start off we need to get some information from our current AWS environment so that we can use it later.
Add the code below to fetch the IAM role known as LabRole. It is a super user in the Learner Lab
environments which can do everything you can do through the AWS Console. We will also fetch
the default VPC and the private subnets within that VPC, as they are required for the ECS network
configuration.
</p>
   <div class="framedenv" id="code-1">
<!--l. 371--><pre class="listings" id="listing-7"><span class="label"><a 
 id="x1-7001r1"></a></span><span style="color:#006699"><span 
class="ectt-1200">data</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">aws_iam_role</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">lab</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-7002r2"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">name</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">LabRole</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-7003r3"></a></span><span style="color:#000000"><span 
class="ectt-1200">}</span></span> 
<span class="label"><a 
 id="x1-7004r4"></a></span> 
<span class="label"><a 
 id="x1-7005r5"></a></span><span style="color:#006699"><span 
class="ectt-1200">data</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">aws_vpc</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">default</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-7006r6"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">default</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">true</span></span> 
<span class="label"><a 
 id="x1-7007r7"></a></span><span style="color:#000000"><span 
class="ectt-1200">}</span></span> 
<span class="label"><a 
 id="x1-7008r8"></a></span> 
<span class="label"><a 
 id="x1-7009r9"></a></span><span style="color:#006699"><span 
class="ectt-1200">data</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">aws_subnets</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">private</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-7010r10"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">filter</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-7011r11"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">name</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">vpc</span></span><span style="color:#669900"><span 
class="ectt-1200">-</span></span><span style="color:#669900"><span 
class="ectt-1200">id</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-7012r12"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">values</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">[</span></span><span style="color:#006699"><span 
class="ectt-1200">data</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">aws_vpc</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">default</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">id</span></span><span style="color:#000000"><span 
class="ectt-1200">]</span></span> 
<span class="label"><a 
 id="x1-7013r13"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">}</span></span> 
<span class="label"><a 
 id="x1-7014r14"></a></span><span style="color:#000000"><span 
class="ectt-1200">}</span></span>
 
<span class="label"><a 
 id="x1-7015r15"></a></span></pre>
   </div>
<!--l. 388--><p class="indent" >   In Terraform, the way to retrieve external information is data sources. These are functionally like resources but
they are not created or destroyed, instead they are populated with attributes from the current state. See the
below for the minor syntactic difference.
</p>
   <div class="framedenv" id="code-1">
<!--l. 393--><pre class="listings" id="listing-8"><span class="label"><a 
 id="x1-7016r1"></a></span><span style="color:#000000"><span 
class="colorbox" id="colorbox1"><span 
class="ectt-1200">data</span></span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">aws_iam_role</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">lab</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-7017r2"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">...</span></span> 
<span class="label"><a 
 id="x1-7018r3"></a></span><span style="color:#000000"><span 
class="ectt-1200">}</span></span> 
<span class="label"><a 
 id="x1-7019r4"></a></span> 
<span class="label"><a 
 id="x1-7020r5"></a></span><span style="color:#000000"><span 
class="colorbox" id="colorbox2"><span 
class="ectt-1200">resource</span></span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">aws_db_instance</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">database</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-7021r6"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">...</span></span> 
<span class="label"><a 
 id="x1-7022r7"></a></span><span style="color:#000000"><span 
class="ectt-1200">}</span></span>
 
<span class="label"><a 
 id="x1-7023r8"></a></span></pre>
   </div>
<!--l. 404--><p class="indent" >   Now that we have access to the information required, we can create the ECS cluster to host our
application.
</p><!--l. 407--><p class="indent" >   The first step is to create the ECS cluster which is just a logical grouping of any images. All that is required is a
name for the new grouping.
</p><!--l. 411--><p class="indent" >   </p><div class="framedenv" id="code-1">
<!--l. 411--><p class="indent" >   <span 
class="ectt-1200">» cat main.tf</span> </p></div>   <div class="framedenv" id="code-1"><!--l. 411--><pre class="listings" id="listing-9"><span class="label"><a 
 id="x1-7024r1"></a></span><span style="color:#006699"><span 
class="ectt-1200">resource</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">aws_ecs_cluster</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">taskoverflow</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-7025r2"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">name</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">taskoverflow</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-7026r3"></a></span><span style="color:#000000"><span 
class="ectt-1200">}</span></span>
 
<span class="label"><a 
 id="x1-7027r4"></a></span></pre>
   </div>
<!--l. 417--><p class="indent" >   On its own this cluster is not particularly useful. We need to create a task definition which is a
description of the container that we want to run. This is where we will define the image that we want to
run, the environment variables, the port mappings, etc. This is similar to a server entry in Docker
Compose.
</p>
   <div class="tcolorbox tcolorbox" id="tcolobox-4">     
<div class="tcolorbox-title">
<!--l. 427--><p class="indent" >   Warning</p></div> 
<div class="tcolorbox-content"><!--l. 427--><p class="noindent" >The  <span 
class="ectt-1200">«DEFINITION </span>line  cannot  have  a  trailing  space.  Ensure  that  one  has  not  been  erroneously
inserted.  </p> 
</div> 
</div>
<!--l. 429--><p class="indent" >   </p><div class="framedenv" id="code-1">
<!--l. 429--><p class="indent" >   <span 
class="ectt-1200">» cat main.tf</span> </p></div>   <div class="framedenv" id="code-1"><!--l. 429--><pre class="listings" id="listing-10"><span class="label"><a 
 id="x1-7028r1"></a></span><span style="color:#006699"><span 
class="ectt-1200">resource</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">aws_ecs_task_definition</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">taskoverflow</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-7029r2"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">family</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">taskoverflow</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-7030r3"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">network_mode</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">awsvpc</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-7031r4"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">requires_compatibilities</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">[</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">FARGATE</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">]</span></span> 
<span class="label"><a 
 id="x1-7032r5"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">cpu</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">1024</span></span> 
<span class="label"><a 
 id="x1-7033r6"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">memory</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">2048</span></span> 
<span class="label"><a 
 id="x1-7034r7"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">execution_role_arn</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#006699"><span 
class="ectt-1200">data</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">aws_iam_role</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">lab</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">arn</span></span> 
<span class="label"><a 
 id="x1-7035r8"></a></span> 
<span class="label"><a 
 id="x1-7036r9"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">container_definitions</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">&#x003C;&#x003C;</span></span><span style="color:#000000"><span 
class="ectt-1200">DEFINITION</span></span> 
<span class="label"><a 
 id="x1-7037r10"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">[</span></span> 
<span class="label"><a 
 id="x1-7038r11"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-7039r12"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">image</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">$</span></span><span style="color:#669900"><span 
class="ectt-1200">{</span></span><span style="color:#669900"><span 
class="ectt-1200">local</span></span><span style="color:#669900"><span 
class="ectt-1200">.</span></span><span style="color:#669900"><span 
class="ectt-1200">image</span></span><span style="color:#669900"><span 
class="ectt-1200">}</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span> 
<span class="label"><a 
 id="x1-7040r13"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">cpu</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">1024,</span></span> 
<span class="label"><a 
 id="x1-7041r14"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">memory</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">2048,</span></span> 
<span class="label"><a 
 id="x1-7042r15"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">name</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">todo</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span> 
<span class="label"><a 
 id="x1-7043r16"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">networkMode</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">awsvpc</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span> 
<span class="label"><a 
 id="x1-7044r17"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">portMappings</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">[</span></span> 
<span class="label"><a 
 id="x1-7045r18"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-7046r19"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">containerPort</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">6400,</span></span> 
<span class="label"><a 
 id="x1-7047r20"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">hostPort</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">6400</span></span> 
<span class="label"><a 
 id="x1-7048r21"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">}</span></span> 
<span class="label"><a 
 id="x1-7049r22"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">],</span></span> 
<span class="label"><a 
 id="x1-7050r23"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">environment</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">[</span></span> 
<span class="label"><a 
 id="x1-7051r24"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-7052r25"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">name</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">SQLALCHEMY_DATABASE_URI</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span> 
<span class="label"><a 
 id="x1-7053r26"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">value</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">postgresql</span></span><span style="color:#669900"><span 
class="ectt-1200">://</span></span><span style="color:#669900"><span 
class="ectt-1200">$</span></span><span style="color:#669900"><span 
class="ectt-1200">{</span></span><span style="color:#669900"><span 
class="ectt-1200">local</span></span><span style="color:#669900"><span 
class="ectt-1200">.</span></span><span style="color:#669900"><span 
class="ectt-1200">database_username</span></span><span style="color:#669900"><span 
class="ectt-1200">}:</span></span><span style="color:#669900"><span 
class="ectt-1200">$</span></span><span style="color:#669900"><span 
class="ectt-1200">{</span></span><span style="color:#669900"><span 
class="ectt-1200">local</span></span><span style="color:#669900"><span 
class="ectt-1200">.</span></span><span style="color:#669900"><span 
class="ectt-1200">database_password</span></span><span style="color:#669900"><span 
class="ectt-1200">}</span></span><span style="color:#669900"><span 
class="ectt-1200">@$</span></span><span style="color:#669900"><span 
class="ectt-1200">{</span></span><span style="color:#669900"><span 
class="ectt-1200">aws_db_instance</span></span><span style="color:#669900"><span 
class="ectt-1200">.</span></span><span style="color:#669900"><span 
class="ectt-1200">taskoverflow_database</span></span><span style="color:#669900"><span 
class="ectt-1200">.</span></span><span style="color:#669900"><span 
class="ectt-1200">address</span></span><span style="color:#669900"><span 
class="ectt-1200">}:</span></span><span style="color:#669900"><span 
class="ectt-1200">$</span></span><span style="color:#669900"><span 
class="ectt-1200">{</span></span><span style="color:#669900"><span 
class="ectt-1200">aws_db_instance</span></span><span style="color:#669900"><span 
class="ectt-1200">.</span></span><span style="color:#669900"><span 
class="ectt-1200">taskoverflow_database</span></span><span style="color:#669900"><span 
class="ectt-1200">.</span></span><span style="color:#669900"><span 
class="ectt-1200">port</span></span><span style="color:#669900"><span 
class="ectt-1200">}/</span></span><span style="color:#669900"><span 
class="ectt-1200">$</span></span><span style="color:#669900"><span 
class="ectt-1200">{</span></span><span style="color:#669900"><span 
class="ectt-1200">aws_db_instance</span></span><span style="color:#669900"><span 
class="ectt-1200">.</span></span><span style="color:#669900"><span 
class="ectt-1200">taskoverflow_database</span></span><span style="color:#669900"><span 
class="ectt-1200">.</span></span><span style="color:#669900"><span 
class="ectt-1200">db_name</span></span><span style="color:#669900"><span 
class="ectt-1200">}</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-7054r27"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">}</span></span> 
<span class="label"><a 
 id="x1-7055r28"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">],</span></span> 
<span class="label"><a 
 id="x1-7056r29"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">logConfiguration</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-7057r30"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">logDriver</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">awslogs</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span> 
<span class="label"><a 
 id="x1-7058r31"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">options</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-7059r32"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">awslogs</span></span><span style="color:#669900"><span 
class="ectt-1200">-</span></span><span style="color:#669900"><span 
class="ectt-1200">group</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">taskoverflow</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">todo</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span> 
<span class="label"><a 
 id="x1-7060r33"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">awslogs</span></span><span style="color:#669900"><span 
class="ectt-1200">-</span></span><span style="color:#669900"><span 
class="ectt-1200">region</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">us</span></span><span style="color:#669900"><span 
class="ectt-1200">-</span></span><span style="color:#669900"><span 
class="ectt-1200">east</span></span><span style="color:#669900"><span 
class="ectt-1200">-1</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span> 
<span class="label"><a 
 id="x1-7061r34"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">awslogs</span></span><span style="color:#669900"><span 
class="ectt-1200">-</span></span><span style="color:#669900"><span 
class="ectt-1200">stream</span></span><span style="color:#669900"><span 
class="ectt-1200">-</span></span><span style="color:#669900"><span 
class="ectt-1200">prefix</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">ecs</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span> 
<span class="label"><a 
 id="x1-7062r35"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">awslogs</span></span><span style="color:#669900"><span 
class="ectt-1200">-</span></span><span style="color:#669900"><span 
class="ectt-1200">create</span></span><span style="color:#669900"><span 
class="ectt-1200">-</span></span><span style="color:#669900"><span 
class="ectt-1200">group</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">true</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-7063r36"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">}</span></span> 
<span class="label"><a 
 id="x1-7064r37"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">}</span></span> 
<span class="label"><a 
 id="x1-7065r38"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">}</span></span> 
<span class="label"><a 
 id="x1-7066r39"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">]</span></span> 
<span class="label"><a 
 id="x1-7067r40"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">DEFINITION</span></span> 
<span class="label"><a 
 id="x1-7068r41"></a></span><span style="color:#000000"><span 
class="ectt-1200">}</span></span>
 
<span class="label"><a 
 id="x1-7069r42"></a></span></pre>
   </div>
      <dl class="description"><dt class="description">
<span 
class="Cabin-Bold-tlf-t1-x-x-120">family</span> </dt><dd 
class="description">
      <!--l. 474--><p class="noindent" >A family is similar to the name of the task but it is a name that persists through multiple revisions of
      the task.
      </p></dd><dt class="description">
<span 
class="Cabin-Bold-tlf-t1-x-x-120">network_mode</span> </dt><dd 
class="description">
      <!--l. 475--><p class="noindent" >This  is  the  network  mode  that  the  container  will  run  in,  we  want  to  run  on  regular  AWS  VPC
      infrastructure.
                                                                                                    
                                                                                                    
      </p></dd><dt class="description">
<span 
class="Cabin-Bold-tlf-t1-x-x-120">requires_compatibilities</span> </dt><dd 
class="description">
      <!--l. 476--><p class="noindent" >This is the type of container that we want to run. This can be fargate, EC2, or external.
      </p></dd><dt class="description">
<span 
class="Cabin-Bold-tlf-t1-x-x-120">cpu</span> </dt><dd 
class="description">
      <!--l. 477--><p class="noindent" >The amount of CPU units that the container will be allocated. 1024 is equivalen to one vCPU.
      </p></dd><dt class="description">
<span 
class="Cabin-Bold-tlf-t1-x-x-120">memory</span> </dt><dd 
class="description">
      <!--l. 478--><p class="noindent" >The amount of memory that the container will be allocated, here we&#8217;ve chosen 2GB.
      </p></dd><dt class="description">
<span 
class="Cabin-Bold-tlf-t1-x-x-120">execution_role_arn</span> </dt><dd 
class="description">
      <!--l. 479--><p class="noindent" >The IAM role that the container will run as. Importantly, we have re-used the lab role we previously
      retrieved. This gives the instance full admin permission for our lab environment.
      </p></dd><dt class="description">
<span 
class="Cabin-Bold-tlf-t1-x-x-120">container_definitions</span> </dt><dd 
class="description">
      <!--l. 482--><p class="noindent" >This  is  the  definition  of  the  container,  it  should  look  similar  to  Docker  Compose.  The  only
      additional feature here is the <span 
class="ectt-1200">logConfiguration</span>. This configures our container to write logs to AWS
      CloudWatch, so that we can see if anything has gone wrong.</p></dd></dl>
<!--l. 487--><p class="indent" >   Now we have a description of our container as a task. We need a service on which to run the container. This is
functionally similar to an auto-scaling group, as described in the Distributed Systems I lecture <span class="cite">[<a 
href="#Xdistributed1-slides">2</a>]</span>. We specify how
many instances of the described container we want and it will provision them. We also specify which ECS cluster
and AWS subnets to run the containers within.
</p><!--l. 493--><p class="indent" >   </p><div class="framedenv" id="code-1">
<!--l. 493--><p class="indent" >   <span 
class="ectt-1200">» cat main.tf</span> </p></div>   <div class="framedenv" id="code-1"><!--l. 493--><pre class="listings" id="listing-11"><span class="label"><a 
 id="x1-7070r1"></a></span><span style="color:#006699"><span 
class="ectt-1200">resource</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">aws_ecs_service</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">taskoverflow</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-7071r2"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">name</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">taskoverflow</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-7072r3"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">cluster</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">aws_ecs_cluster</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">taskoverflow</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">id</span></span> 
<span class="label"><a 
 id="x1-7073r4"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">task_definition</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">aws_ecs_task_definition</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">taskoverflow</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">arn</span></span> 
<span class="label"><a 
 id="x1-7074r5"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">desired_count</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">1</span></span> 
<span class="label"><a 
 id="x1-7075r6"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">launch_type</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">FARGATE</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-7076r7"></a></span> 
<span class="label"><a 
 id="x1-7077r8"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">network_configuration</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-7078r9"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">subnets</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#006699"><span 
class="ectt-1200">data</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">aws_subnets</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">private</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">ids</span></span> 
<span class="label"><a 
 id="x1-7079r10"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">security_groups</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">[</span></span><span style="color:#000000"><span 
class="ectt-1200">aws_security_group</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">taskoverflow</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">id</span></span><span style="color:#000000"><span 
class="ectt-1200">]</span></span> 
<span class="label"><a 
 id="x1-7080r11"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">assign_public_ip</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">true</span></span> 
<span class="label"><a 
 id="x1-7081r12"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">}</span></span> 
<span class="label"><a 
 id="x1-7082r13"></a></span><span style="color:#000000"><span 
class="ectt-1200">}</span></span>
 
<span class="label"><a 
 id="x1-7083r14"></a></span></pre>
   </div>
<!--l. 509--><p class="indent" >   In the above we refer to a non-existent security group. As always, to be able to access our instances over the
network we need to add a security group policy to enable it.
</p><!--l. 512--><p class="indent" >   </p><div class="framedenv" id="code-1">
<!--l. 512--><p class="indent" >   <span 
class="ectt-1200">» cat main.tf</span> </p></div>   <div class="framedenv" id="code-1"><!--l. 512--><pre class="listings" id="listing-12"><span class="label"><a 
 id="x1-7084r1"></a></span><span style="color:#006699"><span 
class="ectt-1200">resource</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">aws_security_group</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">taskoverflow</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-7085r2"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">name</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">taskoverflow</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-7086r3"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">description</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">TaskOverflow</span></span><span style="color:#669900"> </span><span style="color:#669900"><span 
class="ectt-1200">Security</span></span><span style="color:#669900"> </span><span style="color:#669900"><span 
class="ectt-1200">Group</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-7087r4"></a></span> 
<span class="label"><a 
 id="x1-7088r5"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">ingress</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-7089r6"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">from_port</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">6400</span></span> 
<span class="label"><a 
 id="x1-7090r7"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">to_port</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">6400</span></span> 
<span class="label"><a 
 id="x1-7091r8"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">protocol</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">tcp</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-7092r9"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">cidr_blocks</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">[</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">0.0.0.0/0</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">]</span></span> 
<span class="label"><a 
 id="x1-7093r10"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">}</span></span> 
<span class="label"><a 
 id="x1-7094r11"></a></span> 
<span class="label"><a 
 id="x1-7095r12"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">ingress</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-7096r13"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">from_port</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">22</span></span> 
<span class="label"><a 
 id="x1-7097r14"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">to_port</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">22</span></span> 
<span class="label"><a 
 id="x1-7098r15"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">protocol</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">tcp</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-7099r16"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">cidr_blocks</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">[</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">0.0.0.0/0</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">]</span></span> 
<span class="label"><a 
 id="x1-7100r17"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">}</span></span> 
<span class="label"><a 
 id="x1-7101r18"></a></span> 
<span class="label"><a 
 id="x1-7102r19"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">egress</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-7103r20"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">from_port</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">0</span></span> 
<span class="label"><a 
 id="x1-7104r21"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">to_port</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">0</span></span> 
<span class="label"><a 
 id="x1-7105r22"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">protocol</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">-1</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-7106r23"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">cidr_blocks</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">[</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">0.0.0.0/0</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">]</span></span> 
<span class="label"><a 
 id="x1-7107r24"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">}</span></span> 
<span class="label"><a 
 id="x1-7108r25"></a></span><span style="color:#000000"><span 
class="ectt-1200">}</span></span>
 
<span class="label"><a 
 id="x1-7109r26"></a></span></pre>
   </div>
<!--l. 540--><p class="indent" >   Finally, if we run the <span 
class="ectt-1200">terraform apply </span>command, it should provision an ECS cluster with a service that will
then create one ECS container based on our task description.
</p><!--l. 543--><p class="indent" >   Note that we are doing something a bit weird in this deployment. Normally ECS expects multiple instances of
containers, so it naturally expects a load balancer. This makes it difficult for us to discover the public IP of our
single instance using Terraform. Instead, you will need to use the AWS Console to find the public IP
address.
</p><!--l. 549--><p class="indent" >   This is an opportunity for you to explore the ECS interface and find the task, within the service, within the
cluster that we have provisioned.
   
                                                                                                    
                                                                                                    
</p>
   <h4 class="subsectionHead"><span class="titlemark">5.3    </span> <a 
 id="x1-80005.3"></a>EC2 Deployment</h4>
   <div class="tcolorbox tcolorbox" id="tcolobox-5">     
<div class="tcolorbox-title">
<!--l. 563--><p class="indent" >   Aside</p></div> 
<div class="tcolorbox-content"><!--l. 563--><p class="noindent" >The deployment diagram below is what it would look like, if we deployed our application to an EC2
instance. As you can see, ECS provides us with features to manage services and tasks for us.  </p> 
</div> 
</div>
   <hr class="figure" /><div class="figure" 
>
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    
<!--l. 566--><p class="noindent" ><img 
src="diagrams/ec2deployment.png" alt="PIC"  
width="525" height="-1152"  />
                                                                                                    
                                                                                                    
</p>
   </div><hr class="endfigure" />
   
   <h4 class="subsectionHead"><span class="titlemark">5.4    </span> <a 
 id="x1-90005.4"></a>EKS / K8S</h4>
<!--l. 571--><p class="noindent" >Amazon Elastic Kubernetes Service (EKS) is a platform to run
<a 
href="https://kubernetes.io/" >Kubernetes</a><span class="footnote-mark"><a 
href="#fn3x0" id="fn3x0-bk"><sup class="textsuperscript">3</sup></a></span><a 
 id="x1-9001f3"></a>
(K8S) clusters. We recommend, when you have time, that you look at Kubernetes as it is widely used in
industry.
   
</p>
   <h3 class="sectionHead"><span class="titlemark">6    </span> <a 
 id="x1-100006"></a>Hosting TaskOverflow Images</h3>
<!--l. 577--><p class="noindent" >When we last deployed a container on AWS, we used an existing hosted image. Now, we will be developing our
own image, so we will need a mechanism to host the image. For this, we will use AWS ECR, Docker, and Terraform.
AWS ECR is the Elastic Container Registry. It is a container registry like DockerHub or GitHub. We can use it to host
our image. The steps below use Terraform to
</p><!--l. 585--><p class="indent" >
      </p><ol  class="enumerate1" >
<li 
  class="enumerate" id="x1-10002x1">
      <!--l. 586--><p class="noindent" >create an ECR repository for our image,
      </p></li>
<li 
  class="enumerate" id="x1-10004x2">
      <!--l. 587--><p class="noindent" >build our Docker image, and
      </p></li>
<li 
  class="enumerate" id="x1-10006x3">
      <!--l. 588--><p class="noindent" >push our Docker image.</p></li></ol>
   <div class="tcolorbox tcolorbox" id="tcolobox-6">     
<div class="tcolorbox-title">
<!--l. 599--><p class="indent" >   Info</p></div> 
<div class="tcolorbox-content"><!--l. 599--><p class="noindent" >This is a non-standard process. As you may have seen in the DevOps tutorial, we would ordinarily
like our code commits to trigger a CI/CD pipeline which builds the images.<br 
class="newline" />
</p><!--l. 599--><p class="noindent" >If  you  would  like,  you  can  use  GitHub  actions  to  build  and  push  your  container  to  the  GitHub
container registry and authenticate when you pull the image. However, using ECR simplifies the
process, despite the oddities introduced by having a non-persistent ECR repository.  </p> 
</div> 
</div>
   
<!--l. 601--><p class="noindent" ><span class="paragraphHead"><a 
 id="x1-11000"></a><span 
class="Cabin-Bold-tlf-t1-x-x-120">Getting Started</span></span>
                                                                                                    
                                                                                                    
      </p><ol  class="enumerate1" >
<li 
  class="enumerate" id="x1-11002x1">
      <!--l. 604--><p class="noindent" >Using the GitHub Classroom link for this practical provided on Edstem, create a repository to work
      within.
      </p></li>
<li 
  class="enumerate" id="x1-11004x2">
      <!--l. 605--><p class="noindent" >Install Terraform, if it is not already installed, as it will be required again this week and in later weeks.
      </p></li>
<li 
  class="enumerate" id="x1-11006x3">
      <!--l. 606--><p class="noindent" >Start your Learner Lab and copy the AWS Learner Lab credentials into a credentials file in the root
      of the repository.</p></li></ol>
   
<!--l. 609--><p class="noindent" ><span class="paragraphHead"><a 
 id="x1-12000"></a><span 
class="Cabin-Bold-tlf-t1-x-x-120">What&#8217;s New</span></span>
   We are starting again with our todo application from roughly where we left off in the week 3
practical. We have added a new directory <span 
class="ectt-1200">todo/app </span>that has the static HTML files for the TaskOverflow
website and added a route to serve these files. We have also created a production version of the
server that uses gunicorn, the <span 
class="ectt-1200">bin </span>directory is used by this image. Our original Docker image is now in
<span 
class="ectt-1200">Dockerfile.dev</span>.<br 
class="newline" />
</p><!--l. 617--><p class="indent" >   We will setup our initial Terraform configuration. Note that now we introduce a new required provider. This
provider is for Docker.
</p><!--l. 621--><p class="indent" >   </p><div class="framedenv" id="code-1">
<!--l. 621--><p class="indent" >   <span 
class="ectt-1200">» cat main.tf</span> </p></div>   <div class="framedenv" id="code-1"><!--l. 621--><pre class="listings" id="listing-13"><span class="label"><a 
 id="x1-12001r1"></a></span><span style="color:#006699"><span 
class="ectt-1200">terraform</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-12002r2"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#006699"><span 
class="ectt-1200">required_providers</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-12003r3"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">aws</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-12004r4"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">source</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">hashicorp</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">aws</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-12005r5"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">version</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">~&#x003E;</span></span><span style="color:#669900"> </span><span style="color:#669900"><span 
class="ectt-1200">5.0</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-12006r6"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">}</span></span> 
<span class="label"><a 
 id="x1-12007r7"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">docker</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-12008r8"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">source</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">kreuzwerker</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">docker</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-12009r9"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">version</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">3.0.2</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-12010r10"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">}</span></span> 
<span class="label"><a 
 id="x1-12011r11"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">}</span></span> 
<span class="label"><a 
 id="x1-12012r12"></a></span><span style="color:#000000"><span 
class="ectt-1200">}</span></span> 
<span class="label"><a 
 id="x1-12013r13"></a></span> 
<span class="label"><a 
 id="x1-12014r14"></a></span><span style="color:#006699"><span 
class="ectt-1200">provider</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">aws</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-12015r15"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">region</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">us</span></span><span style="color:#669900"><span 
class="ectt-1200">-</span></span><span style="color:#669900"><span 
class="ectt-1200">east</span></span><span style="color:#669900"><span 
class="ectt-1200">-1</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-12016r16"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">shared_credentials_files</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">[</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">./</span></span><span style="color:#669900"><span 
class="ectt-1200">credentials</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">]</span></span> 
<span class="label"><a 
 id="x1-12017r17"></a></span><span style="color:#000000"><span 
class="ectt-1200">}</span></span>
 
<span class="label"><a 
 id="x1-12018r18"></a></span></pre>
   </div>
<!--l. 641--><p class="indent" >   As with our AWS provider, when we initially configure the provider, we want to authenticate so that we can
later push to our registry using the Docker provider. We will use the <span 
class="ectt-1200">aws_ecr_authorization_token </span>data block to
get appropriate ECR credentials for Docker.
</p><!--l. 646--><p class="indent" >   </p><div class="framedenv" id="code-1">
<!--l. 646--><p class="indent" >   <span 
class="ectt-1200">» cat main.tf</span> </p></div>   <div class="framedenv" id="code-1"><!--l. 646--><pre class="listings" id="listing-14"><span class="label"><a 
 id="x1-12019r1"></a></span><span style="color:#006699"><span 
class="ectt-1200">data</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">aws_ecr_authorization_token</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">ecr_token</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{}</span></span> 
<span class="label"><a 
 id="x1-12020r2"></a></span> 
<span class="label"><a 
 id="x1-12021r3"></a></span><span style="color:#006699"><span 
class="ectt-1200">provider</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">docker</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-12022r4"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">registry_auth</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-12023r5"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">address</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#006699"><span 
class="ectt-1200">data</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">aws_ecr_authorization_token</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">ecr_token</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">proxy_endpoint</span></span> 
<span class="label"><a 
 id="x1-12024r6"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">username</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#006699"><span 
class="ectt-1200">data</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">aws_ecr_authorization_token</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">ecr_token</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">user_name</span></span> 
<span class="label"><a 
 id="x1-12025r7"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">password</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#006699"><span 
class="ectt-1200">data</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">aws_ecr_authorization_token</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">ecr_token</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">password</span></span> 
<span class="label"><a 
 id="x1-12026r8"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">}</span></span> 
<span class="label"><a 
 id="x1-12027r9"></a></span><span style="color:#000000"><span 
class="ectt-1200">}</span></span>
 
<span class="label"><a 
 id="x1-12028r10"></a></span></pre>
   </div>
<!--l. 658--><p class="indent" >   We need to use Terraform to create an ECR repository to push to.
</p><!--l. 660--><p class="indent" >   </p><div class="framedenv" id="code-1">
<!--l. 660--><p class="indent" >   <span 
class="ectt-1200">» cat main.tf</span> </p></div>   <div class="framedenv" id="code-1"><!--l. 660--><pre class="listings" id="listing-15"><span class="label"><a 
 id="x1-12029r1"></a></span><span style="color:#006699"><span 
class="ectt-1200">resource</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">aws_ecr_repository</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">taskoverflow</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-12030r2"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">name</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">taskoverflow</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-12031r3"></a></span><span style="color:#000000"><span 
class="ectt-1200">}</span></span>
 
<span class="label"><a 
 id="x1-12032r4"></a></span></pre>
   </div>
<!--l. 666--><p class="noindent" >The URL for containers in the ECR follow the format below:
</p><!--l. 669--><p class="indent" >   <a 
href="{ACCOUNT_ID}.dkr.ecr.{REGION}.amazonaws.com/{REPOSITORY_NAME}" class="url" ><span 
class="ectt-1200">{ACCOUNT_ID}.dkr.ecr.{REGION}.amazonaws.com/{REPOSITORY_NAME}</span></a>
</p><!--l. 671--><p class="indent" >   Remember &#8212; to push to a container registry we need a local container whose tag matches the remote URL.
We could then create and push the container locally with:
</p>
   <div class="framedenv" id="code-1">
                                                                                                    
                                                                                                    
<!--l. 675--><pre class="listings" id="listing-16"><span class="label"><a 
 id="x1-12033r1"></a></span><span style="color:#000000"><span 
class="ectt-1200">docker</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">build</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">t</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span><span style="color:#000000"><span 
class="ectt-1200">ACCOUNT_ID</span></span><span style="color:#000000"><span 
class="ectt-1200">}.</span></span><span style="color:#000000"><span 
class="ectt-1200">dkr</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">ecr</span></span><span style="color:#000000"><span 
class="ectt-1200">.{</span></span><span style="color:#000000"><span 
class="ectt-1200">REGION</span></span><span style="color:#000000"><span 
class="ectt-1200">}.</span></span><span style="color:#000000"><span 
class="ectt-1200">amazonaws</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">com</span></span><span style="color:#000000"><span 
class="ectt-1200">/{</span></span><span style="color:#000000"><span 
class="ectt-1200">REPOSITORY_NAME</span></span><span style="color:#000000"><span 
class="ectt-1200">}</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">.</span></span> 
<span class="label"><a 
 id="x1-12034r2"></a></span><span style="color:#000000"><span 
class="ectt-1200">docker</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">push</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span><span style="color:#000000"><span 
class="ectt-1200">ACCOUNT_ID</span></span><span style="color:#000000"><span 
class="ectt-1200">}.</span></span><span style="color:#000000"><span 
class="ectt-1200">dkr</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">ecr</span></span><span style="color:#000000"><span 
class="ectt-1200">.{</span></span><span style="color:#000000"><span 
class="ectt-1200">REGION</span></span><span style="color:#000000"><span 
class="ectt-1200">}.</span></span><span style="color:#000000"><span 
class="ectt-1200">amazonaws</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">com</span></span><span style="color:#000000"><span 
class="ectt-1200">/{</span></span><span style="color:#000000"><span 
class="ectt-1200">REPOSITORY_NAME</span></span><span style="color:#000000"><span 
class="ectt-1200">}</span></span>
 
<span class="label"><a 
 id="x1-12035r3"></a></span></pre>
   </div>
<!--l. 680--><p class="indent" >   However, it would be easier if we could build and push this container from within Terraform. We can use the
Docker provider for this.
</p><!--l. 683--><p class="indent" >   </p><div class="framedenv" id="code-1">
<!--l. 683--><p class="indent" >   <span 
class="ectt-1200">» cat image.tf</span> </p></div>   <div class="framedenv" id="code-1"><!--l. 683--><pre class="listings" id="listing-17"><span class="label"><a 
 id="x1-12036r1"></a></span><span style="color:#006699"><span 
class="ectt-1200">resource</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">docker_image</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">taskoverflow</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-12037r2"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">name</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">$</span></span><span style="color:#669900"><span 
class="ectt-1200">{</span></span><span style="color:#669900"><span 
class="ectt-1200">aws_ecr_repository</span></span><span style="color:#669900"><span 
class="ectt-1200">.</span></span><span style="color:#669900"><span 
class="ectt-1200">taskoverflow</span></span><span style="color:#669900"><span 
class="ectt-1200">.</span></span><span style="color:#669900"><span 
class="ectt-1200">repository_url</span></span><span style="color:#669900"><span 
class="ectt-1200">}:</span></span><span style="color:#669900"><span 
class="ectt-1200">latest</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-12038r3"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">build</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-12039r4"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">context</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">.</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-12040r5"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">}</span></span> 
<span class="label"><a 
 id="x1-12041r6"></a></span><span style="color:#000000"><span 
class="ectt-1200">}</span></span> 
<span class="label"><a 
 id="x1-12042r7"></a></span> 
<span class="label"><a 
 id="x1-12043r8"></a></span><span style="color:#006699"><span 
class="ectt-1200">resource</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">docker_registry_image</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">taskoverflow</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-12044r9"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">name</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">docker_image</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">taskoverflow</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">name</span></span> 
<span class="label"><a 
 id="x1-12045r10"></a></span><span style="color:#000000"><span 
class="ectt-1200">}</span></span>
 
<span class="label"><a 
 id="x1-12046r11"></a></span></pre>
   </div>
<!--l. 696--><p class="indent" >   Notice that we are able to utilise the output of the ECR repository as the URL which resolves to the correct URL
for the image.
</p><!--l. 698--><p class="indent" >   If you execute <span 
class="ectt-1200">terraform plan</span>, it will probably report an inconsistent dependency. This is because we have
added a new provider and its dependency needs to be added to the lock file. Execute <span 
class="ectt-1200">terraform init -upgrade</span>
to do this.
</p><!--l. 702--><p class="indent" >   You can now <span 
class="ectt-1200">terraform apply </span>to push the container to the registry. Note that the Docker Engine / Daemon
must be running so Terraform can talk to it.
   
</p>
   <h3 class="likesectionHead"><a 
 id="x1-13000"></a>References</h3>
<!--l. 1--><p class="noindent" >
   </p><div class="thebibliography">
   <p class="bibitem" ><span class="biblabel">
 [1]<span class="bibsp">&#x00A0;&#x00A0;&#x00A0;</span></span><a 
 id="Xiac-notes"></a>B.&#x00A0;Webb,           &#8220;Infrastructure           as           code,&#8221;           February           2023.                                        
<a 
href="https://csse6400.uqcloud.net/handouts/iac.pdf" class="url" ><span 
class="ectt-1200">https://csse6400.uqcloud.net/handouts/iac.pdf</span></a>.
   </p>
   <p class="bibitem" ><span class="biblabel">
 [2]<span class="bibsp">&#x00A0;&#x00A0;&#x00A0;</span></span><a 
 id="Xdistributed1-slides"></a>B.&#x00A0;Webb     and     R.&#x00A0;Thomas,     &#8220;Distributed     systems     I     slides,&#8221;     March     2025.                   
<a 
href="https://csse6400.uqcloud.net/slides/distributed1.pdf" class="url" ><span 
class="ectt-1200">https://csse6400.uqcloud.net/slides/distributed1.pdf</span></a>.
</p>
   </div>
   <div class="footnotes"><a 
 id="x1-2006x1"></a>
<!--l. 48--><p class="noindent" ><span class="footnote-mark"><a 
href="#fn1x0-bk" id="fn1x0"><sup class="textsuperscript">1</sup></a></span><span 
class="Cabin-Regular-tlf-t1-">If you are using CodeSpaces, you will need to reinstall Terraform using the same steps as last week.</span></p><a 
 id="x1-5002x5"></a>
<!--l. 328--><p class="indent" >        <span class="footnote-mark"><a 
href="#fn2x0-bk" id="fn2x0"><sup class="textsuperscript">2</sup></a></span><span 
class="Cabin-Regular-tlf-t1-">If you are interested, the source code is available on GitHub </span><a 
href="https://github.com/csse6400/practical" class="url" ><span 
class="ectt-1000">https://github.com/csse6400/practical</span></a></p><a 
 id="x1-9002x5.4"></a>
<!--l. 571--><p class="indent" >   <span class="footnote-mark"><a 
href="#fn3x0-bk" id="fn3x0"><sup class="textsuperscript">3</sup></a></span><a 
href="https://kubernetes.io/" class="url" ><span 
class="ectt-1000">https://kubernetes.io/</span></a></p>                                                                      </div>
 
</body></html> 

                                                                                                    


