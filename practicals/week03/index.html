Last Updated on 2023/03/08     

<?xml version="1.0" encoding="iso-8859-1" ?> 
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">  
<!--http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd-->  
<html xmlns="http://www.w3.org/1999/xhtml"  
> 
<head> <title>Docker and Docker Compose</title> 
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /> 
<meta name="generator" content="TeX4ht (https://tug.org/tex4ht/)" /> 
<meta name="originator" content="TeX4ht (https://tug.org/tex4ht/)" /> 
<!-- fn-in,html,htex4ht,xhtml --> 
<meta name="src" content="main.tex" /> 
<link rel="stylesheet" type="text/css" href="main.css" /> 
<link rel="stylesheet" href="https://latex.now.sh/style.css"> 
<link rel="stylesheet" href="/notes.css"> 
<style>body {max-width: 100ch;} 
dl dd {text-align: left}</style> 
</head><body 
>
   <div class="maketitle"><a 
 id="Q1-1-1"></a>
_________________________________________________________________________________________________
<h2 class="titleHead">Docker and Docker Compose</h2>                                                    Software Architecture
   <div class="date" >March 8, 2023</div>                                                                                                                           <div class="author" >Evan Hughes &amp; Brae
Webb</div>
______________________________________________________________________________________________
   </div>
   <hr class="figure" /><div class="figure" 
>
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    
<div class="center" 
>
<!--l. 18--><p class="noindent" >
</p><!--l. 19--><p class="noindent" ><img 
src="images/docker.png" alt="PIC"  
width="28" height="28"  /></p></div>
                                                                                                    
                                                                                                    
   </div><hr class="endfigure" />
   <h3 class="sectionHead"><span class="titlemark">1    </span> <a 
 id="x1-10001"></a>This Week</h3>
<!--l. 24--><p class="noindent" >This week our goal is to: </p>
      <ul class="itemize1">
      <li class="itemize">
      <!--l. 26--><p class="noindent" >Gain hands on practice with Docker.
      </p></li>
      <li class="itemize">
      <!--l. 27--><p class="noindent" >Containerise our Todo application.
      </p></li>
      <li class="itemize">
      <!--l. 28--><p class="noindent" >Move to a PostgreSQL database from the SQLite database.</p></li></ul>
                                                                                                    
                                                                                                    
   <div class="tcolorbox tcolorbox" id="tcolobox-3">    
<div class="tcolorbox-title">
<!--l. 55--><p class="indent" >   Notice</p></div> 
<div class="tcolorbox-content"><h3 class="sectionHead"><span class="titlemark">2    </span> <a 
 id="x1-20002"></a>Installing Docker</h3>
<!--l. 55--><p class="noindent" >Before the practical class, please install Docker on your machine. Start the process of installing Docker
while your tutor runs through the first part of the practical.
</p><!--l. 55--><p class="noindent" >To install Docker on your Mac or Windows machine you can follow the instructions on the docker
website: <a 
href="https://docs.docker.com/get-docker/" class="url" ><span 
class="ectt-1200">https://docs.docker.com/get-docker/</span></a>. If you are using a Linux machine you can
install Docker using your package manager. For example on Ubuntu you can use the following
command:
</p>
<div class="framedenv" id="shaded*-1">
<!--l. 55-->
<pre class="lstlisting" id="listing-1"><span class="label"><a 
 id="x1-2001r1"></a></span><span style="color:#000000"><span 
class="ectt-1200">$</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">sudo</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">apt</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">get</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">install</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">docker</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">io</span></span><span 
class="ectt-1200">&#x00A0;</span></pre>
</div>
<div class="tcolorbox tcolorbox" id="tcolobox-1"> 
<div class="tcolorbox-title">
<!--l. 55--><p class="noindent" >Info</p></div> 
<div class="tcolorbox-content"><!--l. 55--><p class="noindent" >If  you  are  using  a  Linux  machine  you  may  need  to  add  your  user  to  the  docker  group  so
that you can run docker commands without sudo. While the docker website suggests using
docker-desktop for Linux, this course recommends using the native docker installation.  </p> 
</div> 
</div>
<div class="tcolorbox tcolorbox" id="tcolobox-2">    
<div class="tcolorbox-title">
<!--l. 55--><p class="noindent" >Info</p></div> 
<div class="tcolorbox-content"><!--l. 55--><p class="noindent" >The GitHub Codespaces environment has Docker and Docker-Compose installed.  </p> 
</div> 
</div>
 
</div> 
</div>
</p><!--l. 57--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">3    </span> <a 
 id="x1-30003"></a>Getting Started with Docker</h3>
<!--l. 59--><p class="noindent" >In the lectures we have delved into the world of containers and how they can be used to create a consistent
environment for our applications. Depending on the courses you have taken you may have been exposed to them
as either a user or a consumer, for instance if you have submitted assignments in CSSE1001 or CSSE2002 the
autograding uses Docker to run and test your code.
</p>
   <div class="tcolorbox tcolorbox" id="tcolobox-4">    
<div class="tcolorbox-title">
<!--l. 66--><p class="indent" >   Notice</p></div> 
<div class="tcolorbox-content"><!--l. 66--><p class="noindent" >This practical will assume you have not used Docker before but we will be skipping over some aspects
since its not needed for our purposes. Please watch the lecture for a foundational understanding of
container technology and terminology.  </p> 
</div> 
</div>
<!--l. 72--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">3.1    </span> <a 
 id="x1-40003.1"></a>Docker Images</h4>
<!--l. 75--><p class="noindent" >Docker images are the layers of files required to run containers. They are self contained environments that should
contain the depenedencies and code for any application. A common way to build an image is to use a
Dockerfile.
</p><!--l. 79--><p class="noindent" >
</p>
   <h5 class="subsubsectionHead"><span class="titlemark">3.1.1    </span> <a 
 id="x1-50003.1.1"></a>Dockerfile</h5>
                                                                                                    
                                                                                                    
<!--l. 81--><p class="noindent" >The Dockerfile is a plain text file with its own syntax that is used to describe the instructions for creating an image.
The series of instructions are run in order to create each layer of the image.
</p><!--l. 84--><p class="indent" >   A reference of all possible Dockerfile instructions can be found here: <a 
href="https://docs.docker.com/engine/reference/builder/" class="url" ><span 
class="ectt-1200">https://docs.docker.com/engine/reference/builder/</span></a>.
For the purposes of the course we will cover the core instructions, namely; <span 
class="ectt-1200">FROM</span>, <span 
class="ectt-1200">RUN</span>, <span 
class="ectt-1200">COPY</span>, <span 
class="ectt-1200">ADD</span>, <span 
class="ectt-1200">WORKDIR</span>, <span 
class="ectt-1200">CMD</span>, and
<span 
class="ectt-1200">ENTRYPOINT</span>.
</p>
<!--l. 88--><p class="noindent" ><span class="paragraphHead"><a 
 id="x1-6000"></a><span 
class="Cabin-Bold-tlf-t1-x-x-120">FROM</span></span>
   The FROM instruction should be the first instruction in your Dockerfile and specifies the base image for
subsequent instructions. If you want to start with an empty image, use the <span 
class="ectt-1200">scratch </span>image. Otherwise, you likely
want to start from an image that has a number of the common utilities pre-packaged.
</p><!--l. 94--><p class="indent" >   </p><div class="framedenv" id="code-1">
<!--l. 94--><p class="indent" >   <span 
class="ectt-1200">» cat Dockerfile</span> </p></div>   <div class="framedenv" id="code-1"><!--l. 94--><pre class="listings" id="listing-2"><span class="label"><a 
 id="x1-6001r1"></a></span><span style="color:#006699"><span 
class="ectt-1200">FROM</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">ubuntu</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"><span 
class="ectt-1200">latest</span></span>
 
<span class="label"><a 
 id="x1-6002r2"></a></span></pre>
   </div>
<!--l. 98--><p class="indent" >   In this case we are using the latest version of ubuntu. This ubuntu is a very minimal image that is intended to
be used as a starting point and is itself an image. Unless you are working in an obscure language, you will often
want to start from an image that already has your language or framework installed. For example, you can start
from the <span 
class="ectt-1200">nodejs </span>image, or the <span 
class="ectt-1200">python </span>image.
</p>
<!--l. 106--><p class="noindent" ><span class="paragraphHead"><a 
 id="x1-7000"></a><span 
class="Cabin-Bold-tlf-t1-x-x-120">RUN</span></span>
   The RUN instruction will execute commands on top of the current layer and store the changes as a new layer.
The layer will be used for the next step in the Dockerfile.
</p><!--l. 110--><p class="indent" >   </p><div class="framedenv" id="code-1">
<!--l. 110--><p class="indent" >   <span 
class="ectt-1200">» cat Dockerfile</span> </p></div>   <div class="framedenv" id="code-1"><!--l. 110--><pre class="listings" id="listing-3"><span class="label"><a 
 id="x1-7001r1"></a></span><span style="color:#006699"><span 
class="ectt-1200">FROM</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">ubuntu</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"><span 
class="ectt-1200">latest</span></span> 
<span class="label"><a 
 id="x1-7002r2"></a></span> 
<span class="label"><a 
 id="x1-7003r3"></a></span><span style="color:#33997E"><span 
class="ectt-1200">#</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">Installing</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">dependencies</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">for</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">running</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">a</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">python</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">application</span></span> 
<span class="label"><a 
 id="x1-7004r4"></a></span><span style="color:#006699"><span 
class="ectt-1200">RUN</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">apt</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">get</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">update</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">&amp;&amp;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">apt</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">get</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">install</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">y</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">python3</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">python3</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">pip</span></span>
 
<span class="label"><a 
 id="x1-7005r5"></a></span></pre>
   </div>
<!--l. 117--><p class="indent" >   The RUN instruction allows us to execute commands when the container is built. The example above is
installing python dependencies for a fake application.  </p> <div class="tcolorbox tcolorbox" id="tcolobox-5">    
<div class="tcolorbox-title">
<!--l. 124--><p class="indent" >   Info</p></div> 
<div class="tcolorbox-content"><!--l. 124--><p class="noindent" >When using the <span 
class="ectt-1200">apt </span>package manager on the ubuntu image, remember that the package indexes
are removed to reduce the size of the base image.
</p><!--l. 124--><p class="noindent" >We&#8217;ve made a mistake in the above example resulting in our image size being larger than necessary,
can you spot it?  </p> 
</div> 
</div>
<!--l. 126--><p class="noindent" ><span class="paragraphHead"><a 
 id="x1-8000"></a><span 
class="Cabin-Bold-tlf-t1-x-x-120">COPY</span></span>
   The COPY instruction copies files or directories from &#x003C;src&#x003E; on the host machine where the image is being built
to the filesystem of the container at the path &#x003C;dest&#x003E;.
</p><!--l. 129--><p class="indent" >   </p><div class="framedenv" id="code-1">
<!--l. 129--><p class="indent" >   <span 
class="ectt-1200">» cat Dockerfile</span> </p></div>   <div class="framedenv" id="code-1"><!--l. 129--><pre class="listings" id="listing-4"><span class="label"><a 
 id="x1-8001r1"></a></span><span style="color:#006699"><span 
class="ectt-1200">FROM</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">ubuntu</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"><span 
class="ectt-1200">latest</span></span> 
<span class="label"><a 
 id="x1-8002r2"></a></span> 
<span class="label"><a 
 id="x1-8003r3"></a></span><span style="color:#33997E"><span 
class="ectt-1200">#</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">Installing</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">dependencies</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">for</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">running</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">a</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">python</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">application</span></span> 
<span class="label"><a 
 id="x1-8004r4"></a></span><span style="color:#006699"><span 
class="ectt-1200">RUN</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">apt</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">get</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">update</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">&amp;&amp;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">apt</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">get</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">install</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">y</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">python3</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">python3</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">pip</span></span> 
<span class="label"><a 
 id="x1-8005r5"></a></span> 
<span class="label"><a 
 id="x1-8006r6"></a></span><span style="color:#33997E"><span 
class="ectt-1200">#</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">Copying</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">our</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">application</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">into</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">the</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">container</span></span> 
<span class="label"><a 
 id="x1-8007r7"></a></span><span style="color:#006699"><span 
class="ectt-1200">COPY</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">fan</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">club</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">runner</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">app</span></span>
 
<span class="label"><a 
 id="x1-8008r8"></a></span></pre>
   </div>
<!--l. 139--><p class="indent" >   The COPY instruction is one of the simplier ways to put resources into the container. Be aware that when you
COPY files into the container they will exist in a layer forever. The following example will still expose the
<span 
class="ectt-1200">secrets.txt </span>file even though we removed it in another layer.
</p><!--l. 143--><p class="indent" >   </p><div class="framedenv" id="code-1">
<!--l. 143--><p class="indent" >   <span 
class="ectt-1200">» cat Dockerfile</span> </p></div>   <div class="framedenv" id="code-1"><!--l. 143--><pre class="listings" id="listing-5"><span class="label"><a 
 id="x1-8009r1"></a></span><span style="color:#006699"><span 
class="ectt-1200">FROM</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">ubuntu</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"><span 
class="ectt-1200">latest</span></span> 
<span class="label"><a 
 id="x1-8010r2"></a></span> 
<span class="label"><a 
 id="x1-8011r3"></a></span><span style="color:#33997E"><span 
class="ectt-1200">#</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">Installing</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">dependencies</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">for</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">running</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">a</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">python</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">application</span></span> 
<span class="label"><a 
 id="x1-8012r4"></a></span><span style="color:#006699"><span 
class="ectt-1200">RUN</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">apt</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">get</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">update</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">&amp;&amp;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">apt</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">get</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">install</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">y</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">python3</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">python3</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">pip</span></span> 
<span class="label"><a 
 id="x1-8013r5"></a></span> 
<span class="label"><a 
 id="x1-8014r6"></a></span><span style="color:#33997E"><span 
class="ectt-1200">#</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">Copying</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">our</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">application</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">into</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">the</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">container</span></span> 
<span class="label"><a 
 id="x1-8015r7"></a></span><span style="color:#006699"><span 
class="ectt-1200">COPY</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">fan</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">club</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">runner</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">app</span></span> 
<span class="label"><a 
 id="x1-8016r8"></a></span> 
<span class="label"><a 
 id="x1-8017r9"></a></span><span style="color:#33997E"><span 
class="ectt-1200">#</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">Removing</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">the</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">secrets</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">file</span></span> 
<span class="label"><a 
 id="x1-8018r10"></a></span><span style="color:#006699"><span 
class="ectt-1200">RUN</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">rm</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">app</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">secrets</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">txt</span></span>
 
<span class="label"><a 
 id="x1-8019r11"></a></span></pre>
                                                                                                    
                                                                                                    
   </div>
<!--l. 156--><p class="noindent" ><span class="paragraphHead"><a 
 id="x1-9000"></a><span 
class="Cabin-Bold-tlf-t1-x-x-120">ADD</span></span>
   The ADD instruction copies files, directories, or remote file URLs from &#x003C;src&#x003E; to the filesystem of the image at
the path &#x003C;dest&#x003E;.
</p><!--l. 159--><p class="indent" >   ADD can behave like COPY but it can also pull in files from remote locations and extract tars. This can be
handy if your application requires external static files and you dont want to store them in your git
repository. Though the ADD command is usually not recommended and is often replaced with curl or
wget.
</p>
   <div class="framedenv" id="code-1">
<!--l. 163--><pre class="listings" id="listing-6"><span class="label"><a 
 id="x1-9001r1"></a></span><span style="color:#006699"><span 
class="ectt-1200">ADD</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">https</span></span><span style="color:#000000"><span 
class="ectt-1200">://</span></span><span style="color:#000000"><span 
class="ectt-1200">csse6400</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">uqcloud</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">net</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">slides</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">containers</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">pdf</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">.</span></span>
 
<span class="label"><a 
 id="x1-9002r2"></a></span></pre>
   </div>   <div class="framedenv" id="code-1">
<!--l. 166--><pre class="listings" id="listing-7"><span class="label"><a 
 id="x1-9003r1"></a></span><span style="color:#006699"><span 
class="ectt-1200">RUN</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">curl</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">https</span></span><span style="color:#000000"><span 
class="ectt-1200">://</span></span><span style="color:#000000"><span 
class="ectt-1200">csse6400</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">uqcloud</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">net</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">slides</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">containers</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">pdf</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">o</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">containers</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">pdf</span></span>
 
<span class="label"><a 
 id="x1-9004r2"></a></span></pre>
   </div>
<!--l. 170--><p class="noindent" ><span class="paragraphHead"><a 
 id="x1-10000"></a><span 
class="Cabin-Bold-tlf-t1-x-x-120">WORKDIR</span></span>
   The WORKDIR instruction sets the working directory for any subsequent RUN, CMD, ENTRYPOINT, COPY, or
ADD instruction. If the WORKDIR does not exist, it will be created even if it is not used in any subsequent
Dockerfile instruction. This instruction is a readability feature to help you reduce the amount of moving around
within the container.
</p><!--l. 175--><p class="indent" >   </p><div class="framedenv" id="code-1">
<!--l. 175--><p class="indent" >   <span 
class="ectt-1200">» cat Dockerfile</span> </p></div>   <div class="framedenv" id="code-1"><!--l. 175--><pre class="listings" id="listing-8"><span class="label"><a 
 id="x1-10001r1"></a></span><span style="color:#006699"><span 
class="ectt-1200">FROM</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">ubuntu</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"><span 
class="ectt-1200">latest</span></span> 
<span class="label"><a 
 id="x1-10002r2"></a></span> 
<span class="label"><a 
 id="x1-10003r3"></a></span><span style="color:#33997E"><span 
class="ectt-1200">#</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">Installing</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">dependencies</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">for</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">running</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">a</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">python</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">application</span></span> 
<span class="label"><a 
 id="x1-10004r4"></a></span><span style="color:#006699"><span 
class="ectt-1200">RUN</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">apt</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">get</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">update</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">&amp;&amp;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">apt</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">get</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">install</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">y</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">python3</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">python3</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">pip</span></span> 
<span class="label"><a 
 id="x1-10005r5"></a></span> 
<span class="label"><a 
 id="x1-10006r6"></a></span><span style="color:#33997E"><span 
class="ectt-1200">#</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">Setting</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">the</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">working</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">directory</span></span> 
<span class="label"><a 
 id="x1-10007r7"></a></span><span style="color:#006699"><span 
class="ectt-1200">WORKDIR</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">app</span></span> 
<span class="label"><a 
 id="x1-10008r8"></a></span> 
<span class="label"><a 
 id="x1-10009r9"></a></span><span style="color:#33997E"><span 
class="ectt-1200">#</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">Copying</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">our</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">application</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">into</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">the</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">container</span></span> 
<span class="label"><a 
 id="x1-10010r10"></a></span><span style="color:#006699"><span 
class="ectt-1200">COPY</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">fan</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">club</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">runner</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">.</span></span>
 
<span class="label"><a 
 id="x1-10011r11"></a></span></pre>
   </div>
<!--l. 189--><p class="noindent" ><span class="paragraphHead"><a 
 id="x1-11000"></a><span 
class="Cabin-Bold-tlf-t1-x-x-120">ENTRYPOINT</span></span>
   The ENTRYPOINT instruction allows you to configure what process is executed when a container is
run.
</p><!--l. 192--><p class="indent" >   </p><div class="framedenv" id="code-1">
<!--l. 192--><p class="indent" >   <span 
class="ectt-1200">» cat Dockerfile</span> </p></div>   <div class="framedenv" id="code-1"><!--l. 192--><pre class="listings" id="listing-9"><span class="label"><a 
 id="x1-11001r1"></a></span><span style="color:#006699"><span 
class="ectt-1200">FROM</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">ubuntu</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"><span 
class="ectt-1200">latest</span></span> 
<span class="label"><a 
 id="x1-11002r2"></a></span> 
<span class="label"><a 
 id="x1-11003r3"></a></span><span style="color:#33997E"><span 
class="ectt-1200">#</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">Installing</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">dependencies</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">for</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">running</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">a</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">python</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">application</span></span> 
<span class="label"><a 
 id="x1-11004r4"></a></span><span style="color:#006699"><span 
class="ectt-1200">RUN</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">apt</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">get</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">update</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">&amp;&amp;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">apt</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">get</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">install</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">y</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">python3</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">python3</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">pip</span></span> 
<span class="label"><a 
 id="x1-11005r5"></a></span> 
<span class="label"><a 
 id="x1-11006r6"></a></span><span style="color:#33997E"><span 
class="ectt-1200">#</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">Setting</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">the</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">working</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">directory</span></span> 
<span class="label"><a 
 id="x1-11007r7"></a></span><span style="color:#006699"><span 
class="ectt-1200">WORKDIR</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">app</span></span> 
<span class="label"><a 
 id="x1-11008r8"></a></span> 
<span class="label"><a 
 id="x1-11009r9"></a></span><span style="color:#33997E"><span 
class="ectt-1200">#</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">Copying</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">our</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">application</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">into</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">the</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">container</span></span> 
<span class="label"><a 
 id="x1-11010r10"></a></span><span style="color:#006699"><span 
class="ectt-1200">COPY</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">fan</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">club</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">runner</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">.</span></span> 
<span class="label"><a 
 id="x1-11011r11"></a></span> 
<span class="label"><a 
 id="x1-11012r12"></a></span><span style="color:#33997E"><span 
class="ectt-1200">#</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">Setting</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">the</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">default</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">command</span></span> 
<span class="label"><a 
 id="x1-11013r13"></a></span><span style="color:#006699"><span 
class="ectt-1200">ENTRYPOINT</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">[</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">python3</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">fan</span></span><span style="color:#669900"><span 
class="ectt-1200">-</span></span><span style="color:#669900"><span 
class="ectt-1200">club</span></span><span style="color:#669900"><span 
class="ectt-1200">-</span></span><span style="color:#669900"><span 
class="ectt-1200">runner</span></span><span style="color:#669900"><span 
class="ectt-1200">.</span></span><span style="color:#669900"><span 
class="ectt-1200">py</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">]</span></span>
 
<span class="label"><a 
 id="x1-11014r14"></a></span></pre>
   </div>
<!--l. 208--><p class="indent" >   The ENTRYPOINT instruction is the executable that will be run when the container starts. The CMD
instruction accompanises the ENTRYPOINT and is the default arguments that will be passed to the
ENTRYPOINT.
</p>
   <div class="framedenv" id="code-1">
<!--l. 211--><pre class="listings" id="listing-10"><span class="label"><a 
 id="x1-11015r1"></a></span><span style="color:#000000"><span 
class="ectt-1200">&#x003E;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">docker</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">build</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">t</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">fan</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">club</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">.</span></span> 
<span class="label"><a 
 id="x1-11016r2"></a></span><span style="color:#000000"><span 
class="ectt-1200">&#x003E;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">docker</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">run</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"><span 
class="ectt-1200">rm</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">fan</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">clib</span></span>
 
<span class="label"><a 
 id="x1-11017r3"></a></span></pre>
   </div>
<!--l. 216--><p class="indent" >   example output:
</p>
   <div class="framedenv" id="code-1">
                                                                                                    
                                                                                                    
<!--l. 218--><pre class="listings" id="listing-11"><span class="label"><a 
 id="x1-11018r1"></a></span><span style="color:#000000"><span 
class="ectt-1200">Richard</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">Thomas</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">Fan</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">Club</span></span><span style="color:#000000"><span 
class="ectt-1200">!</span></span>
 
<span class="label"><a 
 id="x1-11019r2"></a></span></pre>
   </div>
<!--l. 222--><p class="noindent" ><span class="paragraphHead"><a 
 id="x1-12000"></a><span 
class="Cabin-Bold-tlf-t1-x-x-120">CMD</span></span>
   CMD provides defaults for an executing container.
</p><!--l. 225--><p class="indent" >   </p><div class="framedenv" id="code-1">
<!--l. 225--><p class="indent" >   <span 
class="ectt-1200">» cat Dockerfile</span> </p></div>   <div class="framedenv" id="code-1"><!--l. 225--><pre class="listings" id="listing-12"><span class="label"><a 
 id="x1-12001r1"></a></span><span style="color:#006699"><span 
class="ectt-1200">FROM</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">ubuntu</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"><span 
class="ectt-1200">latest</span></span> 
<span class="label"><a 
 id="x1-12002r2"></a></span> 
<span class="label"><a 
 id="x1-12003r3"></a></span><span style="color:#33997E"><span 
class="ectt-1200">#</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">Installing</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">dependencies</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">for</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">running</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">a</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">python</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">application</span></span> 
<span class="label"><a 
 id="x1-12004r4"></a></span><span style="color:#006699"><span 
class="ectt-1200">RUN</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">apt</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">get</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">update</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">&amp;&amp;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">apt</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">get</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">install</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">y</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">python3</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">python3</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">pip</span></span> 
<span class="label"><a 
 id="x1-12005r5"></a></span> 
<span class="label"><a 
 id="x1-12006r6"></a></span><span style="color:#33997E"><span 
class="ectt-1200">#</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">Setting</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">the</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">working</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">directory</span></span> 
<span class="label"><a 
 id="x1-12007r7"></a></span><span style="color:#006699"><span 
class="ectt-1200">WORKDIR</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">app</span></span> 
<span class="label"><a 
 id="x1-12008r8"></a></span> 
<span class="label"><a 
 id="x1-12009r9"></a></span><span style="color:#33997E"><span 
class="ectt-1200">#</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">Copying</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">our</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">application</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">into</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">the</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">container</span></span> 
<span class="label"><a 
 id="x1-12010r10"></a></span><span style="color:#006699"><span 
class="ectt-1200">COPY</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">fan</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">club</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">runner</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">.</span></span> 
<span class="label"><a 
 id="x1-12011r11"></a></span> 
<span class="label"><a 
 id="x1-12012r12"></a></span><span style="color:#33997E"><span 
class="ectt-1200">#</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">Setting</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">the</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">default</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">command</span></span> 
<span class="label"><a 
 id="x1-12013r13"></a></span><span style="color:#006699"><span 
class="ectt-1200">ENTRYPOINT</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">[</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">python3</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">fan</span></span><span style="color:#669900"><span 
class="ectt-1200">-</span></span><span style="color:#669900"><span 
class="ectt-1200">club</span></span><span style="color:#669900"><span 
class="ectt-1200">-</span></span><span style="color:#669900"><span 
class="ectt-1200">runner</span></span><span style="color:#669900"><span 
class="ectt-1200">.</span></span><span style="color:#669900"><span 
class="ectt-1200">py</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">]</span></span> 
<span class="label"><a 
 id="x1-12014r14"></a></span><span style="color:#006699"><span 
class="ectt-1200">CMD</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">[</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">--</span></span><span style="color:#669900"><span 
class="ectt-1200">help</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">]</span></span>
 
<span class="label"><a 
 id="x1-12015r15"></a></span></pre>
   </div>
<!--l. 242--><p class="indent" >   The CMD instruction sets default parameters for the ENTRYPOINT but is easily overriden when the container
is run. The following example will override the default <span 
class="ectt-1200">--help </span>argument and run the application with the
<span 
class="ectt-1200">--version </span>argument.
</p>
   <div class="framedenv" id="code-1">
<!--l. 245--><pre class="listings" id="listing-13"><span class="label"><a 
 id="x1-12016r1"></a></span><span style="color:#000000"><span 
class="ectt-1200">&#x003E;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">docker</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">run</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"><span 
class="ectt-1200">rm</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">fan</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">club</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"><span 
class="ectt-1200">version</span></span>
 
<span class="label"><a 
 id="x1-12017r2"></a></span></pre>
   </div>
   <div class="framedenv" id="code-1">
<!--l. 249--><pre class="listings" id="listing-14"><span class="label"><a 
 id="x1-12018r1"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">Fan</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">Club</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">Runner</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">1.0.0</span></span>
 
<span class="label"><a 
 id="x1-12019r2"></a></span></pre>
   </div>
   <div class="tcolorbox tcolorbox" id="tcolobox-6"> 
<div class="tcolorbox-title">
<!--l. 259--><p class="indent" >   Info</p></div> 
<div class="tcolorbox-content"><!--l. 259--><p class="noindent" >Occasionally you will see the CMD instruction used without the ENTRYPOINT instruction.
</p><!--l. 259--><p class="noindent" >This is only possible because the default ENTRYPOINT is <span 
class="ectt-1200">/bin/sh -c</span>.
</p><!--l. 259--><p class="noindent" >So <span 
class="ectt-1200">docker run &#8211;rm -it ubuntu /bin/bash </span>actually runs the process <span 
class="ectt-1200">/bin/sh -c /bin/bash</span>.  </p> 
</div> 
</div>
<!--l. 261--><p class="indent" >   This concludes the Dockerfile instructions required for this practical, however, there are more
that you may need to explore in the future. The full list of instructions can be found in the official
documentation:
</p><!--l. 265--><p class="indent" >   <a 
href="https://docs.docker.com/engine/reference/builder/" class="url" ><span 
class="ectt-1200">https://docs.docker.com/engine/reference/builder/</span></a>
</p><!--l. 267--><p class="noindent" >
</p>
   <h5 class="subsubsectionHead"><span class="titlemark">3.1.2    </span> <a 
 id="x1-130003.1.2"></a>Dockerfile Layers</h5>
<!--l. 269--><p class="noindent" >In the previous sections we used the RUN, ADD, and COPY to build an image to run our example application.
When the container is built, each of these instructions is run to create layer of the image. This means that if you
change a line in the Dockerfile you only need to rebuild the layers that come after the altered line. This is a huge
time saver when developing your Dockerfile.
</p><!--l. 274--><p class="indent" >   Let&#8217;s take a look at the Dockerfile below. In this Dockerfile, our application now has Python dependencies that
need to be installed.
</p><!--l. 277--><p class="indent" >   </p><div class="framedenv" id="code-1">
<!--l. 277--><p class="indent" >   <span 
class="ectt-1200">» cat Dockerfile</span> </p></div>   <div class="framedenv" id="code-1"><!--l. 277--><pre class="listings" id="listing-15"><span class="label"><a 
 id="x1-13001r1"></a></span><span style="color:#006699"><span 
class="ectt-1200">FROM</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">ubuntu</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"><span 
class="ectt-1200">latest</span></span> 
<span class="label"><a 
 id="x1-13002r2"></a></span> 
<span class="label"><a 
 id="x1-13003r3"></a></span><span style="color:#33997E"><span 
class="ectt-1200">#</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">Installing</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">dependencies</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">for</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">running</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">a</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">python</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">application</span></span> 
<span class="label"><a 
 id="x1-13004r4"></a></span><span style="color:#006699"><span 
class="ectt-1200">RUN</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">apt</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">get</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">update</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">&amp;&amp;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">apt</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">get</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">install</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">y</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">python3</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">python3</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">pip</span></span> 
<span class="label"><a 
 id="x1-13005r5"></a></span> 
<span class="label"><a 
 id="x1-13006r6"></a></span><span style="color:#33997E"><span 
class="ectt-1200">#</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">Copying</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">our</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">application</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">into</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">the</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">container</span></span> 
<span class="label"><a 
 id="x1-13007r7"></a></span><span style="color:#006699"><span 
class="ectt-1200">COPY</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">app</span></span> 
<span class="label"><a 
 id="x1-13008r8"></a></span> 
<span class="label"><a 
 id="x1-13009r9"></a></span><span style="color:#33997E"><span 
class="ectt-1200">#</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">Installing</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">our</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">application</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">dependencies</span></span> 
<span class="label"><a 
 id="x1-13010r10"></a></span><span style="color:#006699"><span 
class="ectt-1200">RUN</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">pip3</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">install</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">r</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">app</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">requirements</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">txt</span></span> 
<span class="label"><a 
 id="x1-13011r11"></a></span> 
<span class="label"><a 
 id="x1-13012r12"></a></span><span style="color:#33997E"><span 
class="ectt-1200">#</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">Setting</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">the</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">working</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">directory</span></span> 
<span class="label"><a 
 id="x1-13013r13"></a></span><span style="color:#006699"><span 
class="ectt-1200">WORKDIR</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">app</span></span> 
<span class="label"><a 
 id="x1-13014r14"></a></span> 
<span class="label"><a 
 id="x1-13015r15"></a></span><span style="color:#33997E"><span 
class="ectt-1200">#</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">Running</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">our</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">application</span></span> 
<span class="label"><a 
 id="x1-13016r16"></a></span><span style="color:#006699"><span 
class="ectt-1200">CMD</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">[</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">python3</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">src</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">app</span></span><span style="color:#669900"><span 
class="ectt-1200">.</span></span><span style="color:#669900"><span 
class="ectt-1200">py</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">]</span></span>
 
<span class="label"><a 
 id="x1-13017r17"></a></span></pre>
   </div>
<!--l. 296--><p class="indent" >   We are copying in the entire application directory before we install our requirements. We can improve this so
that we only copy in the requirements file and then install the requirements. This means that if we change our
application code we do not need to reinstall the requirements.
                                                                                                    
                                                                                                    
</p>
   <div class="framedenv" id="code-1">
<!--l. 300--><pre class="listings" id="listing-16"><span class="label"><a 
 id="x1-13018r1"></a></span><span style="color:#006699"><span 
class="ectt-1200">FROM</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">ubuntu</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"><span 
class="ectt-1200">latest</span></span> 
<span class="label"><a 
 id="x1-13019r2"></a></span> 
<span class="label"><a 
 id="x1-13020r3"></a></span><span style="color:#33997E"><span 
class="ectt-1200">#</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">Installing</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">dependencies</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">for</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">running</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">a</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">python</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">application</span></span> 
<span class="label"><a 
 id="x1-13021r4"></a></span><span style="color:#006699"><span 
class="ectt-1200">RUN</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">apt</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">get</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">update</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">&amp;&amp;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">apt</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">get</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">install</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">y</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">python3</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">python3</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">pip</span></span> 
<span class="label"><a 
 id="x1-13022r5"></a></span> 
<span class="label"><a 
 id="x1-13023r6"></a></span><span style="color:#33997E"><span 
class="ectt-1200">#</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">Copying</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">our</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">application</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">into</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">the</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">container</span></span> 
<span class="label"><a 
 id="x1-13024r7"></a></span><span style="color:#006699"><span 
class="ectt-1200">COPY</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">requirements</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">txt</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">app</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">requirements</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">txt</span></span> 
<span class="label"><a 
 id="x1-13025r8"></a></span> 
<span class="label"><a 
 id="x1-13026r9"></a></span><span style="color:#33997E"><span 
class="ectt-1200">#</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">Installing</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">our</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">application</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">dependencies</span></span> 
<span class="label"><a 
 id="x1-13027r10"></a></span><span style="color:#006699"><span 
class="ectt-1200">RUN</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">pip3</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">install</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">r</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">app</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">requirements</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">txt</span></span> 
<span class="label"><a 
 id="x1-13028r11"></a></span> 
<span class="label"><a 
 id="x1-13029r12"></a></span><span style="color:#33997E"><span 
class="ectt-1200">#</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">Copying</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">our</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">application</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">into</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">the</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">container</span></span> 
<span class="label"><a 
 id="x1-13030r13"></a></span><span style="color:#006699"><span 
class="ectt-1200">COPY</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">src</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">app</span></span> 
<span class="label"><a 
 id="x1-13031r14"></a></span> 
<span class="label"><a 
 id="x1-13032r15"></a></span><span style="color:#33997E"><span 
class="ectt-1200">#</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">Setting</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">the</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">working</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">directory</span></span> 
<span class="label"><a 
 id="x1-13033r16"></a></span><span style="color:#006699"><span 
class="ectt-1200">WORKDIR</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">app</span></span> 
<span class="label"><a 
 id="x1-13034r17"></a></span> 
<span class="label"><a 
 id="x1-13035r18"></a></span><span style="color:#33997E"><span 
class="ectt-1200">#</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">Running</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">our</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">application</span></span> 
<span class="label"><a 
 id="x1-13036r19"></a></span><span style="color:#006699"><span 
class="ectt-1200">CMD</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">[</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">python3</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">src</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">app</span></span><span style="color:#669900"><span 
class="ectt-1200">.</span></span><span style="color:#669900"><span 
class="ectt-1200">py</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">]</span></span>
 
<span class="label"><a 
 id="x1-13037r20"></a></span></pre>
   </div>
<!--l. 322--><p class="indent" >   For the containers we will be building this may not be a large issue, but once your project becomes larger
and you have more dependencies it can be a real time saver, so it is worth getting into the habit
early.
</p><!--l. 326--><p class="indent" >   To see the layers that are created when you build your Dockerfile you can use the following command:
</p>
   <div class="framedenv" id="code-1">
<!--l. 328--><pre class="listings" id="listing-17"><span class="label"><a 
 id="x1-13038r1"></a></span><span style="color:#000000"><span 
class="ectt-1200">docker</span></span><span style="color:#000000"> </span><span style="color:#006699"><span 
class="ectt-1200">history</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">&#x003C;</span></span><span style="color:#000000"><span 
class="ectt-1200">image</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">name</span></span><span style="color:#000000"><span 
class="ectt-1200">&#x003E;</span></span> 
<span class="label"><a 
 id="x1-13039r2"></a></span> 
<span class="label"><a 
 id="x1-13040r3"></a></span><span style="color:#33997E"><span 
class="ectt-1200">#</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">Example</span></span> 
<span class="label"><a 
 id="x1-13041r4"></a></span><span style="color:#000000"><span 
class="ectt-1200">docker</span></span><span style="color:#000000"> </span><span style="color:#006699"><span 
class="ectt-1200">history</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">ubuntu</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"><span 
class="ectt-1200">latest</span></span>
 
<span class="label"><a 
 id="x1-13042r5"></a></span></pre>
   </div>
   <div class="tcolorbox tcolorbox" id="tcolobox-7"> 
<div class="tcolorbox-title">
<!--l. 349--><p class="indent" >   Info</p></div> 
<div class="tcolorbox-content"><!--l. 349--><p class="noindent" >Note how the Ubuntu image cheats and copies the whole file structure in one layer rather than
running commands to build it incrementally.
</p><!--l. 349--><p class="noindent" >This is a common tactic in core images that the developers expect others to build on top of. One
reason being the 127 layer limit of Docker.
</p><!--l. 349--><p class="noindent" >For an example of a container that has left their whole thought process in the layers they produce,
try running the Doom image.
</p>
<div class="framedenv" id="shaded*-1">
<!--l. 349-->
<pre class="lstlisting" id="listing-18"><span class="label"><a 
 id="x1-13043r1"></a></span><span style="color:#000000"><span 
class="ectt-1200">$</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">docker</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">run</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">it</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"><span 
class="ectt-1200">rm</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">p</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">224:6901</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">e</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">VNC_PW</span></span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"><span 
class="ectt-1200">password</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">kasmweb</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">doom</span></span><span style="color:#000000"><span 
class="ectt-1200">:1.12.0</span></span><span 
class="ectt-1200">&#x00A0;</span></pre>
</div>
<!--l. 349--><p class="noindent" >You can then go to <a 
href="http://localhost:224" class="url" ><span 
class="ectt-1200">http://localhost:224</span></a> and connect to the VNC server with the username
<span 
class="ectt-1200">kasm_user </span>password <span 
class="ectt-1200">password</span>.
</p>
<div class="framedenv" id="shaded*-1">
<!--l. 349-->
<pre class="lstlisting" id="listing-19"><span class="label"><a 
 id="x1-13044r1"></a></span><span style="color:#000000"><span 
class="ectt-1200">$</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">docker</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">history</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">kasmweb</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">doom</span></span><span style="color:#000000"><span 
class="ectt-1200">:1.12.0</span></span><span 
class="ectt-1200">&#x00A0;</span></pre>
</div>  
</div> 
</div>
<!--l. 351--><p class="noindent" >
</p>
   <h5 class="subsubsectionHead"><span class="titlemark">3.1.3    </span> <a 
 id="x1-140003.1.3"></a>Image Registries</h5>
<!--l. 353--><p class="noindent" >When we introduced the Dockerfile we glossed over the details of from where <span 
class="ectt-1200">ubuntu:latest </span>is coming. This
image comes from a registry. There are a few different registries that you can use. The default registry is
hosted by Docker, this is the registry that is used when you do not specify a registry and is available at 
<a 
href="https://hub.docker.com/" class="url" ><span 
class="ectt-1200">https://hub.docker.com/</span></a>.
</p><!--l. 359--><p class="indent" >   There are also registries hosted by other companies such as Google and Amazon. These are available at
<a 
href="https://cloud.google.com/container-registry" class="url" ><span 
class="ectt-1200">https://cloud.google.com/container-registry</span></a> and <a 
href="https://aws.amazon.com/ecr/" class="url" ><span 
class="ectt-1200">https://aws.amazon.com/ecr/</span></a>
respectively.
                                                                                                    
                                                                                                    
</p><!--l. 362--><p class="indent" >   The Ubuntu image that we have been using is available at <a 
href="https://hub.docker.com/_/ubuntu" class="url" ><span 
class="ectt-1200">https://hub.docker.com/_/ubuntu</span></a>. When
browsing this page we can also see different tags that are available for this image, such as <span 
class="ectt-1200">latest </span>and
<span 
class="ectt-1200">20.04</span>.
</p><!--l. 366--><p class="indent" >   These tags are used to specify different versions of the image so you can pin your image instead of using the
<span 
class="ectt-1200">latest </span>tag, which will always point to the latest version of the image. Note that not all images will have different
tags or even a <span 
class="ectt-1200">latest </span>tag.
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                                                    
                                                                                                    
<a 
 id="x1-14001r1"></a>
                                                                                                    
                                                                                                    
<!--l. 372--><p class="noindent" ><img 
src="images/dockerhub.png" alt="PIC"  
width="315" height="315"  />
<br /> </p><div class="caption" 
><span class="id">Figure&#x00A0;1: </span><span  
class="content">Ubuntu image on DockerHub</span></div><!--tex4ht:label?: x1-14001r1 -->
                                                                                                    
                                                                                                    
   </div><hr class="endfigure" />
   <h4 class="subsectionHead"><span class="titlemark">3.2    </span> <a 
 id="x1-150003.2"></a>Docker Containers</h4>
<!--l. 379--><p class="noindent" >Docker containers are the runtime instantiation of a Docker image. They are the process that is running inside the
filesystem environment that has been created as an image.
</p><!--l. 382--><p class="indent" >   Once you have a suitable Docker image, you can start and run a Docker container by using the <span 
class="ectt-1200">docker run</span>
command.
</p><!--l. 385--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">3.3    </span> <a 
 id="x1-160003.3"></a>Running a Docker Container</h4>
<!--l. 387--><p class="noindent" >The below shows how to run the <span 
class="ectt-1200">hello-world </span>Docker image from DockerHub.
</p>
   <div class="framedenv" id="code-1">
<!--l. 389--><pre class="listings" id="listing-20"><span class="label"><a 
 id="x1-16001r1"></a></span><span style="color:#000000"><span 
class="ectt-1200">&#x003E;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">docker</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">run</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">hello</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">world</span></span> 
<span class="label"><a 
 id="x1-16002r2"></a></span><span style="color:#000000"><span 
class="ectt-1200">Hello</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">from</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">Docker</span></span><span style="color:#000000"><span 
class="ectt-1200">!</span></span> 
<span class="label"><a 
 id="x1-16003r3"></a></span><span style="color:#000000"><span 
class="ectt-1200">This</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">message</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">shows</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">that</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">your</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">installation</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">appears</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">to</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">be</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">working</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">correctly</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span>
 
<span class="label"><a 
 id="x1-16004r4"></a></span></pre>
   </div>
<!--l. 395--><p class="indent" >   It is worth nothing that if you do not use the <span 
class="ectt-1200">--rm </span>flag when using Docker run, the container will still exist after
it has finished running. You can view the running containers with:  </p><div class="framedenv" id="shaded*-1">
   <!--l. 398-->
<pre class="lstlisting" id="listing-21"><span class="label"><a 
 id="x1-16005r1"></a></span><span style="color:#000000"><span 
class="ectt-1200">$</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">docker</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">ps</span></span><span 
class="ectt-1200">&#x00A0;</span></pre>
   </div>
<!--l. 400--><p class="indent" >   You can view the running and stopped containers with:  </p><div class="framedenv" id="shaded*-1">
   <!--l. 401-->
<pre class="lstlisting" id="listing-22"><span class="label"><a 
 id="x1-16006r1"></a></span><span style="color:#000000"><span 
class="ectt-1200">$</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">docker</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">ps</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">a</span></span><span 
class="ectt-1200">&#x00A0;</span></pre>
   </div>
<!--l. 403--><p class="indent" >   We can modify our original command so that the container is not kept around after it terminates as show
below:  </p><div class="framedenv" id="shaded*-1">
   <!--l. 404-->
<pre class="lstlisting" id="listing-23"><span class="label"><a 
 id="x1-16007r1"></a></span><span style="color:#000000"><span 
class="ectt-1200">$</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">docker</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">run</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"><span 
class="ectt-1200">rm</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">hello</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">world</span></span><span 
class="ectt-1200">&#x00A0;</span></pre>
   </div>
<!--l. 406--><p class="indent" >   Another commonly useful set of arguments is <span 
class="ectt-1200">-i </span>and <span 
class="ectt-1200">-t </span>which combined allow you to interact with the
running container process using your terminal. If we want to enter a Ubuntu environment, then we would use the
combined flags, <span 
class="ectt-1200">-it </span>to do so.  </p><div class="framedenv" id="shaded*-1">
   <!--l. 409-->
<pre class="lstlisting" id="listing-24"><span class="label"><a 
 id="x1-16008r1"></a></span><span style="color:#000000"><span 
class="ectt-1200">$</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">docker</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">run</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"><span 
class="ectt-1200">rm</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">it</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">ubuntu</span></span><span 
class="ectt-1200">&#x00A0;</span></pre>
   </div>
<!--l. 411--><p class="indent" >   Next we will look at allowing the outside world into our isolated environment. Remember that containers live
in an isolated networking space and filesystem, however we often want to access files from our container or talk
to processes running on the network inside the container.
                                                                                                    
                                                                                                    
</p><!--l. 415--><p class="noindent" >
</p>
   <h5 class="subsubsectionHead"><span class="titlemark">3.3.1    </span> <a 
 id="x1-170003.3.1"></a>Docker Networking</h5>
<!--l. 417--><p class="noindent" >To allow our Docker containers to communicate via a network we can use the <span 
class="ectt-1200">-p </span>flag to specify ports we wish to
publish. For example, if we are running an application in our container on port 6400, we can make it accessible
outside of the container with:  </p><div class="framedenv" id="shaded*-1">
   <!--l. 420-->
<pre class="lstlisting" id="listing-25"><span class="label"><a 
 id="x1-17001r1"></a></span><span style="color:#000000"><span 
class="ectt-1200">$</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">docker</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">run</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">p</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">6400:6400</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">fan</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">club</span></span><span 
class="ectt-1200">&#x00A0;</span></pre>
   </div>
<!--l. 422--><p class="indent" >   Note that we&#8217;ve repeated the port. The first occurence of the port is the binding on the host machine, so from
the host we can go to localhost:6400 to access it. The second occurence is the port being listened to
within the container. This means that we can use different ports on the host. If we want to go to
port 80 to access our service, we can do so without changing the port inside of the container with:
</p><div class="framedenv" id="shaded*-1">
   <!--l. 429-->
<pre class="lstlisting" id="listing-26"><span class="label"><a 
 id="x1-17002r1"></a></span><span style="color:#000000"><span 
class="ectt-1200">$</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">docker</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">run</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">p</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">80:6400</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">fan</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">club</span></span><span 
class="ectt-1200">&#x00A0;</span></pre>
   </div>
<!--l. 431--><p class="indent" >   Docker networking is much more complicated than just this but it is a starting point so that we can start using
containers that talk to the outside world.
</p><!--l. 433--><p class="noindent" >
</p>
   <h5 class="subsubsectionHead"><span class="titlemark">3.3.2    </span> <a 
 id="x1-180003.3.2"></a>Docker Volumes</h5>
<!--l. 435--><p class="noindent" >The next tool to escape from a container is to use Docker volumes. Docker volumes allow a way for us to share the
same folder between the host machine and the container. This is particularly useful for development of an
application where the code we want to run is updated often. It is also useful if we are running an application which
we would like to be persistent, like a database.
</p><!--l. 440--><p class="indent" >   In our fan club example, we are storing our application within the <span 
class="ectt-1200">/app </span>directory of the container. If we want
this to live update with the contents of our application on the host (assuming we run this command from the
applications directory), we can do so with:  </p><div class="framedenv" id="shaded*-1">
   <!--l. 443-->
<pre class="lstlisting" id="listing-27"><span class="label"><a 
 id="x1-18001r1"></a></span><span style="color:#000000"><span 
class="ectt-1200">$</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">docker</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">run</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">v</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">$</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#000000"><span 
class="ectt-1200">pwd</span></span><span style="color:#000000"><span 
class="ectt-1200">)</span></span><span style="color:#000000"><span 
class="ectt-1200">:/</span></span><span style="color:#000000"><span 
class="ectt-1200">app</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">fan</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">club</span></span><span 
class="ectt-1200">&#x00A0;</span></pre>
   </div>
<!--l. 445--><p class="indent" >   This command mounts our current working directory (<span 
class="ectt-1200">$(pwd)</span>) to the <span 
class="ectt-1200">/app </span>directory inside the container. This
allows us to update our application and have the change reflected inside the container.
</p><!--l. 448--><p class="indent" >   Again, Docker volumes are a much more complex beast but host mounting is all we require for this
practical.
</p><!--l. 450--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">4    </span> <a 
 id="x1-190004"></a>Containerising our Todo Application</h3>
                                                                                                    
                                                                                                    
<!--l. 456--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">4.1    </span> <a 
 id="x1-200004.1"></a>Creating a Practical Repository</h4>
<!--l. 457--><p class="noindent" >Navigate to the GitHub Classroom link for this practical provided by your tutor in Slack. As with last week, this will
create a new repository for you in the course organisation. You can now clone this repository to your local
machine or work directly in the browser with GitHub codespaces. This repository will be populated with
our solution to last week&#8217;s practical exercise. You may modify this solution or replace it with your
own.
</p><!--l. 463--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">4.2    </span> <a 
 id="x1-210004.2"></a>Creating a Dockerfile</h4>
<!--l. 465--><p class="noindent" >Now that we have covered the basics of Docker we can Dockerise our Todo App to prepare it for deployment.
Inside our practical folder we will create a new file called <span 
class="ectt-1200">Dockerfile</span>. To start, we will use the following
Dockerfile:
</p><!--l. 469--><p class="indent" >   </p><div class="framedenv" id="code-1">
<!--l. 469--><p class="indent" >   <span 
class="ectt-1200">» cat Dockerfile</span> </p></div>   <div class="framedenv" id="code-1"><!--l. 469--><pre class="listings" id="listing-28"><span class="label"><a 
 id="x1-21001r1"></a></span><span style="color:#006699"><span 
class="ectt-1200">FROM</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">ubuntu</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"><span 
class="ectt-1200">latest</span></span> 
<span class="label"><a 
 id="x1-21002r2"></a></span> 
<span class="label"><a 
 id="x1-21003r3"></a></span><span style="color:#33997E"><span 
class="ectt-1200">#</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">Installing</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">dependencies</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">for</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">running</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">a</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">python</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">application</span></span> 
<span class="label"><a 
 id="x1-21004r4"></a></span><span style="color:#006699"><span 
class="ectt-1200">RUN</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">apt</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">get</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">update</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">&amp;&amp;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">apt</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">get</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">install</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">y</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">python3</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">python3</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">pip</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">postgresql</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">client</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">libpq</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">dev</span></span>
 
<span class="label"><a 
 id="x1-21005r5"></a></span></pre>
   </div>
<!--l. 476--><p class="indent" >   The above image is what your local environment may have been like when you started the course. To follow
the same setup as we have had in the practicals let&#8217;s install pipenv. We can do this by adding the following line to
our Dockerfile:
</p>
   <div class="framedenv" id="code-1">
<!--l. 480--><pre class="listings" id="listing-29"><span class="label"><a 
 id="x1-21006r1"></a></span><span style="color:#33997E"><span 
class="ectt-1200">#</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">Install</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">pipenv</span></span> 
<span class="label"><a 
 id="x1-21007r2"></a></span><span style="color:#006699"><span 
class="ectt-1200">RUN</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">pip3</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">install</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">y</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">pipenv</span></span>
 
<span class="label"><a 
 id="x1-21008r3"></a></span></pre>
   </div>
<!--l. 485--><p class="indent" >   Let&#8217;s now change our working directory to <span 
class="ectt-1200">/app </span>and copy our <span 
class="ectt-1200">Pipfile </span>and <span 
class="ectt-1200">Pipfile.lock </span>into the container.
We can then install our dependencies using pipenv.
</p>
   <div class="framedenv" id="code-1">
<!--l. 488--><pre class="listings" id="listing-30"><span class="label"><a 
 id="x1-21009r1"></a></span><span style="color:#33997E"><span 
class="ectt-1200">#</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">Setting</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">the</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">working</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">directory</span></span> 
<span class="label"><a 
 id="x1-21010r2"></a></span><span style="color:#006699"><span 
class="ectt-1200">WORKDIR</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">app</span></span> 
<span class="label"><a 
 id="x1-21011r3"></a></span> 
<span class="label"><a 
 id="x1-21012r4"></a></span><span style="color:#33997E"><span 
class="ectt-1200">#</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">Install</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">pipenv</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">dependencies</span></span> 
<span class="label"><a 
 id="x1-21013r5"></a></span><span style="color:#006699"><span 
class="ectt-1200">COPY</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">Pipfile</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">Pipfile</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">lock</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">./</span></span> 
<span class="label"><a 
 id="x1-21014r6"></a></span><span style="color:#006699"><span 
class="ectt-1200">RUN</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">pipenv</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">install</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"><span 
class="ectt-1200">system</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"><span 
class="ectt-1200">deploy</span></span>
 
<span class="label"><a 
 id="x1-21015r7"></a></span></pre>
   </div>
<!--l. 497--><p class="indent" >   Note that we are installing dependencies in a layer separate to our application. This allows us to quickly rebuild
the image if we change anything other than the Pipfile or Pipfile.lock.
</p><!--l. 500--><p class="indent" >   Now that we have installed our dependencies we can copy our application into the container.
</p>
   <div class="framedenv" id="code-1">
<!--l. 502--><pre class="listings" id="listing-31"><span class="label"><a 
 id="x1-21016r1"></a></span><span style="color:#33997E"><span 
class="ectt-1200">#</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">Copying</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">our</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">application</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">into</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">the</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">container</span></span> 
<span class="label"><a 
 id="x1-21017r2"></a></span><span style="color:#006699"><span 
class="ectt-1200">COPY</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">todo</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">todo</span></span>
 
<span class="label"><a 
 id="x1-21018r3"></a></span></pre>
   </div>
<!--l. 507--><p class="indent" >   Finally we can run our application by adding the following line to our Dockerfile:
</p>
   <div class="framedenv" id="code-1">
<!--l. 509--><pre class="listings" id="listing-32"><span class="label"><a 
 id="x1-21019r1"></a></span><span style="color:#33997E"><span 
class="ectt-1200">#</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">Running</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">our</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">application</span></span> 
<span class="label"><a 
 id="x1-21020r2"></a></span><span style="color:#006699"><span 
class="ectt-1200">CMD</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">[</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">flask</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">--</span></span><span style="color:#669900"><span 
class="ectt-1200">app</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">todo</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">run</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">--</span></span><span style="color:#669900"><span 
class="ectt-1200">host</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">0.0.0.0</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">--</span></span><span style="color:#669900"><span 
class="ectt-1200">port</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">6400</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">]</span></span>
 
<span class="label"><a 
 id="x1-21021r3"></a></span></pre>
                                                                                                    
                                                                                                    
   </div>
<!--l. 514--><p class="indent" >   We should now have a complete Dockerfile, as shown below:
</p>
   <div class="framedenv" id="code-1">
<!--l. 516--><pre class="listings" id="listing-33"><span class="label"><a 
 id="x1-21022r1"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#006699"><span 
class="ectt-1200">FROM</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">ubuntu</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"><span 
class="ectt-1200">latest</span></span> 
<span class="label"><a 
 id="x1-21023r2"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#33997E"><span 
class="ectt-1200">#</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">Installing</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">dependencies</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">for</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">running</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">a</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">python</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">application</span></span> 
<span class="label"><a 
 id="x1-21024r3"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#006699"><span 
class="ectt-1200">RUN</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">apt</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">get</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">update</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">&amp;&amp;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">apt</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">get</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">install</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">y</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">python3</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">python3</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">pip</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">postgresql</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">client</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">libpq</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">dev</span></span> 
<span class="label"><a 
 id="x1-21025r4"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#33997E"><span 
class="ectt-1200">#</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">Install</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">pipenv</span></span> 
<span class="label"><a 
 id="x1-21026r5"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#006699"><span 
class="ectt-1200">RUN</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">pip3</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">install</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">pipenv</span></span> 
<span class="label"><a 
 id="x1-21027r6"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#33997E"><span 
class="ectt-1200">#</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">Setting</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">the</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">working</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">directory</span></span> 
<span class="label"><a 
 id="x1-21028r7"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#006699"><span 
class="ectt-1200">WORKDIR</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">app</span></span> 
<span class="label"><a 
 id="x1-21029r8"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#33997E"><span 
class="ectt-1200">#</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">Install</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">pipenv</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">dependencies</span></span> 
<span class="label"><a 
 id="x1-21030r9"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#006699"><span 
class="ectt-1200">COPY</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">Pipfile</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">Pipfile</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">lock</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">./</span></span> 
<span class="label"><a 
 id="x1-21031r10"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#006699"><span 
class="ectt-1200">RUN</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">pipenv</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">install</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"><span 
class="ectt-1200">system</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"><span 
class="ectt-1200">deploy</span></span> 
<span class="label"><a 
 id="x1-21032r11"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#33997E"><span 
class="ectt-1200">#</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">Copying</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">our</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">application</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">into</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">the</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">container</span></span> 
<span class="label"><a 
 id="x1-21033r12"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#006699"><span 
class="ectt-1200">COPY</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">todo</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">todo</span></span> 
<span class="label"><a 
 id="x1-21034r13"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#33997E"><span 
class="ectt-1200">#</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">Running</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">our</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">application</span></span> 
<span class="label"><a 
 id="x1-21035r14"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#006699"><span 
class="ectt-1200">CMD</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">[</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">flask</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">--</span></span><span style="color:#669900"><span 
class="ectt-1200">app</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">todo</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">run</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">--</span></span><span style="color:#669900"><span 
class="ectt-1200">host</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">0.0.0.0</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">--</span></span><span style="color:#669900"><span 
class="ectt-1200">port</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">6400</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">]</span></span>
 
<span class="label"><a 
 id="x1-21036r15"></a></span></pre>
   </div>
<!--l. 533--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">4.3    </span> <a 
 id="x1-220004.3"></a>Building our Docker Image</h4>
<!--l. 535--><p class="noindent" >Now that we have created our Dockerfile we can build our Docker image. To do this we will use the following
command:
</p>
   <div class="framedenv" id="code-1">
<!--l. 537--><pre class="listings" id="listing-34"><span class="label"><a 
 id="x1-22001r1"></a></span><span style="color:#000000"><span 
class="ectt-1200">&#x003E;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">docker</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">build</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">t</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">todo</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">.</span></span> 
<span class="label"><a 
 id="x1-22002r2"></a></span><span style="color:#000000"><span 
class="ectt-1200">Successfully</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">tagged</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">todo</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"><span 
class="ectt-1200">latest</span></span>
 
<span class="label"><a 
 id="x1-22003r3"></a></span></pre>
   </div>
<!--l. 542--><p class="indent" >   We can then inspect our layers with the following command:
</p>
   <div class="framedenv" id="code-1">
<!--l. 544--><pre class="listings" id="listing-35"><span class="label"><a 
 id="x1-22004r1"></a></span><span style="color:#000000"><span 
class="ectt-1200">&#x003E;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">docker</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">image</span></span><span style="color:#000000"> </span><span style="color:#006699"><span 
class="ectt-1200">history</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">todo</span></span>
 
<span class="label"><a 
 id="x1-22005r2"></a></span></pre>
   </div>
<!--l. 549--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">4.4    </span> <a 
 id="x1-230004.4"></a>Running our Docker Container</h4>
<!--l. 551--><p class="noindent" >Now that we have built our Docker image we can run our Docker container. To do this we will use the following
command:
</p>
   <div class="framedenv" id="code-1">
<!--l. 553--><pre class="listings" id="listing-36"><span class="label"><a 
 id="x1-23001r1"></a></span><span style="color:#000000"><span 
class="ectt-1200">&#x003E;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">docker</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">run</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">it</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"><span 
class="ectt-1200">rm</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">p</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">6400:6400</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">todo</span></span> 
<span class="label"><a 
 id="x1-23002r2"></a></span><span style="color:#000000"><span 
class="ectt-1200">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">Running</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">on</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">...</span></span>
 
<span class="label"><a 
 id="x1-23003r3"></a></span></pre>
   </div>
<!--l. 558--><p class="indent" >   We can now navigate to <a 
href="http://localhost:6400" class="url" ><span 
class="ectt-1200">http://localhost:6400</span></a> to see our application running. We can stop our container
by pressing <span 
class="ectt-1200">Ctrl+C</span>. This should show the todo app that we have been working with for the past couple of
practicals.
</p>
   <div class="tcolorbox tcolorbox" id="tcolobox-8">    
<div class="tcolorbox-title">
<!--l. 566--><p class="indent" >   Info</p></div> 
<div class="tcolorbox-content"><!--l. 566--><p class="noindent" >It is important for us to use the host of 0.0.0.0 when running our application. This is because we
are running our application inside a container and we need to expose the port to the host machine.
If we were to use the default host of 127.0.0.1 we would not be able to access our application from
outside the container.  </p> 
</div> 
</div>
   <div class="tcolorbox tcolorbox" id="tcolobox-9">    
<div class="tcolorbox-title">
                                                                                                    
                                                                                                    
<!--l. 572--><p class="indent" >   Warning</p></div> 
<div class="tcolorbox-content"><!--l. 572--><p class="noindent" >You need to make sure that you are not running the webserver from the previous practical on port
6400. If you are then you will need to stop that webserver before running the Docker container. If
you also have other containers running they can conflict with this container.  </p> 
</div> 
</div>
<!--l. 574--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">4.5    </span> <a 
 id="x1-240004.5"></a>Optimizing Our Container</h4>
<!--l. 576--><p class="noindent" >We build this container image up from the Ubuntu base image. However, we rarely want to do it this way as their
exists a huge range of base images for most languages and environments. Try to optimize your image by using
<span 
class="ectt-1200">python:3.10 </span>as your base image.
</p><!--l. 580--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">5    </span> <a 
 id="x1-250005"></a>Docker Compose</h3>
<!--l. 582--><p class="noindent" >Docker is a useful tool itself but in terms of local development, but it is not always as easy to work with as it
could be. Docker Compose allows us to run multiple containers together which can be extremely
useful for managing complex projects that require numerous run parameters or manage multiple
containers.
</p><!--l. 586--><p class="indent" >   For this practical, we want to use a database closer to our production environment. We will be using a
Postgresql database which will eventually be a managed database hosted on AWS.
</p><!--l. 589--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">5.1    </span> <a 
 id="x1-260005.1"></a>Moving to a Postgresql Database</h4>
<!--l. 591--><p class="noindent" >This week we have actually made a small change to our application so that it can receive the SQLAlchemy
database URI as an environment variable. This means that we can now use Docker Compose to run our
application and database together. To do this we will create a new file called <span 
class="ectt-1200">docker-compose.yml </span>and add the
following content:
</p>
   <div class="framedenv" id="code-1">
<!--l. 595--><pre class="listings" id="listing-37"><span class="label"><a 
 id="x1-26001r1"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">version</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">"3.9"</span></span> 
<span class="label"><a 
 id="x1-26002r2"></a></span> 
<span class="label"><a 
 id="x1-26003r3"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">services</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span> 
<span class="label"><a 
 id="x1-26004r4"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">database</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span> 
<span class="label"><a 
 id="x1-26005r5"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">image</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">postgres</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"><span 
class="ectt-1200">latest</span></span> 
<span class="label"><a 
 id="x1-26006r6"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">restart</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">always</span></span> 
<span class="label"><a 
 id="x1-26007r7"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">environment</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span> 
<span class="label"><a 
 id="x1-26008r8"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">POSTGRES_PASSWORD</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">verySecretPassword</span></span> 
<span class="label"><a 
 id="x1-26009r9"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">POSTGRES_USER</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">administrator</span></span> 
<span class="label"><a 
 id="x1-26010r10"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">POSTGRES_DB</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">todo</span></span> 
<span class="label"><a 
 id="x1-26011r11"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">volumes</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span> 
<span class="label"><a 
 id="x1-26012r12"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">./</span></span><span style="color:#000000"><span 
class="ectt-1200">data</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">db</span></span><span style="color:#000000"><span 
class="ectt-1200">:/</span></span><span style="color:#000000"><span 
class="ectt-1200">var</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">lib</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">postgresql</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">data</span></span> 
<span class="label"><a 
 id="x1-26013r13"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">app</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span> 
<span class="label"><a 
 id="x1-26014r14"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">build</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">.</span></span> 
<span class="label"><a 
 id="x1-26015r15"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">restart</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">always</span></span> 
<span class="label"><a 
 id="x1-26016r16"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">environment</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span> 
<span class="label"><a 
 id="x1-26017r17"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">SQLALCHEMY_DATABASE_URI</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">postgresql</span></span><span style="color:#000000"><span 
class="ectt-1200">://</span></span><span style="color:#000000"><span 
class="ectt-1200">administrator</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"><span 
class="ectt-1200">verySecretPassword@database</span></span><span style="color:#000000"><span 
class="ectt-1200">:5432/</span></span><span style="color:#000000"><span 
class="ectt-1200">todo</span></span> 
<span class="label"><a 
 id="x1-26018r18"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">ports</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span> 
<span class="label"><a 
 id="x1-26019r19"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">"6400:6400"</span></span> 
<span class="label"><a 
 id="x1-26020r20"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">depends_on</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span> 
<span class="label"><a 
 id="x1-26021r21"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">database</span></span>
 
<span class="label"><a 
 id="x1-26022r22"></a></span></pre>
   </div>
<!--l. 619--><p class="indent" >   We can now run our application and database with the following command within the root directory.
</p>
   <div class="framedenv" id="shaded*-1">
   <!--l. 621-->
<pre class="lstlisting" id="listing-38"><span class="label"><a 
 id="x1-26023r1"></a></span><span style="color:#000000"><span 
class="ectt-1200">$</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">docker</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">compose</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">up</span></span><span 
class="ectt-1200">&#x00A0;</span></pre>
   </div>
<!--l. 623--><p class="indent" >   You should observe the output of this command and you can see two containers running. One is the database,
<span 
class="ectt-1200">database</span>, and the other is our application, <span 
class="ectt-1200">app</span>. We can now navigate to <a 
href="http://localhost:6400" class="url" ><span 
class="ectt-1200">http://localhost:6400</span></a> to see our
application running. In reality though our database probably did not have enough time to start up before our
application tried to connect to it. We can fix this by adding a delay to our application startup. To do this we will add
the following line to our Dockerfile:
                                                                                                    
                                                                                                    
</p>
   <div class="framedenv" id="code-1">
<!--l. 630--><pre class="listings" id="listing-39"><span class="label"><a 
 id="x1-26024r1"></a></span><span style="color:#33997E"><span 
class="ectt-1200">#</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">Adding</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">a</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">delay</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">to</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">our</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">application</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">startup</span></span> 
<span class="label"><a 
 id="x1-26025r2"></a></span><span style="color:#006699"><span 
class="ectt-1200">CMD</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">[</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">bash</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">-</span></span><span style="color:#669900"><span 
class="ectt-1200">c</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">sleep</span></span><span style="color:#669900"> </span><span style="color:#669900"><span 
class="ectt-1200">10</span></span><span style="color:#669900"> </span><span style="color:#669900"><span 
class="ectt-1200">&amp;&amp;</span></span><span style="color:#669900"> </span><span style="color:#669900"><span 
class="ectt-1200">flask</span></span><span style="color:#669900"> </span><span style="color:#669900"><span 
class="ectt-1200">--</span></span><span style="color:#669900"><span 
class="ectt-1200">app</span></span><span style="color:#669900"> </span><span style="color:#669900"><span 
class="ectt-1200">todo</span></span><span style="color:#669900"> </span><span style="color:#669900"><span 
class="ectt-1200">run</span></span><span style="color:#669900"> </span><span style="color:#669900"><span 
class="ectt-1200">--</span></span><span style="color:#669900"><span 
class="ectt-1200">host</span></span><span style="color:#669900"> </span><span style="color:#669900"><span 
class="ectt-1200">0.0.0.0</span></span><span style="color:#669900"> </span><span style="color:#669900"><span 
class="ectt-1200">--</span></span><span style="color:#669900"><span 
class="ectt-1200">port</span></span><span style="color:#669900"> </span><span style="color:#669900"><span 
class="ectt-1200">6400</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">]</span></span>
 
<span class="label"><a 
 id="x1-26026r3"></a></span></pre>
   </div>
<!--l. 635--><p class="indent" >   In the long run you would want your application to be able to retry connecting to the database if it fails but for
now we will just add a delay. We can now rebuild our Docker image and run our application and database with the
following commands:
</p>
   <div class="framedenv" id="shaded*-1">
   <!--l. 638-->
<pre class="lstlisting" id="listing-40"><span class="label"><a 
 id="x1-26027r1"></a></span><span style="color:#000000"><span 
class="ectt-1200">$</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">docker</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">compose</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">up</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"><span 
class="ectt-1200">build</span></span><span 
class="ectt-1200">&#x00A0;</span></pre>
   </div>
<!--l. 640--><p class="indent" >   You may have noticed that when we defined the todo application service above we did not specify a container.
This is because Docker Compose can be instructed to use our Dockerfile to build at time so that we do not have to
keep using the build command.
</p><!--l. 658--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">6    </span> <a 
 id="x1-270006"></a>Conclusion</h3>
<!--l. 660--><p class="noindent" >Over the past couple of weeks we have built a full todo app API that is ready to be deployed to a remote
production environment. We started with a Flask API returning static responses and now we have a dynamic API
that is running in a containerised environment with an external database.
</p><!--l. 663--><p class="indent" >   We have cheated with our Docker deployment by using the flask development server. For a production
environment you will want to use a production webserver such as <span 
class="ectt-1200">gunicorn </span>or <span 
class="ectt-1200">uwsgi</span>. These web servers are
designed to handle multiple requests at the same time and are much more efficient than the Flask development
server. We recommend you have a look at how to prepare a Flask application for production as it may help you in
your future projects if you choose to use Flask.
</p><!--l. 668--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">7    </span> <a 
 id="x1-280007"></a>Extra</h3>
<!--l. 670--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">7.1    </span> <a 
 id="x1-290007.1"></a>Python Based Dockerfile</h4>
<!--l. 672--><p class="noindent" >Earlier we mentioned that you can use language specific base images for your applications. Below is an example
Dockerfile that uses the python 3.10 base image.
</p>
   <div class="framedenv" id="code-1">
<!--l. 674--><pre class="listings" id="listing-41"><span class="label"><a 
 id="x1-29001r1"></a></span><span style="color:#006699"><span 
class="ectt-1200">FROM</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">python</span></span><span style="color:#000000"><span 
class="ectt-1200">:3.10</span></span> 
<span class="label"><a 
 id="x1-29002r2"></a></span><span style="color:#33997E"><span 
class="ectt-1200">#</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">Install</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">pipenv</span></span> 
<span class="label"><a 
 id="x1-29003r3"></a></span><span style="color:#006699"><span 
class="ectt-1200">RUN</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">pip3</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">install</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">pipenv</span></span> 
<span class="label"><a 
 id="x1-29004r4"></a></span><span style="color:#33997E"><span 
class="ectt-1200">#</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">Setting</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">the</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">working</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">directory</span></span> 
<span class="label"><a 
 id="x1-29005r5"></a></span><span style="color:#006699"><span 
class="ectt-1200">WORKDIR</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">app</span></span> 
<span class="label"><a 
 id="x1-29006r6"></a></span><span style="color:#33997E"><span 
class="ectt-1200">#</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">Install</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">pipenv</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">dependencies</span></span> 
<span class="label"><a 
 id="x1-29007r7"></a></span><span style="color:#006699"><span 
class="ectt-1200">COPY</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">Pipfile</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">Pipfile</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">lock</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">./</span></span> 
<span class="label"><a 
 id="x1-29008r8"></a></span><span style="color:#006699"><span 
class="ectt-1200">RUN</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">pipenv</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">install</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"><span 
class="ectt-1200">system</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"><span 
class="ectt-1200">deploy</span></span> 
<span class="label"><a 
 id="x1-29009r9"></a></span><span style="color:#33997E"><span 
class="ectt-1200">#</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">Copying</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">our</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">application</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">into</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">the</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">container</span></span> 
<span class="label"><a 
 id="x1-29010r10"></a></span><span style="color:#006699"><span 
class="ectt-1200">COPY</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">todo</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">todo</span></span> 
<span class="label"><a 
 id="x1-29011r11"></a></span><span style="color:#33997E"><span 
class="ectt-1200">#</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">Running</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">our</span></span><span style="color:#33997E"> </span><span style="color:#33997E"><span 
class="ectt-1200">application</span></span> 
<span class="label"><a 
 id="x1-29012r12"></a></span><span style="color:#006699"><span 
class="ectt-1200">CMD</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">[</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">flask</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">--</span></span><span style="color:#669900"><span 
class="ectt-1200">app</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">todo</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">run</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">--</span></span><span style="color:#669900"><span 
class="ectt-1200">host</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">0.0.0.0</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">--</span></span><span style="color:#669900"><span 
class="ectt-1200">port</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">6400</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">]</span></span>
 
<span class="label"><a 
 id="x1-29013r13"></a></span></pre>
                                                                                                    
                                                                                                    
   </div>
<!--l. 689--><p class="indent" >   You will notice that we did not have to install python3 and pip and the postgresql depenedencies.
</p>
    
</body></html> 

                                                                                                    


