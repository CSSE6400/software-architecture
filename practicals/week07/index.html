Last Updated on 2023/04/04     

<?xml version="1.0" encoding="iso-8859-1" ?> 
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">  
<!--http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd-->  
<html xmlns="http://www.w3.org/1999/xhtml"  
> 
<head> <title>Events &amp; Worker Queues</title> 
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /> 
<meta name="generator" content="TeX4ht (https://tug.org/tex4ht/)" /> 
<meta name="originator" content="TeX4ht (https://tug.org/tex4ht/)" /> 
<!-- fn-in,html,htex4ht,xhtml --> 
<meta name="src" content="main.tex" /> 
<link rel="stylesheet" type="text/css" href="main.css" /> 
<link rel="stylesheet" href="https://latex.now.sh/style.css"> 
<link rel="stylesheet" href="/notes.css"> 
<style>body {max-width: 100ch;} 
dl dd {text-align: left}</style> 
</head><body 
>
   <div class="maketitle"><a 
 id="Q1-1-1"></a>
_________________________________________________________________________________________________
<h2 class="titleHead">Events &amp; Worker Queues</h2>                                                             Software Architecture
   <div class="date" >April 5, 2023</div>                                                                                                                              <div class="author" >Evan Hughes &amp; Brae
Webb</div>
______________________________________________________________________________________________
   </div>
   <hr class="figure" /><div class="figure" 
>
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    
<!--l. 19--><p class="noindent" ><img 
src="images/event-driven.png" alt="PIC"  
width="420" height="420"  />
                                                                                                    
                                                                                                    
</p>
   </div><hr class="endfigure" />
   <h3 class="sectionHead"><span class="titlemark">1    </span> <a 
 id="x1-10001"></a>This Week</h3>
<!--l. 23--><p class="noindent" >Our goal is to: </p>
      <ul class="itemize1">
      <li class="itemize">
      <!--l. 25--><p class="noindent" >Explore events and worker queues in the context of AWS.
      </p></li>
      <li class="itemize">
      <!--l. 26--><p class="noindent" >Deploy our own TaskOverflow container on AWS Elastic Container Registry (ECS).
      </p></li>
      <li class="itemize">
      <!--l. 27--><p class="noindent" >Develop an event-based architecture to generate a calendar from tasks in TaskOverflow.</p></li></ul>
<!--l. 30--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">2    </span> <a 
 id="x1-20002"></a>Event Processing</h3>
<!--l. 32--><p class="noindent" >As we saw in Event-Driven Architectures <span class="cite">[<a 
href="#Xevents-notes">1</a>]</span>, event processing enable us to build highly scalable and extensible
systems. In this practical we will get our hands dirty with event processing using AWS SQS. AWS SQS is a service
which acts as an event broker.
</p><!--l. 37--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">2.1    </span> <a 
 id="x1-30002.1"></a>Technologies</h4>
<!--l. 39--><p class="noindent" >There are other technologies that can be useful in developing an event-based architecture. The following is a
non-exhaustive list of services native to AWS.
</p><!--l. 42--><p class="noindent" >
</p>
   <h5 class="subsubsectionHead"><span class="titlemark">2.1.1    </span> <a 
 id="x1-40002.1.1"></a>AWS SQS</h5>
<!--l. 44--><p class="noindent" >AWS provides the Simple Queue Service, SQS, which offers a simple and fully managed message queue service.
There are two flavours of SQS to be aware of.
      </p><dl class="description"><dt class="description">
      <!--l. 48--><p class="noindent" >
<span 
class="Cabin-Bold-tlf-t1-x-x-120">Standard message queues</span> </p></dt><dd 
class="description">
      <!--l. 48--><p class="noindent" >allow for greater scalability by providing higher through-put. However, standard message queues in
      SQS are not exactly queues, messages are not first in first out, they are best-effort ordered.
                                                                                                    
                                                                                                    
      </p></dd><dt class="description">
      <!--l. 52--><p class="noindent" >
<span 
class="Cabin-Bold-tlf-t1-x-x-120">FIFO message queues</span> </p></dt><dd 
class="description">
      <!--l. 52--><p class="noindent" >guarantees that messages are First in First Out.</p></dd></dl>
<!--l. 55--><p class="noindent" >
</p>
   <h5 class="subsubsectionHead"><span class="titlemark">2.1.2    </span> <a 
 id="x1-50002.1.2"></a>AWS SNS</h5>
<!--l. 56--><p class="noindent" >
      Amazon Simple Notification Service (Amazon SNS) is a fully managed messaging service for
      both application-to-application (A2A) and application-to-person (A2P) communication.
      </p><!--l. 59--><p class="noindent" >The                  A2A                  pub/sub                  functionality                  provides                  topics
      for  high-throughput,  push-based,  many-to-many  messaging  between  distributed  systems,
      microservices,  and  event-driven  serverless  applications.  Using  Amazon  SNS  topics,  your
      publisher systems can fanout messages to a large number of subscriber systems, including
      Amazon SQS queues, AWS Lambda functions, HTTPS endpoints, and Amazon Kinesis Data
      Firehose, for parallel processing. The A2P functionality enables you to send messages to users
      at scale via SMS, mobile push, and email.
                                                                                             </p><!--l. 69--><p class="noindent" >&#8211;
                                                                                          AWS
</p><!--l. 72--><p class="noindent" >
</p>
   <h5 class="subsubsectionHead"><span class="titlemark">2.1.3    </span> <a 
 id="x1-60002.1.3"></a>AWS MQ / Apache ActiveMQ / RabbitMQ</h5>
<!--l. 73--><p class="noindent" >
      Amazon  MQ  is  a  managed  message  broker  service  for  Apache  ActiveMQ  and  RabbitMQ
      that  makes  it  easy  to  set  up  and  operate  message  brokers  on  AWS.  Amazon  MQ  reduces
      your  operational  responsibilities  by  managing  the  provisioning,  setup,  and  maintenance  of
      message  brokers  for  you.  Because  Amazon  MQ  connects  to  your  current  applications  with
      industry-standard APIs and protocols, you can easily migrate to AWS without having to rewrite
      code.
                                                                                             </p><!--l. 79--><p class="noindent" >&#8211;
                                                                                          AWS
</p>
   <div class="tcolorbox tcolorbox" id="tcolobox-1">    
<div class="tcolorbox-title">
<!--l. 82--><p class="indent" >   Aside</p></div> 
<div class="tcolorbox-content"><!--l. 82--><p class="noindent" >Not available in the lab environments. </p> 
</div> 
</div>
                                                                                                    
                                                                                                    
<!--l. 84--><p class="noindent" >
</p>
   <h5 class="subsubsectionHead"><span class="titlemark">2.1.4    </span> <a 
 id="x1-70002.1.4"></a>AWS MSK ( Managed Streaming for Apache Kafka )</h5>
<!--l. 85--><p class="noindent" >
      Amazon  Managed  Streaming  for  Apache  Kafka  (Amazon  MSK)  is  a  fully  managed  service
      that enables you to build and run applications that use Apache Kafka to process streaming
      data. Amazon MSK provides the control-plane operations, such as those for creating, updating,
      and deleting clusters. It lets you use Apache Kafka data-plane operations, such as those for
      producing  and  consuming  data  It  runs  open-source  versions  of  Apache  Kafka.  This  means
      existing  applications,  tooling,  and  plugins  from  partners  and  the  Apache  Kafka  community
      are supported without requiring changes to application code. You can use Amazon MSK to
      create clusters that use any of the Apache Kafka versions listed under Supported Apache Kafka
      versions.
                                                                                             </p><!--l. 94--><p class="noindent" >&#8211;
                                                                                          AWS
</p>
   <div class="tcolorbox tcolorbox" id="tcolobox-2">    
<div class="tcolorbox-title">
<!--l. 97--><p class="indent" >   Aside</p></div> 
<div class="tcolorbox-content"><!--l. 97--><p class="noindent" >Not available in the lab environments. </p> 
</div> 
</div>
<!--l. 99--><p class="noindent" >
</p>
   <h5 class="subsubsectionHead"><span class="titlemark">2.1.5    </span> <a 
 id="x1-80002.1.5"></a>Redis</h5>
<!--l. 100--><p class="noindent" >
      Redis, which stands for Remote Dictionary Server, is a fast, open source, in-memory, key-value
      data  store.  The  project  started  when  Salvatore  Sanfilippo,  the  original  developer  of  Redis,
      wanted to improve the scalability of his Italian startup. From there, he developed Redis, which
      is now used as a database, cache, message broker, and queue.
      </p><!--l. 109--><p class="noindent" >Redis delivers sub-millisecond response times, enabling millions of requests per second for
      real-time applications in industries like gaming, ad-tech, financial services, healthcare, and IoT.
      Today, Redis is one of the most popular open source engines today, named the &#8220;Most Loved&#8221;
      database by Stack Overflow for five consecutive years. Because of its fast performance, Redis is
      a popular choice for caching, session management, gaming, leaderboards, real-time analytics,
      geospatial, ride-hailing, chat/messaging, media streaming, and pub/sub apps.
      </p><!--l. 116--><p class="noindent" >AWS  offers  two  fully  managed  services  to  run  Redis.  Amazon  MemoryDB  for  Redis  is  a
      Redis-compatible, durable, in-memory database service that delivers ultra-fast performance.
      Amazon ElastiCache for Redis is a fully managed caching service that accelerates data access
      from primary databases and data stores with microsecond latency. Furthermore, ElastiCache
      also offers support for Memcached, another popular open source caching engine.
                                                                                             </p><!--l. 121--><p class="noindent" >&#8211;
                                                                                          AWS
</p>
   <div class="tcolorbox tcolorbox" id="tcolobox-3">    
<div class="tcolorbox-title">
<!--l. 124--><p class="indent" >   Aside</p></div> 
<div class="tcolorbox-content"><!--l. 124--><p class="noindent" >Not available in the lab environments. </p> 
</div> 
</div>
                                                                                                    
                                                                                                    
<!--l. 126--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">3    </span> <a 
 id="x1-90003"></a>Talking to the Simple Queue Service (SQS)</h3>
   <div class="tcolorbox tcolorbox" id="tcolobox-4">    
<div class="tcolorbox-title">
<!--l. 131--><p class="indent" >   Info</p></div> 
<div class="tcolorbox-content"><!--l. 131--><p class="noindent" >This section is intended to be demonstrated by your practical tutor. You may work through it on your
own if you wish.  </p> 
</div> 
</div>
<!--l. 133--><p class="noindent" >We will demonstrate working with the two queue flavours of AWS SQS. A standard queue, named
<span 
class="ectt-1200">csse6400_prac </span>and a FIFO queue, named <span 
class="ectt-1200">csse6400_prac.fifo</span>. The Terraform code below can be used to
create these two queues.
</p>
   <div class="framedenv" id="code-1">
<!--l. 142--><pre class="listings" id="listing-1"><span class="label"><a 
 id="x1-9001r1"></a></span><span style="color:#006699"><span 
class="ectt-1200">terraform</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-9002r2"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#006699"><span 
class="ectt-1200">required_providers</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-9003r3"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">aws</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-9004r4"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">source</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">hashicorp</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">aws</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-9005r5"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">version</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">~&#x003E;</span></span><span style="color:#669900"> </span><span style="color:#669900"><span 
class="ectt-1200">3.0</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-9006r6"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">}</span></span> 
<span class="label"><a 
 id="x1-9007r7"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">}</span></span> 
<span class="label"><a 
 id="x1-9008r8"></a></span><span style="color:#000000"><span 
class="ectt-1200">}</span></span> 
<span class="label"><a 
 id="x1-9009r9"></a></span> 
<span class="label"><a 
 id="x1-9010r10"></a></span><span style="color:#006699"><span 
class="ectt-1200">provider</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">aws</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-9011r11"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">region</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">us</span></span><span style="color:#669900"><span 
class="ectt-1200">-</span></span><span style="color:#669900"><span 
class="ectt-1200">east</span></span><span style="color:#669900"><span 
class="ectt-1200">-1</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-9012r12"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">shared_credentials_file</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">./</span></span><span style="color:#669900"><span 
class="ectt-1200">credentials</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-9013r13"></a></span><span style="color:#000000"><span 
class="ectt-1200">}</span></span> 
<span class="label"><a 
 id="x1-9014r14"></a></span> 
<span class="label"><a 
 id="x1-9015r15"></a></span><span style="color:#006699"><span 
class="ectt-1200">resource</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">aws_sqs_queue</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">our_first_mailbox</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-9016r16"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">name</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">csse6400_prac</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-9017r17"></a></span><span style="color:#000000"><span 
class="ectt-1200">}</span></span> 
<span class="label"><a 
 id="x1-9018r18"></a></span> 
<span class="label"><a 
 id="x1-9019r19"></a></span><span style="color:#006699"><span 
class="ectt-1200">resource</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">aws_sqs_queue</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">our_first_fifo</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-9020r20"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">name</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">csse6400_prac</span></span><span style="color:#669900"><span 
class="ectt-1200">.</span></span><span style="color:#669900"><span 
class="ectt-1200">fifo</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-9021r21"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">fifo_queue</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">true</span></span> 
<span class="label"><a 
 id="x1-9022r22"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">content_based_deduplication</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">true</span></span> 
<span class="label"><a 
 id="x1-9023r23"></a></span><span style="color:#000000"><span 
class="ectt-1200">}</span></span> 
<span class="label"><a 
 id="x1-9024r24"></a></span> 
<span class="label"><a 
 id="x1-9025r25"></a></span><span style="color:#006699"><span 
class="ectt-1200">output</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">mailbox</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-9026r26"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">value</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">aws_sqs_queue</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">our_first_mailbox</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">arn</span></span> 
<span class="label"><a 
 id="x1-9027r27"></a></span><span style="color:#000000"><span 
class="ectt-1200">}</span></span> 
<span class="label"><a 
 id="x1-9028r28"></a></span> 
<span class="label"><a 
 id="x1-9029r29"></a></span><span style="color:#006699"><span 
class="ectt-1200">output</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">fifo</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-9030r30"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">value</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">aws_sqs_queue</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">our_first_fifo</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">arn</span></span> 
<span class="label"><a 
 id="x1-9031r31"></a></span><span style="color:#000000"><span 
class="ectt-1200">}</span></span>
 
<span class="label"><a 
 id="x1-9032r32"></a></span></pre>
   </div>
<!--l. 176--><p class="indent" >   Now that we have provisioned the queues we can have a look at them in the AWS Console. In the
main AWS dashboard you can search for &#8220;SQS&#8221; to find these queues. You should reach a page like
this:
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    
<!--l. 181--><p class="noindent" ><img 
src="images/sqspanel.png" alt="PIC"  
width="525" height="525"  />
                                                                                                    
                                                                                                    
</p>
   </div><hr class="endfigure" />
<!--l. 184--><p class="indent" >   Like the EC2 and RDS dashboards, we can browse the queue configurations and metrics.
</p>
   <h4 class="subsectionHead"><span class="titlemark">3.1    </span> <a 
 id="x1-100003.1"></a>Queue Command-line Interface</h4>
<!--l. 199--><p class="noindent" >We have provided a small docker container to demonstrate the differnce between the implementations. First we
must retrieve our AWS credentials and setup our environment.
</p><!--l. 202--><p class="indent" >   Grab the AWS credentials from the Learner Lab but instead of creating a credentials file we will be using
environment variables.
</p><!--l. 204--><p class="indent" >   Now we need to create an environment file for our docker container to read so that it can access AWS. Create a
&#8220;.env&#8221; file in the current directory and edit the contents so that it looks similar to the below: The AWS keys will be
from the credentials shown in your lab environment.
</p>
   <div class="framedenv" id="code-1">
<!--l. 206--><pre class="listings" id="listing-2"><span class="label"><a 
 id="x1-10001r1"></a></span><span style="color:#000000"><span 
class="ectt-1200">TERM</span></span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"><span 
class="ectt-1200">xterm</span></span><span style="color:#000000"><span 
class="ectt-1200">-256</span></span><span style="color:#000000"><span 
class="ectt-1200">color</span></span> 
<span class="label"><a 
 id="x1-10002r2"></a></span><span style="color:#000000"><span 
class="ectt-1200">AWS_ACCESS_KEY_ID</span></span><span style="color:#000000"><span 
class="ectt-1200">=...</span></span> 
<span class="label"><a 
 id="x1-10003r3"></a></span><span style="color:#000000"><span 
class="ectt-1200">AWS_SECRET_ACCESS_KEY</span></span><span style="color:#000000"><span 
class="ectt-1200">=...</span></span> 
<span class="label"><a 
 id="x1-10004r4"></a></span><span style="color:#000000"><span 
class="ectt-1200">AWS_SESSION_TOKEN</span></span><span style="color:#000000"><span 
class="ectt-1200">=...</span></span>
 
<span class="label"><a 
 id="x1-10005r5"></a></span></pre>
   </div>
   <div class="framedenv" id="code-1">
<!--l. 213--><pre class="listings" id="listing-3"><span class="label"><a 
 id="x1-10006r1"></a></span><span style="color:#000000"><span 
class="ectt-1200">&#x003E;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">docker</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">run</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"><span 
class="ectt-1200">rm</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">it</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"><span 
class="ectt-1200">env</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">file</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">env</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">ghcr</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">io</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">csse6400</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">queue</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"><span 
class="ectt-1200">main</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"><span 
class="ectt-1200">name</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">test</span></span><span style="color:#000000"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"><span 
class="ectt-1200">client</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">name</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">Client</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">1"</span></span> 
<span class="label"><a 
 id="x1-10007r2"></a></span> 
<span class="label"><a 
 id="x1-10008r3"></a></span> 
<span class="label"><a 
 id="x1-10009r4"></a></span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">__________</span></span> 
<span class="label"><a 
 id="x1-10010r5"></a></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">|</span></span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">\</span></span><span style="color:#000000"><span 
class="ectt-1200">XX</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">|</span></span> 
<span class="label"><a 
 id="x1-10011r6"></a></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">|</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">T</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">\/</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">T</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">|</span></span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">University</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">Queensland</span></span> 
<span class="label"><a 
 id="x1-10012r7"></a></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">|</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">XX</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"><span 
class="ectt-1200">XX</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">|</span></span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">Faculty</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">EAIT</span></span> 
<span class="label"><a 
 id="x1-10013r8"></a></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">T</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">L</span></span><span style="color:#000000"><span 
class="tctt-1200">'</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">/\</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="tctt-1200">'</span></span><span style="color:#000000"><span 
class="ectt-1200">J</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">T</span></span> 
<span class="label"><a 
 id="x1-10014r9"></a></span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">\</span></span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">XX</span></span><span style="color:#000000"><span 
class="ectt-1200">\</span></span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">CSSE6400</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">Queue</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">Prac</span></span> 
<span class="label"><a 
 id="x1-10015r10"></a></span><span style="color:#000000"><span 
class="ectt-1200">@</span></span><span style="color:#000000"><span 
class="ectt-1200">\</span></span><span style="color:#000000"><span 
class="ectt-1200">_</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="tctt-1200">'</span></span><span style="color:#000000"><span 
class="ectt-1200">____</span></span><span style="color:#000000"><span 
class="tctt-1200">'</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">_</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">@</span></span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">csse6400</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">uqcloud</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">net</span></span> 
<span class="label"><a 
 id="x1-10016r11"></a></span><span style="color:#000000"><span 
class="ectt-1200">\</span></span><span style="color:#000000"><span 
class="ectt-1200">_X</span></span><span style="color:#000000"><span 
class="ectt-1200">\</span></span><span style="color:#000000"><span 
class="ectt-1200">_</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">__</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">_</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">X_</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span> 
<span class="label"><a 
 id="x1-10017r12"></a></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">\=/\----/\=/</span></span> 
<span class="label"><a 
 id="x1-10018r13"></a></span> 
<span class="label"><a 
 id="x1-10019r14"></a></span> 
<span class="label"><a 
 id="x1-10020r15"></a></span> 
<span class="label"><a 
 id="x1-10021r16"></a></span><span style="color:#000000"><span 
class="ectt-1200">Unable</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">to</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">find</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">a</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">Queue</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">by</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">this</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">name</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">test</span></span>
 
<span class="label"><a 
 id="x1-10022r17"></a></span></pre>
   </div>
<!--l. 233--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">3.2    </span> <a 
 id="x1-110003.2"></a>SQS Standard</h4>
<!--l. 235--><p class="noindent" >The &#8220;standard&#8221; offering of SQS does not guarantee order or &#8220;only once delivery&#8221;. We will create a message
publisher and a message subscriber.
</p>
   <div class="tcolorbox tcolorbox" id="tcolobox-5">    
<div class="tcolorbox-title">
<!--l. 240--><p class="indent" >   Info</p></div> 
<div class="tcolorbox-content"><!--l. 240--><p class="noindent" >For the rest of this practical you will require multiple terminals. Make sure these are all in the same
folder so we can reuse the .enf file.  </p> 
</div> 
</div>
<!--l. 242--><p class="indent" >   To create the subscriber run the following command:
</p>
   <div class="framedenv" id="code-1">
<!--l. 244--><pre class="listings" id="listing-4"><span class="label"><a 
 id="x1-11001r1"></a></span><span style="color:#000000"><span 
class="ectt-1200">&#x003E;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">docker</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">run</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"><span 
class="ectt-1200">rm</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">it</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"><span 
class="ectt-1200">env</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">file</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">env</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">ghcr</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">io</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">csse6400</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">queue</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"><span 
class="ectt-1200">main</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"><span 
class="ectt-1200">name</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">csse6400_prac</span></span><span style="color:#000000"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"><span 
class="ectt-1200">client</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">name</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">Client</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">1"</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"><span 
class="ectt-1200">receive</span></span>
 
<span class="label"><a 
 id="x1-11002r2"></a></span></pre>
   </div>
   <hr class="figure" /><div class="figure" 
>
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    
<!--l. 249--><p class="noindent" ><img 
src="images/stacksub.png" alt="PIC"  
width="525" height="525"  />
                                                                                                    
                                                                                                    
</p>
   </div><hr class="endfigure" />
<!--l. 252--><p class="indent" >   Now start a publisher in another terminal.
</p>
   <div class="framedenv" id="code-1">
<!--l. 254--><pre class="listings" id="listing-5"><span class="label"><a 
 id="x1-11003r1"></a></span><span style="color:#000000"><span 
class="ectt-1200">&#x003E;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">docker</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">run</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"><span 
class="ectt-1200">rm</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">it</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"><span 
class="ectt-1200">env</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">file</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">env</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">ghcr</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">io</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">csse6400</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">queue</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"><span 
class="ectt-1200">main</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"><span 
class="ectt-1200">name</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">csse6400_prac</span></span><span style="color:#000000"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"><span 
class="ectt-1200">client</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">name</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">Client</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">1"</span></span>
 
<span class="label"><a 
 id="x1-11004r2"></a></span></pre>
   </div>
   <hr class="figure" /><div class="figure" 
>
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    
<!--l. 259--><p class="noindent" ><img 
src="images/stackpub.png" alt="PIC"  
width="525" height="525"  />
                                                                                                    
                                                                                                    
</p>
   </div><hr class="endfigure" />
<!--l. 262--><p class="indent" >   When the publisher connects to the queue it is going to put 100 messages of increasing increment into the
queue. On the subscriber we will be able to see the messages being received, an example is provided
below:
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    
<!--l. 266--><p class="noindent" ><img 
src="images/stacksubdata.png" alt="PIC"  
width="525" height="525"  />
                                                                                                    
                                                                                                    
</p>
   </div><hr class="endfigure" />
<!--l. 269--><p class="indent" >   Hopefully like our example you can see that some of the messages arrive out of order. Next add more
publishers and subscribers and experiment with the different configurations.
</p>
   <div class="tcolorbox tcolorbox" id="tcolobox-6">    
<div class="tcolorbox-title">
<!--l. 274--><p class="indent" >   Info</p></div> 
<div class="tcolorbox-content"><!--l. 274--><p class="noindent" >When making multiple publishes you may want to change the client-name cli parameter so you can
keep track of when the messages arrived at the subscribers.  </p> 
</div> 
</div>
   <h4 class="subsectionHead"><span class="titlemark">3.3    </span> <a 
 id="x1-120003.3"></a>SQS FIFO</h4>
<!--l. 278--><p class="noindent" >Now we will experiment with the FIFO based service offered by SQS. Like before, we will start a subscriber but
make sure the name of the queue matches the FIFO queue we created in terraform.
</p>
   <div class="framedenv" id="code-1">
<!--l. 281--><pre class="listings" id="listing-6"><span class="label"><a 
 id="x1-12001r1"></a></span><span style="color:#000000"><span 
class="ectt-1200">&#x003E;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">docker</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">run</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"><span 
class="ectt-1200">rm</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">it</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"><span 
class="ectt-1200">env</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">file</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">env</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">ghcr</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">io</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">csse6400</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">queue</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"><span 
class="ectt-1200">main</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"><span 
class="ectt-1200">name</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">csse6400_prac</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">fifo</span></span><span style="color:#000000"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"><span 
class="ectt-1200">client</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">name</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">Client</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">1"</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"><span 
class="ectt-1200">receive</span></span>
 
<span class="label"><a 
 id="x1-12002r2"></a></span></pre>
   </div>
<!--l. 285--><p class="indent" >   Now start a publisher in another terminal.
</p>
   <div class="framedenv" id="code-1">
<!--l. 287--><pre class="listings" id="listing-7"><span class="label"><a 
 id="x1-12003r1"></a></span><span style="color:#000000"><span 
class="ectt-1200">&#x003E;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">docker</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">run</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"><span 
class="ectt-1200">rm</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">it</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"><span 
class="ectt-1200">env</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">file</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">env</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">ghcr</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">io</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">csse6400</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">queue</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"><span 
class="ectt-1200">main</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"><span 
class="ectt-1200">name</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">csse6400_prac</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">fifo</span></span><span style="color:#000000"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"><span 
class="ectt-1200">client</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">name</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">Client</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">1"</span></span>
 
<span class="label"><a 
 id="x1-12004r2"></a></span></pre>
   </div>
   <hr class="figure" /><div class="figure" 
>
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    
<!--l. 292--><p class="noindent" ><img 
src="images/fifopub.png" alt="PIC"  
width="525" height="525"  />
                                                                                                    
                                                                                                    
</p>
   </div><hr class="endfigure" />
<!--l. 295--><p class="indent" >   On the subscriber we now see the messages arriving in order which is to be expected.
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    
<!--l. 298--><p class="noindent" ><img 
src="images/fifosub.png" alt="PIC"  
width="525" height="525"  />
                                                                                                    
                                                                                                    
</p>
   </div><hr class="endfigure" />
<!--l. 301--><p class="indent" >   If we re-run the publisher though we may not see any new messages make it to the consumer. This is because
we have asked AWS to de-dupe messages where it can.
</p><!--l. 308--><p class="indent" >   As before try experimenting with different publisher / subscriber configurations to see how they
behave.
</p>
   <div class="tcolorbox tcolorbox" id="tcolobox-7">    
<div class="tcolorbox-title">
<!--l. 312--><p class="indent" >   Info</p></div> 
<div class="tcolorbox-content"><!--l. 312--><p class="noindent" >When making multiple publishes you may want to change the client-name cli parameter so you can
keep track of when the messages arrived at the subscribers.  </p> 
</div> 
</div>
   <div class="tcolorbox tcolorbox" id="tcolobox-8">    
<div class="tcolorbox-title">
<!--l. 316--><p class="indent" >   Warning</p></div> 
<div class="tcolorbox-content"><!--l. 316--><p class="noindent" ><span 
class="Cabin-Bold-tlf-t1-x-x-120">Please remember to terraform destroy to delete your resources</span>  </p> 
</div> 
</div>
   <h3 class="sectionHead"><span class="titlemark">4    </span> <a 
 id="x1-130004"></a>Hosting TaskOverflow Images</h3>
<!--l. 321--><p class="noindent" >When we last deployed a container on AWS, we used an existing hosted image. Now, we will be developing our
own image, so we will need a mechanism to host the image. For this, we will being using an AWS ECR, Docker, and
Terraform. AWS ECR is the Elastic Container Registry, it is a container registry like DockerHub or GitHub. We can
use it to host our images, using the process below:
</p><!--l. 331--><p class="indent" >
      </p><ol  class="enumerate1" >
<li 
  class="enumerate" id="x1-13002x1">
      <!--l. 332--><p class="noindent" >Use Terraform to create an ECR repository for our image.
      </p></li>
<li 
  class="enumerate" id="x1-13004x2">
      <!--l. 333--><p class="noindent" >Use Terraform to build our Docker image.
      </p></li>
<li 
  class="enumerate" id="x1-13006x3">
      <!--l. 334--><p class="noindent" >Use Terraform to push our Docker image.</p></li></ol>
   <div class="tcolorbox tcolorbox" id="tcolobox-9">    
<div class="tcolorbox-title">
<!--l. 345--><p class="indent" >   Info</p></div> 
<div class="tcolorbox-content"><!--l. 345--><p class="noindent" >This is a non-standard process. As you may have seen in the DevOps tutorial, we would ordinarily
like our code commits to trigger a CI/CD pipeline which builds the images.
</p><!--l. 345--><p class="noindent" >If  you  would  like,  you  can  use  GitHub  actions  to  build  and  push  your  container  to  the  GitHub
container registry and authenticate when you pull the image. However, using ECR simplifies the
process, despite the oddities introduced by having a non-persistent ECR repository.  </p> 
</div> 
</div>
<!--l. 347--><p class="noindent" ><span class="paragraphHead"><a 
 id="x1-14000"></a><span 
class="Cabin-Bold-tlf-t1-x-x-120">Getting Started</span></span>
      </p><ol  class="enumerate1" >
<li 
  class="enumerate" id="x1-14002x1">
      <!--l. 350--><p class="noindent" >Using the GitHub Classroom link for this practical provided by your tutor in Slack, create a repository
      to work within.
                                                                                                    
                                                                                                    
      </p></li>
<li 
  class="enumerate" id="x1-14004x2">
      <!--l. 351--><p class="noindent" >Install Terraform if not already installed, as it will be required again this week.
      </p></li>
<li 
  class="enumerate" id="x1-14006x3">
      <!--l. 352--><p class="noindent" >Start your learner lab and copy the AWS Learner Lab credentials into a credentials file in the root of
      the repository.</p></li></ol>
<!--l. 355--><p class="noindent" ><span class="paragraphHead"><a 
 id="x1-15000"></a><span 
class="Cabin-Bold-tlf-t1-x-x-120">What&#8217;s New</span></span>
   We are starting again with our todo application from roughly where we left off in the week 3
practical. We&#8217;ve added a new directory <span 
class="ectt-1200">todo/app </span>that has the static HTML files for the TaskOverflow
website and added a route to serve these files. We have also created a production version of the
server that uses gunicorn, the <span 
class="ectt-1200">bin </span>directory is used by this image. Our original Docker image is now in
<span 
class="ectt-1200">Dockerfile.dev</span>.<br 
class="newline" />
</p><!--l. 363--><p class="indent" >   We will setup our initial Terraform configuration. Note that now we introduce a new required provider. This
provider is for Docker.
</p><!--l. 367--><p class="indent" >   </p><div class="framedenv" id="code-1">
<!--l. 367--><p class="indent" >   <span 
class="ectt-1200"> cat main.tf</span> </p></div>   <div class="framedenv" id="code-1"><!--l. 367--><pre class="listings" id="listing-8"><span class="label"><a 
 id="x1-15001r1"></a></span><span style="color:#006699"><span 
class="ectt-1200">terraform</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-15002r2"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#006699"><span 
class="ectt-1200">required_providers</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-15003r3"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">aws</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-15004r4"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">source</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">hashicorp</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">aws</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-15005r5"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">version</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">~&#x003E;</span></span><span style="color:#669900"> </span><span style="color:#669900"><span 
class="ectt-1200">4.0</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-15006r6"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">}</span></span> 
<span class="label"><a 
 id="x1-15007r7"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">docker</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-15008r8"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">source</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">kreuzwerker</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">docker</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-15009r9"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">version</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">3.0.2</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-15010r10"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">}</span></span> 
<span class="label"><a 
 id="x1-15011r11"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">}</span></span> 
<span class="label"><a 
 id="x1-15012r12"></a></span><span style="color:#000000"><span 
class="ectt-1200">}</span></span> 
<span class="label"><a 
 id="x1-15013r13"></a></span> 
<span class="label"><a 
 id="x1-15014r14"></a></span><span style="color:#006699"><span 
class="ectt-1200">provider</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">aws</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-15015r15"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">region</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">us</span></span><span style="color:#669900"><span 
class="ectt-1200">-</span></span><span style="color:#669900"><span 
class="ectt-1200">east</span></span><span style="color:#669900"><span 
class="ectt-1200">-1</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-15016r16"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">shared_credentials_files</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">[</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">./</span></span><span style="color:#669900"><span 
class="ectt-1200">credentials</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">]</span></span> 
<span class="label"><a 
 id="x1-15017r17"></a></span><span style="color:#000000"><span 
class="ectt-1200">}</span></span>
 
<span class="label"><a 
 id="x1-15018r18"></a></span></pre>
   </div>
<!--l. 387--><p class="indent" >   As with our AWS provider, when we initially configure the provider, we want to authenticate so that we can
later push to our registry using the Docker provider. We will use the <span 
class="ectt-1200">aws_ecr_authorization_token </span>data block to
get appropriate ECR credentials for Docker.
</p><!--l. 392--><p class="indent" >   </p><div class="framedenv" id="code-1">
<!--l. 392--><p class="indent" >   <span 
class="ectt-1200"> cat main.tf</span> </p></div>   <div class="framedenv" id="code-1"><!--l. 392--><pre class="listings" id="listing-9"><span class="label"><a 
 id="x1-15019r1"></a></span><span style="color:#006699"><span 
class="ectt-1200">data</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">aws_ecr_authorization_token</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">ecr_token</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{}</span></span> 
<span class="label"><a 
 id="x1-15020r2"></a></span> 
<span class="label"><a 
 id="x1-15021r3"></a></span><span style="color:#006699"><span 
class="ectt-1200">provider</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">docker</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-15022r4"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">registry_auth</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-15023r5"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">address</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#006699"><span 
class="ectt-1200">data</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">aws_ecr_authorization_token</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">ecr_token</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">proxy_endpoint</span></span> 
<span class="label"><a 
 id="x1-15024r6"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">username</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#006699"><span 
class="ectt-1200">data</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">aws_ecr_authorization_token</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">ecr_token</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">user_name</span></span> 
<span class="label"><a 
 id="x1-15025r7"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">password</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#006699"><span 
class="ectt-1200">data</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">aws_ecr_authorization_token</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">ecr_token</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">password</span></span> 
<span class="label"><a 
 id="x1-15026r8"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">}</span></span> 
<span class="label"><a 
 id="x1-15027r9"></a></span><span style="color:#000000"><span 
class="ectt-1200">}</span></span>
 
<span class="label"><a 
 id="x1-15028r10"></a></span></pre>
   </div>
<!--l. 404--><p class="indent" >   We need to use Terraform to create an ECR repository to push to.
</p><!--l. 406--><p class="indent" >   </p><div class="framedenv" id="code-1">
<!--l. 406--><p class="indent" >   <span 
class="ectt-1200"> cat main.tf</span> </p></div>   <div class="framedenv" id="code-1"><!--l. 406--><pre class="listings" id="listing-10"><span class="label"><a 
 id="x1-15029r1"></a></span><span style="color:#006699"><span 
class="ectt-1200">resource</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">aws_ecr_repository</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">taskoverflow</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-15030r2"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">name</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">taskoverflow</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-15031r3"></a></span><span style="color:#000000"><span 
class="ectt-1200">}</span></span>
 
<span class="label"><a 
 id="x1-15032r4"></a></span></pre>
   </div>
<!--l. 412--><p class="indent" >   The URL for containers in the ECR following the format below:
</p><!--l. 414--><p class="indent" >   <a 
href="{ACCOUNT_ID}.dkr.ecr.{REGION}.amazonaws.com/{REPOSITORY_NAME}" class="url" ><span 
class="ectt-1200">{ACCOUNT_ID}.dkr.ecr.{REGION}.amazonaws.com/{REPOSITORY_NAME}</span></a>
</p><!--l. 416--><p class="indent" >   Remember &#8212; to push to a container registry we need a local container whose tag matches the remote URL.
We could then create and push the contianer locally with:
</p>
   <div class="framedenv" id="code-1">
<!--l. 420--><pre class="listings" id="listing-11"><span class="label"><a 
 id="x1-15033r1"></a></span><span style="color:#000000"><span 
class="ectt-1200">docker</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">build</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">t</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span><span style="color:#000000"><span 
class="ectt-1200">ACCOUNT_ID</span></span><span style="color:#000000"><span 
class="ectt-1200">}.</span></span><span style="color:#000000"><span 
class="ectt-1200">dkr</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">ecr</span></span><span style="color:#000000"><span 
class="ectt-1200">.{</span></span><span style="color:#000000"><span 
class="ectt-1200">REGION</span></span><span style="color:#000000"><span 
class="ectt-1200">}.</span></span><span style="color:#000000"><span 
class="ectt-1200">amazonaws</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">com</span></span><span style="color:#000000"><span 
class="ectt-1200">/{</span></span><span style="color:#000000"><span 
class="ectt-1200">REPOSITORY_NAME</span></span><span style="color:#000000"><span 
class="ectt-1200">}</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">.</span></span> 
<span class="label"><a 
 id="x1-15034r2"></a></span><span style="color:#000000"><span 
class="ectt-1200">docker</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">push</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span><span style="color:#000000"><span 
class="ectt-1200">ACCOUNT_ID</span></span><span style="color:#000000"><span 
class="ectt-1200">}.</span></span><span style="color:#000000"><span 
class="ectt-1200">dkr</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">ecr</span></span><span style="color:#000000"><span 
class="ectt-1200">.{</span></span><span style="color:#000000"><span 
class="ectt-1200">REGION</span></span><span style="color:#000000"><span 
class="ectt-1200">}.</span></span><span style="color:#000000"><span 
class="ectt-1200">amazonaws</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">com</span></span><span style="color:#000000"><span 
class="ectt-1200">/{</span></span><span style="color:#000000"><span 
class="ectt-1200">REPOSITORY_NAME</span></span><span style="color:#000000"><span 
class="ectt-1200">}</span></span>
 
<span class="label"><a 
 id="x1-15035r3"></a></span></pre>
   </div>
<!--l. 425--><p class="indent" >   However, it would be easier if we could build and push this container from within Terraform. We can use the
Docker provider for this.
</p><!--l. 428--><p class="indent" >   </p><div class="framedenv" id="code-1">
<!--l. 428--><p class="indent" >   <span 
class="ectt-1200"> cat image.tf</span> </p></div>   <div class="framedenv" id="code-1">
                                                                                                    
                                                                                                    
<!--l. 428--><pre class="listings" id="listing-12"><span class="label"><a 
 id="x1-15036r1"></a></span><span style="color:#006699"><span 
class="ectt-1200">resource</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">docker_image</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">taskoverflow</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-15037r2"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">name</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">$</span></span><span style="color:#669900"><span 
class="ectt-1200">{</span></span><span style="color:#669900"><span 
class="ectt-1200">aws_ecr_repository</span></span><span style="color:#669900"><span 
class="ectt-1200">.</span></span><span style="color:#669900"><span 
class="ectt-1200">taskoverflow</span></span><span style="color:#669900"><span 
class="ectt-1200">.</span></span><span style="color:#669900"><span 
class="ectt-1200">repository_url</span></span><span style="color:#669900"><span 
class="ectt-1200">}:</span></span><span style="color:#669900"><span 
class="ectt-1200">latest</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-15038r3"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">build</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-15039r4"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">context</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">.</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-15040r5"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">}</span></span> 
<span class="label"><a 
 id="x1-15041r6"></a></span><span style="color:#000000"><span 
class="ectt-1200">}</span></span> 
<span class="label"><a 
 id="x1-15042r7"></a></span> 
<span class="label"><a 
 id="x1-15043r8"></a></span><span style="color:#006699"><span 
class="ectt-1200">resource</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">docker_registry_image</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">taskoverflow</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-15044r9"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">name</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">docker_image</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">taskoverflow</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">name</span></span> 
<span class="label"><a 
 id="x1-15045r10"></a></span><span style="color:#000000"><span 
class="ectt-1200">}</span></span>
 
<span class="label"><a 
 id="x1-15046r11"></a></span></pre>
   </div>
<!--l. 441--><p class="indent" >   Notice that we are able to utilize the output of the ECR repository as the URL which resolves to the correct
URL for the image.
</p><!--l. 443--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">5    </span> <a 
 id="x1-160005"></a>Worker Queues</h3>
<!--l. 445--><p class="noindent" >One good use case for queues is for distributing work to scale to demand. In this exercise we encourage you
to have a look at these widly used libraries to see how you could integrate them into a distributed
system.
</p>
      <ul class="itemize1">
      <li class="itemize">
      <!--l. 449--><p class="noindent" >Python: <a 
href="https://docs.celeryq.dev/en/stable/" >Celery</a>
      </p></li>
      <li class="itemize">
      <!--l. 450--><p class="noindent" >Java: <a 
href="https://www.rabbitmq.com/tutorials/tutorial-one-java.html" >RabbitMQ</a></p></li></ul>
<!--l. 453--><p class="indent" >   The two above libraries are integrated into many popular application frameworks. Today we will be using the
Python library Celery to create a simple worker queue for TaskOverflow.
</p><!--l. 456--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">5.1    </span> <a 
 id="x1-170005.1"></a>Celery</h4>
<!--l. 458--><p class="noindent" >Celery is a Python library which allows you to create a worker queue. It is popular and used in many large scale
applications. It is also relatively easy to use and has comprehensive documentation.
</p><!--l. 463--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">6    </span> <a 
 id="x1-180006"></a>Task Calendar</h3>
<!--l. 465--><p class="noindent" >TaskOverflow will use celery to distribute the work of generating a calendar view of tasks, as this could be a time-intensive
task.<span class="footnote-mark"><a 
href="#fn1x0" id="fn1x0-bk"><sup class="textsuperscript">1</sup></a></span><a 
 id="x1-18001f1"></a>
This will be done by a worker which will run in a separate container. The TaskOverflow server will place job
requests on the Celery queue. The worker will pick-up jobs and generate the calendar. The webserver can then
serve the calendar to the user.
</p><!--l. 473--><p class="indent" >   Calendar generation occurs asynchronously with this architecture. The user will not have to wait for the
calendar view to be generated and the webserver can handle other requests.
                                                                                                    
                                                                                                    
</p><!--l. 476--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">6.1    </span> <a 
 id="x1-190006.1"></a>API Extension</h4>
<!--l. 479--><p class="noindent" >We will extend our existing API with the following endpoints.
</p><!--l. 481--><p class="indent" >
      </p><dl class="description"><dt class="description">
      <!--l. 482--><p class="noindent" >
<span 
class="Cabin-Bold-tlf-t1-x-x-120">POST /todos/ical</span> </p></dt><dd 
class="description">
      <!--l. 482--><p class="noindent" >Create an asynchronous calendar generation job.<span class="footnote-mark"><a 
href="#fn2x0" id="fn2x0-bk"><sup class="textsuperscript">2</sup></a></span><a 
 id="x1-19001f2"></a>
      </p></dd><dt class="description">
      <!--l. 483--><p class="noindent" >
<span 
class="Cabin-Bold-tlf-t1-x-x-120">GET /todos/ical/{task_id}/status</span> </p></dt><dd 
class="description">
      <!--l. 483--><p class="noindent" >Check the status of the generation job.
      </p></dd><dt class="description">
      <!--l. 484--><p class="noindent" >
<span 
class="Cabin-Bold-tlf-t1-x-x-120">GET /todos/ical/{task_id}/result</span> </p></dt><dd 
class="description">
      <!--l. 484--><p class="noindent" >Download the generated iCal file when it is ready.</p></dd></dl>
<!--l. 487--><p class="indent" >   An example interaction with the API might look like:
</p>
   <div class="framedenv" id="code-1">
<!--l. 489--><pre class="listings" id="listing-13"><span class="label"><a 
 id="x1-19003r1"></a></span><span style="color:#000000"><span 
class="ectt-1200">&#x003E;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">curl</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">X</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">POST</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">http</span></span><span style="color:#000000"><span 
class="ectt-1200">://</span></span><span style="color:#000000"><span 
class="ectt-1200">localhost</span></span><span style="color:#000000"><span 
class="ectt-1200">:6400/</span></span><span style="color:#000000"><span 
class="ectt-1200">api</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">v1</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">todos</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">ical</span></span> 
<span class="label"><a 
 id="x1-19004r2"></a></span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-19005r3"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">task_id</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">2</span></span><span style="color:#669900"><span 
class="ectt-1200">e80aefd</span></span><span style="color:#669900"><span 
class="ectt-1200">-4</span></span><span style="color:#669900"><span 
class="ectt-1200">a69</span></span><span style="color:#669900"><span 
class="ectt-1200">-4</span></span><span style="color:#669900"><span 
class="ectt-1200">a94</span></span><span style="color:#669900"><span 
class="ectt-1200">-</span></span><span style="color:#669900"><span 
class="ectt-1200">b23a</span></span><span style="color:#669900"><span 
class="ectt-1200">-45</span></span><span style="color:#669900"><span 
class="ectt-1200">f2b8110988</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span> 
<span class="label"><a 
 id="x1-19006r4"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">task_url</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">http</span></span><span style="color:#669900"><span 
class="ectt-1200">://</span></span><span style="color:#669900"><span 
class="ectt-1200">localhost</span></span><span style="color:#669900"><span 
class="ectt-1200">:6400/</span></span><span style="color:#669900"><span 
class="ectt-1200">api</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">v1</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">todos</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">ical</span></span><span style="color:#669900"><span 
class="ectt-1200">/2</span></span><span style="color:#669900"><span 
class="ectt-1200">e80aefd</span></span><span style="color:#669900"><span 
class="ectt-1200">-4</span></span><span style="color:#669900"><span 
class="ectt-1200">a69</span></span><span style="color:#669900"><span 
class="ectt-1200">-4</span></span><span style="color:#669900"><span 
class="ectt-1200">a94</span></span><span style="color:#669900"><span 
class="ectt-1200">-</span></span><span style="color:#669900"><span 
class="ectt-1200">b23a</span></span><span style="color:#669900"><span 
class="ectt-1200">-45</span></span><span style="color:#669900"><span 
class="ectt-1200">f2b8110988</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">status</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-19007r5"></a></span><span style="color:#000000"><span 
class="ectt-1200">}</span></span> 
<span class="label"><a 
 id="x1-19008r6"></a></span><span style="color:#000000"><span 
class="ectt-1200">&#x003E;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">curl</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">X</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">GET</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">http</span></span><span style="color:#000000"><span 
class="ectt-1200">://</span></span><span style="color:#000000"><span 
class="ectt-1200">localhost</span></span><span style="color:#000000"><span 
class="ectt-1200">:6400/</span></span><span style="color:#000000"><span 
class="ectt-1200">api</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">v1</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">todos</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">ical</span></span><span style="color:#000000"><span 
class="ectt-1200">/2</span></span><span style="color:#000000"><span 
class="ectt-1200">e80aefd</span></span><span style="color:#000000"><span 
class="ectt-1200">-4</span></span><span style="color:#000000"><span 
class="ectt-1200">a69</span></span><span style="color:#000000"><span 
class="ectt-1200">-4</span></span><span style="color:#000000"><span 
class="ectt-1200">a94</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">b23a</span></span><span style="color:#000000"><span 
class="ectt-1200">-45</span></span><span style="color:#000000"><span 
class="ectt-1200">f2b8110988</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">status</span></span> 
<span class="label"><a 
 id="x1-19009r7"></a></span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-19010r8"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">result_url</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">http</span></span><span style="color:#669900"><span 
class="ectt-1200">://</span></span><span style="color:#669900"><span 
class="ectt-1200">localhost</span></span><span style="color:#669900"><span 
class="ectt-1200">:6400/</span></span><span style="color:#669900"><span 
class="ectt-1200">api</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">v1</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">todos</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">ical</span></span><span style="color:#669900"><span 
class="ectt-1200">/2</span></span><span style="color:#669900"><span 
class="ectt-1200">e80aefd</span></span><span style="color:#669900"><span 
class="ectt-1200">-4</span></span><span style="color:#669900"><span 
class="ectt-1200">a69</span></span><span style="color:#669900"><span 
class="ectt-1200">-4</span></span><span style="color:#669900"><span 
class="ectt-1200">a94</span></span><span style="color:#669900"><span 
class="ectt-1200">-</span></span><span style="color:#669900"><span 
class="ectt-1200">b23a</span></span><span style="color:#669900"><span 
class="ectt-1200">-45</span></span><span style="color:#669900"><span 
class="ectt-1200">f2b8110988</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">result</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span> 
<span class="label"><a 
 id="x1-19011r9"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">task_id</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">2</span></span><span style="color:#669900"><span 
class="ectt-1200">e80aefd</span></span><span style="color:#669900"><span 
class="ectt-1200">-4</span></span><span style="color:#669900"><span 
class="ectt-1200">a69</span></span><span style="color:#669900"><span 
class="ectt-1200">-4</span></span><span style="color:#669900"><span 
class="ectt-1200">a94</span></span><span style="color:#669900"><span 
class="ectt-1200">-</span></span><span style="color:#669900"><span 
class="ectt-1200">b23a</span></span><span style="color:#669900"><span 
class="ectt-1200">-45</span></span><span style="color:#669900"><span 
class="ectt-1200">f2b8110988</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span> 
<span class="label"><a 
 id="x1-19012r10"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">task_status</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">PENDING</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-19013r11"></a></span><span style="color:#000000"><span 
class="ectt-1200">}</span></span> 
<span class="label"><a 
 id="x1-19014r12"></a></span><span style="color:#000000"><span 
class="ectt-1200">&#x003E;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">curl</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">X</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">GET</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">http</span></span><span style="color:#000000"><span 
class="ectt-1200">://</span></span><span style="color:#000000"><span 
class="ectt-1200">localhost</span></span><span style="color:#000000"><span 
class="ectt-1200">:6400/</span></span><span style="color:#000000"><span 
class="ectt-1200">api</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">v1</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">todos</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">ical</span></span><span style="color:#000000"><span 
class="ectt-1200">/2</span></span><span style="color:#000000"><span 
class="ectt-1200">e80aefd</span></span><span style="color:#000000"><span 
class="ectt-1200">-4</span></span><span style="color:#000000"><span 
class="ectt-1200">a69</span></span><span style="color:#000000"><span 
class="ectt-1200">-4</span></span><span style="color:#000000"><span 
class="ectt-1200">a94</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">b23a</span></span><span style="color:#000000"><span 
class="ectt-1200">-45</span></span><span style="color:#000000"><span 
class="ectt-1200">f2b8110988</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">status</span></span> 
<span class="label"><a 
 id="x1-19015r13"></a></span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-19016r14"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">result_url</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">http</span></span><span style="color:#669900"><span 
class="ectt-1200">://</span></span><span style="color:#669900"><span 
class="ectt-1200">localhost</span></span><span style="color:#669900"><span 
class="ectt-1200">:6400/</span></span><span style="color:#669900"><span 
class="ectt-1200">api</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">v1</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">todos</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">ical</span></span><span style="color:#669900"><span 
class="ectt-1200">/2</span></span><span style="color:#669900"><span 
class="ectt-1200">e80aefd</span></span><span style="color:#669900"><span 
class="ectt-1200">-4</span></span><span style="color:#669900"><span 
class="ectt-1200">a69</span></span><span style="color:#669900"><span 
class="ectt-1200">-4</span></span><span style="color:#669900"><span 
class="ectt-1200">a94</span></span><span style="color:#669900"><span 
class="ectt-1200">-</span></span><span style="color:#669900"><span 
class="ectt-1200">b23a</span></span><span style="color:#669900"><span 
class="ectt-1200">-45</span></span><span style="color:#669900"><span 
class="ectt-1200">f2b8110988</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">result</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span> 
<span class="label"><a 
 id="x1-19017r15"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">task_id</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">2</span></span><span style="color:#669900"><span 
class="ectt-1200">e80aefd</span></span><span style="color:#669900"><span 
class="ectt-1200">-4</span></span><span style="color:#669900"><span 
class="ectt-1200">a69</span></span><span style="color:#669900"><span 
class="ectt-1200">-4</span></span><span style="color:#669900"><span 
class="ectt-1200">a94</span></span><span style="color:#669900"><span 
class="ectt-1200">-</span></span><span style="color:#669900"><span 
class="ectt-1200">b23a</span></span><span style="color:#669900"><span 
class="ectt-1200">-45</span></span><span style="color:#669900"><span 
class="ectt-1200">f2b8110988</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span> 
<span class="label"><a 
 id="x1-19018r16"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">task_status</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">SUCCESS</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-19019r17"></a></span><span style="color:#000000"><span 
class="ectt-1200">}</span></span> 
<span class="label"><a 
 id="x1-19020r18"></a></span><span style="color:#000000"><span 
class="ectt-1200">&#x003E;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">curl</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">X</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">GET</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">http</span></span><span style="color:#000000"><span 
class="ectt-1200">://</span></span><span style="color:#000000"><span 
class="ectt-1200">localhost</span></span><span style="color:#000000"><span 
class="ectt-1200">:6400/</span></span><span style="color:#000000"><span 
class="ectt-1200">api</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">v1</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">todos</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">ical</span></span><span style="color:#000000"><span 
class="ectt-1200">/2</span></span><span style="color:#000000"><span 
class="ectt-1200">e80aefd</span></span><span style="color:#000000"><span 
class="ectt-1200">-4</span></span><span style="color:#000000"><span 
class="ectt-1200">a69</span></span><span style="color:#000000"><span 
class="ectt-1200">-4</span></span><span style="color:#000000"><span 
class="ectt-1200">a94</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">b23a</span></span><span style="color:#000000"><span 
class="ectt-1200">-45</span></span><span style="color:#000000"><span 
class="ectt-1200">f2b8110988</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">result</span></span> 
<span class="label"><a 
 id="x1-19021r19"></a></span><span style="color:#000000"><span 
class="ectt-1200">BEGIN</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"><span 
class="ectt-1200">VCALENDAR</span></span> 
<span class="label"><a 
 id="x1-19022r20"></a></span><span style="color:#000000"><span 
class="ectt-1200">VERSION</span></span><span style="color:#000000"><span 
class="ectt-1200">:2.0</span></span> 
<span class="label"><a 
 id="x1-19023r21"></a></span><span style="color:#000000"><span 
class="ectt-1200">PRODID</span></span><span style="color:#000000"><span 
class="ectt-1200">:-//</span></span><span style="color:#000000"><span 
class="ectt-1200">Taskoverflow</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">Calendar</span></span><span style="color:#000000"><span 
class="ectt-1200">//</span></span><span style="color:#000000"><span 
class="ectt-1200">mxm</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">dk</span></span><span style="color:#000000"><span 
class="ectt-1200">//</span></span> 
<span class="label"><a 
 id="x1-19024r22"></a></span><span style="color:#000000"><span 
class="ectt-1200">BEGIN</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"><span 
class="ectt-1200">VEVENT</span></span> 
<span class="label"><a 
 id="x1-19025r23"></a></span><span style="color:#000000"><span 
class="ectt-1200">SUMMARY</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"><span 
class="ectt-1200">Project</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">Proposal</span></span> 
<span class="label"><a 
 id="x1-19026r24"></a></span><span style="color:#000000"><span 
class="ectt-1200">DTSTART</span></span><span style="color:#000000"><span 
class="ectt-1200">:20230403</span></span><span style="color:#000000"><span 
class="ectt-1200">T140000</span></span> 
<span class="label"><a 
 id="x1-19027r25"></a></span><span style="color:#000000"><span 
class="ectt-1200">UID</span></span><span style="color:#000000"><span 
class="ectt-1200">:1</span></span> 
<span class="label"><a 
 id="x1-19028r26"></a></span><span style="color:#000000"><span 
class="ectt-1200">DESCRIPTION</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"><span 
class="ectt-1200">CSSE6400</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">Project</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">Proposal</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">Due</span></span> 
<span class="label"><a 
 id="x1-19029r27"></a></span><span style="color:#000000"><span 
class="ectt-1200">END</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"><span 
class="ectt-1200">VEVENT</span></span> 
<span class="label"><a 
 id="x1-19030r28"></a></span><span style="color:#000000"><span 
class="ectt-1200">END</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"><span 
class="ectt-1200">VCALENDAR</span></span>
 
<span class="label"><a 
 id="x1-19031r29"></a></span></pre>
   </div>
<!--l. 520--><p class="indent" >   We will stub out the implementation of these endpoints.
</p><!--l. 522--><p class="indent" >   </p><div class="framedenv" id="code-1">
<!--l. 522--><p class="indent" >   <span 
class="ectt-1200"> cat todo/views/routes.py</span> </p></div>   <div class="framedenv" id="code-1"><!--l. 522--><pre class="listings" id="listing-14"><span class="label"><a 
 id="x1-19032r1"></a></span><span style="color:#000000"><span 
class="ectt-1200">@api</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">route</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">todos</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">ical</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">methods</span></span><span style="color:#000000"><span 
class="ectt-1200">=[</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#669900"><span 
class="ectt-1200">POST</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#000000"><span 
class="ectt-1200">])</span></span> 
<span class="label"><a 
 id="x1-19033r2"></a></span><span style="color:#006699"><span 
class="ectt-1200">def</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">create_ical</span></span><span style="color:#000000"><span 
class="ectt-1200">()</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span> 
<span class="label"><a 
 id="x1-19034r3"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#006699"><span 
class="ectt-1200">pass</span></span> 
<span class="label"><a 
 id="x1-19035r4"></a></span> 
<span class="label"><a 
 id="x1-19036r5"></a></span><span style="color:#000000"><span 
class="ectt-1200">@api</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">route</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">todos</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">ical</span></span><span style="color:#669900"><span 
class="ectt-1200">/&#x003C;</span></span><span style="color:#669900"><span 
class="ectt-1200">task_id</span></span><span style="color:#669900"><span 
class="ectt-1200">&#x003E;/</span></span><span style="color:#669900"><span 
class="ectt-1200">status</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">methods</span></span><span style="color:#000000"><span 
class="ectt-1200">=[</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#669900"><span 
class="ectt-1200">GET</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#000000"><span 
class="ectt-1200">])</span></span> 
<span class="label"><a 
 id="x1-19037r6"></a></span><span style="color:#006699"><span 
class="ectt-1200">def</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">get_task</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#000000"><span 
class="ectt-1200">task_id</span></span><span style="color:#000000"><span 
class="ectt-1200">)</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span> 
<span class="label"><a 
 id="x1-19038r7"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#006699"><span 
class="ectt-1200">pass</span></span> 
<span class="label"><a 
 id="x1-19039r8"></a></span> 
<span class="label"><a 
 id="x1-19040r9"></a></span><span style="color:#000000"><span 
class="ectt-1200">@api</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">route</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">todos</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">ical</span></span><span style="color:#669900"><span 
class="ectt-1200">/&#x003C;</span></span><span style="color:#669900"><span 
class="ectt-1200">task_id</span></span><span style="color:#669900"><span 
class="ectt-1200">&#x003E;/</span></span><span style="color:#669900"><span 
class="ectt-1200">result</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">methods</span></span><span style="color:#000000"><span 
class="ectt-1200">=[</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#669900"><span 
class="ectt-1200">GET</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#000000"><span 
class="ectt-1200">])</span></span> 
<span class="label"><a 
 id="x1-19041r10"></a></span><span style="color:#006699"><span 
class="ectt-1200">def</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">get_calendar</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#000000"><span 
class="ectt-1200">task_id</span></span><span style="color:#000000"><span 
class="ectt-1200">)</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span> 
<span class="label"><a 
 id="x1-19042r11"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#006699"><span 
class="ectt-1200">pass</span></span>
 
<span class="label"><a 
 id="x1-19043r12"></a></span></pre>
   </div>
<!--l. 536--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">6.2    </span> <a 
 id="x1-200006.2"></a>Queue and Workers</h4>
<!--l. 538--><p class="noindent" >Next we will modify our <span 
class="ectt-1200">docker-compose.yml </span>to include a local queuing service called Redis. We will later use
AWS SQS but as Celery supports multiple queues, we can use this to make the local development
easier.
</p><!--l. 542--><p class="indent" >   </p><div class="framedenv" id="code-1">
<!--l. 542--><p class="indent" >   <span 
class="ectt-1200"> cat docker-compose.yml</span> </p></div>   <div class="framedenv" id="code-1"><!--l. 542--><pre class="listings" id="listing-15"><span class="label"><a 
 id="x1-20001r1"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">redis</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span> 
<span class="label"><a 
 id="x1-20002r2"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">image</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">redis</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"><span 
class="ectt-1200">latest</span></span> 
<span class="label"><a 
 id="x1-20003r3"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">restart</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">always</span></span> 
<span class="label"><a 
 id="x1-20004r4"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">ports</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span> 
<span class="label"><a 
 id="x1-20005r5"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">"6379:6379"</span></span>
 
<span class="label"><a 
 id="x1-20006r6"></a></span></pre>
   </div>
<!--l. 550--><p class="indent" >   Now we have a queue, we will create the worker that accepts jobs from the queue. We will create this worker in
<span 
class="ectt-1200">todo/tasks/ical.py</span>.
</p><!--l. 554--><p class="indent" >   </p><div class="framedenv" id="code-1">
<!--l. 554--><p class="indent" >   <span 
class="ectt-1200"> cat todo/tasks/ical.py</span> </p></div>   <div class="framedenv" id="code-1"><!--l. 554--><pre class="listings" id="listing-16"><span class="label"><a 
 id="x1-20007r1"></a></span><span style="color:#006699"><span 
class="ectt-1200">import</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">os</span></span> 
<span class="label"><a 
 id="x1-20008r2"></a></span> 
<span class="label"><a 
 id="x1-20009r3"></a></span><span style="color:#006699"><span 
class="ectt-1200">from</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">celery</span></span><span style="color:#000000"> </span><span style="color:#006699"><span 
class="ectt-1200">import</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">Celery</span></span> 
<span class="label"><a 
 id="x1-20010r4"></a></span> 
<span class="label"><a 
 id="x1-20011r5"></a></span><span style="color:#000000"><span 
class="ectt-1200">celery</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">Celery</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#000000"><span 
class="ectt-1200">__name__</span></span><span style="color:#000000"><span 
class="ectt-1200">)</span></span> 
<span class="label"><a 
 id="x1-20012r6"></a></span><span style="color:#000000"><span 
class="ectt-1200">celery</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">conf</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">broker_url</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">os</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">environ</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">get</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">CELERY_BROKER_URL</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">)</span></span> 
<span class="label"><a 
 id="x1-20013r7"></a></span><span style="color:#000000"><span 
class="ectt-1200">celery</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">conf</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">result_backend</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">os</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">environ</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">get</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">CELERY_RESULT_BACKEND</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">)</span></span> 
<span class="label"><a 
 id="x1-20014r8"></a></span><span style="color:#000000"><span 
class="ectt-1200">celery</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">conf</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">task_default_queue</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">os</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">environ</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">get</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">CELERY_DEFAULT_QUEUE</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">ical</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">)</span></span> 
<span class="label"><a 
 id="x1-20015r9"></a></span> 
<span class="label"><a 
 id="x1-20016r10"></a></span><span style="color:#000000"><span 
class="ectt-1200">@celery</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">task</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#000000"><span 
class="ectt-1200">name</span></span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">ical</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">)</span></span> 
<span class="label"><a 
 id="x1-20017r11"></a></span><span style="color:#006699"><span 
class="ectt-1200">def</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">create_ical</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#000000"><span 
class="ectt-1200">tasks</span></span><span style="color:#000000"><span 
class="ectt-1200">)</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span> 
<span class="label"><a 
 id="x1-20018r12"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#006699"><span 
class="ectt-1200">return</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">Hello</span></span><span style="color:#669900"> </span><span style="color:#669900"><span 
class="ectt-1200">World</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span>
 
<span class="label"><a 
 id="x1-20019r13"></a></span></pre>
                                                                                                    
                                                                                                    
   </div>
<!--l. 569--><p class="indent" >   Note that we are getting a URL from the environment variables: <span 
class="ectt-1200">CELERY_BROKER_URL </span>and
<span 
class="ectt-1200">CELERY_RESULT_BACKEND</span>. We need to remember to set these variables in whichever environment the service is
run in.
</p><!--l. 573--><p class="indent" >   We need to install Celery. We will do this in the same pipenv environment as the Flask server as we will later
require our Flask server to use Celery to put jobs onto the task queue.
</p>
   <div class="framedenv" id="shaded*-1">
   <!--l. 576-->
<pre class="lstlisting" id="listing-17"><span class="label"><a 
 id="x1-20020r1"></a></span><span style="color:#000000"><span 
class="ectt-1200">$</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">pipenv</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">install</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">celery</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">redis</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">celery</span></span><span style="color:#000000"><span 
class="ectt-1200">[</span></span><span style="color:#000000"><span 
class="ectt-1200">sqs</span></span><span style="color:#000000"><span 
class="ectt-1200">]</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">boto3</span></span><span 
class="ectt-1200">&#x00A0;</span></pre>
   </div>
<!--l. 578--><p class="indent" >   The above will install the Celery core and Redis and AWS SQS drivers for communication.
</p><!--l. 580--><p class="indent" >   We will now start our local Redis queue and our worker to ensure that they can communicate.
</p>
   <div class="framedenv" id="shaded*-1">
   <!--l. 582-->
<pre class="lstlisting" id="listing-18"><span class="label"><a 
 id="x1-20021r1"></a></span><span style="color:#000000"><span 
class="ectt-1200">$</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">docker</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">compose</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">up</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">redis</span></span><span 
class="ectt-1200">&#x00A0;</span></pre>
   </div>
   <div class="framedenv" id="code-1">
<!--l. 584--><pre class="listings" id="listing-19"><span class="label"><a 
 id="x1-20022r1"></a></span><span style="color:#000000"><span 
class="ectt-1200">&#x003E;</span></span><span style="color:#000000"> </span><span style="color:#006699"><span 
class="ectt-1200">export</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">CELERY_BROKER_URL</span></span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"><span 
class="ectt-1200">redis</span></span><span style="color:#000000"><span 
class="ectt-1200">://</span></span><span style="color:#000000"><span 
class="ectt-1200">localhost</span></span><span style="color:#000000"><span 
class="ectt-1200">:6379</span></span> 
<span class="label"><a 
 id="x1-20023r2"></a></span><span style="color:#000000"><span 
class="ectt-1200">&#x003E;</span></span><span style="color:#000000"> </span><span style="color:#006699"><span 
class="ectt-1200">export</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">CELERY_RESULT_BACKEND</span></span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"><span 
class="ectt-1200">redis</span></span><span style="color:#000000"><span 
class="ectt-1200">://</span></span><span style="color:#000000"><span 
class="ectt-1200">localhost</span></span><span style="color:#000000"><span 
class="ectt-1200">:6379</span></span> 
<span class="label"><a 
 id="x1-20024r3"></a></span><span style="color:#000000"><span 
class="ectt-1200">&#x003E;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">pipenv</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">run</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">python3</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">m</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">celery</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"><span 
class="ectt-1200">app</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">todo</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">tasks</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">ical</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">worker</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"><span 
class="ectt-1200">loglevel</span></span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"><span 
class="ectt-1200">info</span></span>
 
<span class="label"><a 
 id="x1-20025r4"></a></span></pre>
   </div>
<!--l. 590--><p class="indent" >   You should see something like the below. This indicates that the worker has successfully subscribed to the
queue and is ready to accept events.
</p>
   <div class="framedenv" id="code-1">
<!--l. 593--><pre class="listings" id="listing-20"><span class="label"><a 
 id="x1-20026r1"></a></span> 
<span class="label"><a 
 id="x1-20027r2"></a></span><span style="color:#000000"><span 
class="ectt-1200">--------------</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">celery@uqbwebb2</span></span><span style="color:#000000"><span 
class="ectt-1200">-6842</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">v5</span></span><span style="color:#000000"><span 
class="ectt-1200">.2.7</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#000000"><span 
class="ectt-1200">dawn</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">chorus</span></span><span style="color:#000000"><span 
class="ectt-1200">)</span></span> 
<span class="label"><a 
 id="x1-20028r3"></a></span><span style="color:#000000"><span 
class="ectt-1200">---</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">*****</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">-----</span></span> 
<span class="label"><a 
 id="x1-20029r4"></a></span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">*******</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">----</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">macOS</span></span><span style="color:#000000"><span 
class="ectt-1200">-12.6.1-</span></span><span style="color:#000000"><span 
class="ectt-1200">x86_64</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">i386</span></span><span style="color:#000000"><span 
class="ectt-1200">-64</span></span><span style="color:#000000"><span 
class="ectt-1200">bit</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">2023-04-04</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">18:51:09</span></span> 
<span class="label"><a 
 id="x1-20030r5"></a></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">***</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">---</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">---</span></span> 
<span class="label"><a 
 id="x1-20031r6"></a></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">**</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">----------</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">[</span></span><span style="color:#000000"><span 
class="ectt-1200">config</span></span><span style="color:#000000"><span 
class="ectt-1200">]</span></span> 
<span class="label"><a 
 id="x1-20032r7"></a></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">**</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">----------</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">.&#x003E;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">app</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">todo</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">tasks</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">ical</span></span><span style="color:#000000"><span 
class="ectt-1200">:0</span></span><span style="color:#000000"><span 
class="ectt-1200">x10432e7d0</span></span> 
<span class="label"><a 
 id="x1-20033r8"></a></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">**</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">----------</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">.&#x003E;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">transport</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">redis</span></span><span style="color:#000000"><span 
class="ectt-1200">://</span></span><span style="color:#000000"><span 
class="ectt-1200">localhost</span></span><span style="color:#000000"><span 
class="ectt-1200">:6379//</span></span> 
<span class="label"><a 
 id="x1-20034r9"></a></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">**</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">----------</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">.&#x003E;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">results</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">redis</span></span><span style="color:#000000"><span 
class="ectt-1200">://</span></span><span style="color:#000000"><span 
class="ectt-1200">localhost</span></span><span style="color:#000000"><span 
class="ectt-1200">:6379/</span></span> 
<span class="label"><a 
 id="x1-20035r10"></a></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">***</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">---</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">---</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">.&#x003E;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">concurrency</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#000000"><span 
class="ectt-1200">prefork</span></span><span style="color:#000000"><span 
class="ectt-1200">)</span></span> 
<span class="label"><a 
 id="x1-20036r11"></a></span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">*******</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">----</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">.&#x003E;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">task</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">events</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">OFF</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#000000"><span 
class="ectt-1200">enable</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">E</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">to</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">monitor</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">tasks</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">in</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">this</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">worker</span></span><span style="color:#000000"><span 
class="ectt-1200">)</span></span> 
<span class="label"><a 
 id="x1-20037r12"></a></span><span style="color:#000000"><span 
class="ectt-1200">---</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">*****</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">-----</span></span> 
<span class="label"><a 
 id="x1-20038r13"></a></span><span style="color:#000000"><span 
class="ectt-1200">--------------</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">[</span></span><span style="color:#000000"><span 
class="ectt-1200">queues</span></span><span style="color:#000000"><span 
class="ectt-1200">]</span></span> 
<span class="label"><a 
 id="x1-20039r14"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">.&#x003E;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">celery</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">exchange</span></span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"><span 
class="ectt-1200">celery</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#000000"><span 
class="ectt-1200">direct</span></span><span style="color:#000000"><span 
class="ectt-1200">)</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">key</span></span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"><span 
class="ectt-1200">celery</span></span> 
<span class="label"><a 
 id="x1-20040r15"></a></span> 
<span class="label"><a 
 id="x1-20041r16"></a></span> 
<span class="label"><a 
 id="x1-20042r17"></a></span><span style="color:#000000"><span 
class="ectt-1200">[</span></span><span style="color:#000000"><span 
class="ectt-1200">tasks</span></span><span style="color:#000000"><span 
class="ectt-1200">]</span></span> 
<span class="label"><a 
 id="x1-20043r18"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">ical</span></span> 
<span class="label"><a 
 id="x1-20044r19"></a></span> 
<span class="label"><a 
 id="x1-20045r20"></a></span><span style="color:#000000"><span 
class="ectt-1200">[2023-04-04</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">18:51:10,059:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">INFO</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">MainProcess</span></span><span style="color:#000000"><span 
class="ectt-1200">]</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">Connected</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">to</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">redis</span></span><span style="color:#000000"><span 
class="ectt-1200">://</span></span><span style="color:#000000"><span 
class="ectt-1200">localhost</span></span><span style="color:#000000"><span 
class="ectt-1200">:6379//</span></span> 
<span class="label"><a 
 id="x1-20046r21"></a></span><span style="color:#000000"><span 
class="ectt-1200">[2023-04-04</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">18:51:10,065:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">INFO</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">MainProcess</span></span><span style="color:#000000"><span 
class="ectt-1200">]</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">mingle</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">searching</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">for</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">neighbors</span></span> 
<span class="label"><a 
 id="x1-20047r22"></a></span><span style="color:#000000"><span 
class="ectt-1200">[2023-04-04</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">18:51:11,200:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">INFO</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">MainProcess</span></span><span style="color:#000000"><span 
class="ectt-1200">]</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">mingle</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">sync</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">with</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">1</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">nodes</span></span> 
<span class="label"><a 
 id="x1-20048r23"></a></span><span style="color:#000000"><span 
class="ectt-1200">[2023-04-04</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">18:51:11,201:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">INFO</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">MainProcess</span></span><span style="color:#000000"><span 
class="ectt-1200">]</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">mingle</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">sync</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">complete</span></span> 
<span class="label"><a 
 id="x1-20049r24"></a></span><span style="color:#000000"><span 
class="ectt-1200">[2023-04-04</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">18:51:11,240:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">INFO</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">MainProcess</span></span><span style="color:#000000"><span 
class="ectt-1200">]</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">celery@uqbwebb2</span></span><span style="color:#000000"><span 
class="ectt-1200">-6842</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">ready</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span>
 
<span class="label"><a 
 id="x1-20050r25"></a></span></pre>
   </div>
<!--l. 620--><p class="indent" >   Finally, we will run Celery inside a new container. For this we will modify our <span 
class="ectt-1200">docker-compose.yml</span>
file.
</p><!--l. 623--><p class="indent" >   </p><div class="framedenv" id="code-1">
<!--l. 623--><p class="indent" >   <span 
class="ectt-1200"> cat docker-compose.yml</span> </p></div>   <div class="framedenv" id="code-1"><!--l. 623--><pre class="listings" id="listing-21"><span class="label"><a 
 id="x1-20051r1"></a></span><span style="color:#000000"><span 
class="ectt-1200">worker</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span> 
<span class="label"><a 
 id="x1-20052r2"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">build</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span> 
<span class="label"><a 
 id="x1-20053r3"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">context</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">.</span></span> 
<span class="label"><a 
 id="x1-20054r4"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">dockerfile</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">Dockerfile</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">dev</span></span> 
<span class="label"><a 
 id="x1-20055r5"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">restart</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">always</span></span> 
<span class="label"><a 
 id="x1-20056r6"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">environment</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span> 
<span class="label"><a 
 id="x1-20057r7"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">CELERY_BROKER_URL</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">redis</span></span><span style="color:#000000"><span 
class="ectt-1200">://</span></span><span style="color:#000000"><span 
class="ectt-1200">redis</span></span><span style="color:#000000"><span 
class="ectt-1200">:6379</span></span> 
<span class="label"><a 
 id="x1-20058r8"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">CELERY_RESULT_BACKEND</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">redis</span></span><span style="color:#000000"><span 
class="ectt-1200">://</span></span><span style="color:#000000"><span 
class="ectt-1200">redis</span></span><span style="color:#000000"><span 
class="ectt-1200">:6379</span></span> 
<span class="label"><a 
 id="x1-20059r9"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">command</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">celery</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"><span 
class="ectt-1200">app</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">todo</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">tasks</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">ical</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">worker</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"><span 
class="ectt-1200">loglevel</span></span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"><span 
class="ectt-1200">info</span></span>
 
<span class="label"><a 
 id="x1-20060r10"></a></span></pre>
   </div>
<!--l. 635--><p class="indent" >   Note that we are re-using the same image development image as the Flask server. This makes sense since it
shares very similar dependencies. It would make sense to separate the dependencies between the two containers
as they grow larger.
</p><!--l. 639--><p class="indent" >   We are overriding the command to run when the container starts to use the celery command. We have also
remembered to set the environment variables appropriately. We have to use the domain name of the redis
image instead of the localhost because redis is not running on our localhost. Earlier we were able to
pretend it was because the redis port, 6379, was being forwarded from our localhost to our redis
container.
                                                                                                    
                                                                                                    
</p><!--l. 644--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">6.3    </span> <a 
 id="x1-210006.3"></a>Creating Tasks</h4>
<!--l. 646--><p class="noindent" >We will now return to our Flask server. We can modify our new endpoints to use Celery to create tasks on the task
queue.
</p><!--l. 649--><p class="indent" >   </p><div class="framedenv" id="code-1">
<!--l. 649--><p class="indent" >   <span 
class="ectt-1200"> cat todo/views/routes.py</span> </p></div>   <div class="framedenv" id="code-1"><!--l. 649--><pre class="listings" id="listing-22"><span class="label"><a 
 id="x1-21001r1"></a></span><span style="color:#006699"><span 
class="ectt-1200">from</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">celery</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">result</span></span><span style="color:#000000"> </span><span style="color:#006699"><span 
class="ectt-1200">import</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">AsyncResult</span></span> 
<span class="label"><a 
 id="x1-21002r2"></a></span><span style="color:#006699"><span 
class="ectt-1200">from</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">todo</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">tasks</span></span><span style="color:#000000"> </span><span style="color:#006699"><span 
class="ectt-1200">import</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">ical</span></span> 
<span class="label"><a 
 id="x1-21003r3"></a></span> 
<span class="label"><a 
 id="x1-21004r4"></a></span><span style="color:#000000"><span 
class="ectt-1200">...</span></span> 
<span class="label"><a 
 id="x1-21005r5"></a></span> 
<span class="label"><a 
 id="x1-21006r6"></a></span><span style="color:#000000"><span 
class="ectt-1200">@api</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">route</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">todos</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">ical</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">methods</span></span><span style="color:#000000"><span 
class="ectt-1200">=[</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#669900"><span 
class="ectt-1200">POST</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#000000"><span 
class="ectt-1200">])</span></span> 
<span class="label"><a 
 id="x1-21007r7"></a></span><span style="color:#006699"><span 
class="ectt-1200">def</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">create_ical</span></span><span style="color:#000000"><span 
class="ectt-1200">()</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span> 
<span class="label"><a 
 id="x1-21008r8"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">todos</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">Todo</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">query</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">order_by</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#000000"><span 
class="ectt-1200">Todo</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">created_at</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">desc</span></span><span style="color:#000000"><span 
class="ectt-1200">()</span></span><span style="color:#000000"><span 
class="ectt-1200">)</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#006699"><span 
class="ectt-1200">all</span></span><span style="color:#000000"><span 
class="ectt-1200">()</span></span> 
<span class="label"><a 
 id="x1-21009r9"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">todo_input</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">[]</span></span> 
<span class="label"><a 
 id="x1-21010r10"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#006699"><span 
class="ectt-1200">for</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">todo</span></span><span style="color:#000000"> </span><span style="color:#006699"><span 
class="ectt-1200">in</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">todos</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span> 
<span class="label"><a 
 id="x1-21011r11"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">todo_input</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">append</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#000000"><span 
class="ectt-1200">todo</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">to_dict</span></span><span style="color:#000000"><span 
class="ectt-1200">()</span></span><span style="color:#000000"><span 
class="ectt-1200">)</span></span> 
<span class="label"><a 
 id="x1-21012r12"></a></span> 
<span class="label"><a 
 id="x1-21013r13"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">task</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">ical</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">create_ical</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">delay</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#000000"><span 
class="ectt-1200">todo_input</span></span><span style="color:#000000"><span 
class="ectt-1200">)</span></span> 
<span class="label"><a 
 id="x1-21014r14"></a></span> 
<span class="label"><a 
 id="x1-21015r15"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">result</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-21016r16"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#669900"><span 
class="ectt-1200">task_id</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">task</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#006699"><span 
class="ectt-1200">id</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span> 
<span class="label"><a 
 id="x1-21017r17"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#669900"><span 
class="ectt-1200">task_url</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">f</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#669900"><span 
class="ectt-1200">{</span></span><span style="color:#669900"><span 
class="ectt-1200">request</span></span><span style="color:#669900"><span 
class="ectt-1200">.</span></span><span style="color:#669900"><span 
class="ectt-1200">host_url</span></span><span style="color:#669900"><span 
class="ectt-1200">}</span></span><span style="color:#669900"><span 
class="ectt-1200">api</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">v1</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">todos</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">ical</span></span><span style="color:#669900"><span 
class="ectt-1200">/{</span></span><span style="color:#669900"><span 
class="ectt-1200">task</span></span><span style="color:#669900"><span 
class="ectt-1200">.</span></span><span style="color:#669900"><span 
class="ectt-1200">id</span></span><span style="color:#669900"><span 
class="ectt-1200">}/</span></span><span style="color:#669900"><span 
class="ectt-1200">status</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span> 
<span class="label"><a 
 id="x1-21018r18"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">}</span></span> 
<span class="label"><a 
 id="x1-21019r19"></a></span> 
<span class="label"><a 
 id="x1-21020r20"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#006699"><span 
class="ectt-1200">return</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">jsonify</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#000000"><span 
class="ectt-1200">result</span></span><span style="color:#000000"><span 
class="ectt-1200">)</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">202</span></span> 
<span class="label"><a 
 id="x1-21021r21"></a></span> 
<span class="label"><a 
 id="x1-21022r22"></a></span><span style="color:#000000"><span 
class="ectt-1200">@api</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">route</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">todos</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">ical</span></span><span style="color:#669900"><span 
class="ectt-1200">/&#x003C;</span></span><span style="color:#669900"><span 
class="ectt-1200">task_id</span></span><span style="color:#669900"><span 
class="ectt-1200">&#x003E;/</span></span><span style="color:#669900"><span 
class="ectt-1200">status</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">methods</span></span><span style="color:#000000"><span 
class="ectt-1200">=[</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#669900"><span 
class="ectt-1200">GET</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#000000"><span 
class="ectt-1200">])</span></span> 
<span class="label"><a 
 id="x1-21023r23"></a></span><span style="color:#006699"><span 
class="ectt-1200">def</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">get_task</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#000000"><span 
class="ectt-1200">task_id</span></span><span style="color:#000000"><span 
class="ectt-1200">)</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span> 
<span class="label"><a 
 id="x1-21024r24"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">task</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">AsyncResult</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#000000"><span 
class="ectt-1200">task_id</span></span><span style="color:#000000"><span 
class="ectt-1200">)</span></span> 
<span class="label"><a 
 id="x1-21025r25"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">result</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-21026r26"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">task_id</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">task_id</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span> 
<span class="label"><a 
 id="x1-21027r27"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">task_status</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">task_result</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">status</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span> 
<span class="label"><a 
 id="x1-21028r28"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">result_url</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">f</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#669900"><span 
class="ectt-1200">{</span></span><span style="color:#669900"><span 
class="ectt-1200">request</span></span><span style="color:#669900"><span 
class="ectt-1200">.</span></span><span style="color:#669900"><span 
class="ectt-1200">host_url</span></span><span style="color:#669900"><span 
class="ectt-1200">}</span></span><span style="color:#669900"><span 
class="ectt-1200">api</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">v1</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">todos</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">ical</span></span><span style="color:#669900"><span 
class="ectt-1200">/{</span></span><span style="color:#669900"><span 
class="ectt-1200">task_id</span></span><span style="color:#669900"><span 
class="ectt-1200">}/</span></span><span style="color:#669900"><span 
class="ectt-1200">result</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span> 
<span class="label"><a 
 id="x1-21029r29"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">}</span></span> 
<span class="label"><a 
 id="x1-21030r30"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#006699"><span 
class="ectt-1200">return</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">jsonify</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#000000"><span 
class="ectt-1200">result</span></span><span style="color:#000000"><span 
class="ectt-1200">)</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">200</span></span> 
<span class="label"><a 
 id="x1-21031r31"></a></span> 
<span class="label"><a 
 id="x1-21032r32"></a></span><span style="color:#000000"><span 
class="ectt-1200">@api</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">route</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">todos</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">ical</span></span><span style="color:#669900"><span 
class="ectt-1200">/&#x003C;</span></span><span style="color:#669900"><span 
class="ectt-1200">task_id</span></span><span style="color:#669900"><span 
class="ectt-1200">&#x003E;/</span></span><span style="color:#669900"><span 
class="ectt-1200">result</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">methods</span></span><span style="color:#000000"><span 
class="ectt-1200">=[</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#669900"><span 
class="ectt-1200">GET</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#000000"><span 
class="ectt-1200">])</span></span> 
<span class="label"><a 
 id="x1-21033r33"></a></span><span style="color:#006699"><span 
class="ectt-1200">def</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">get_calendar</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#000000"><span 
class="ectt-1200">task_id</span></span><span style="color:#000000"><span 
class="ectt-1200">)</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span> 
<span class="label"><a 
 id="x1-21034r34"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">task_result</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">AsyncResult</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#000000"><span 
class="ectt-1200">task_id</span></span><span style="color:#000000"><span 
class="ectt-1200">)</span></span> 
<span class="label"><a 
 id="x1-21035r35"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#006699"><span 
class="ectt-1200">if</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">task_result</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">status</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">==</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#669900"><span 
class="ectt-1200">SUCCESS</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span> 
<span class="label"><a 
 id="x1-21036r36"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#006699"><span 
class="ectt-1200">return</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">task_result</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">result</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">200,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#669900"><span 
class="ectt-1200">Content</span></span><span style="color:#669900"><span 
class="ectt-1200">-</span></span><span style="color:#669900"><span 
class="ectt-1200">Type</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#669900"><span 
class="ectt-1200">text</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">calendar</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#000000"><span 
class="ectt-1200">}</span></span> 
<span class="label"><a 
 id="x1-21037r37"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#006699"><span 
class="ectt-1200">else</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span> 
<span class="label"><a 
 id="x1-21038r38"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#006699"><span 
class="ectt-1200">return</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">jsonify</span></span><span style="color:#000000"><span 
class="ectt-1200">({</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#669900"><span 
class="ectt-1200">error</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#669900"><span 
class="ectt-1200">Task</span></span><span style="color:#669900"> </span><span style="color:#669900"><span 
class="ectt-1200">not</span></span><span style="color:#669900"> </span><span style="color:#669900"><span 
class="ectt-1200">finished</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#000000"><span 
class="ectt-1200">})</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">404</span></span>
 
<span class="label"><a 
 id="x1-21039r39"></a></span></pre>
   </div>
<!--l. 690--><p class="indent" >   The variable that we create as tasks and pass to the delay method is the JSON data that is stored with the
event. It is then deserialized from JSON and passed as a variable to the <span 
class="ectt-1200">create_ical </span>function. Celery is able to
create impressive abstractions so that message passing over a task queue looks almost like regular function
calls.
</p><!--l. 694--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">6.4    </span> <a 
 id="x1-220006.4"></a>Creating the Calendar</h4>
<!--l. 696--><p class="noindent" >Once we have confirmed that the task queue can communicate with our worker, we can return to the calendar
generation. We will use the <span 
class="ectt-1200">icalendar </span>library for this.
</p>
   <div class="framedenv" id="shaded*-1">
   <!--l. 700-->
<pre class="lstlisting" id="listing-23"><span class="label"><a 
 id="x1-22001r1"></a></span><span style="color:#000000"><span 
class="ectt-1200">$</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">pipenv</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">install</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">icalendar</span></span><span 
class="ectt-1200">&#x00A0;</span></pre>
   </div>
<!--l. 702--><p class="indent" >   </p><div class="framedenv" id="code-1">
<!--l. 702--><p class="indent" >   <span 
class="ectt-1200"> cat todo/tasks/ical.py</span> </p></div>   <div class="framedenv" id="code-1"><!--l. 702--><pre class="listings" id="listing-24"><span class="label"><a 
 id="x1-22002r1"></a></span><span style="color:#006699"><span 
class="ectt-1200">import</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">icalendar</span></span> 
<span class="label"><a 
 id="x1-22003r2"></a></span><span style="color:#006699"><span 
class="ectt-1200">import</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">time</span></span> 
<span class="label"><a 
 id="x1-22004r3"></a></span> 
<span class="label"><a 
 id="x1-22005r4"></a></span><span style="color:#000000"><span 
class="ectt-1200">...</span></span> 
<span class="label"><a 
 id="x1-22006r5"></a></span> 
<span class="label"><a 
 id="x1-22007r6"></a></span><span style="color:#006699"><span 
class="ectt-1200">def</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">create_ical</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#000000"><span 
class="ectt-1200">tasks</span></span><span style="color:#000000"><span 
class="ectt-1200">)</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span> 
<span class="label"><a 
 id="x1-22008r7"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">cal</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">icalendar</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">Calendar</span></span><span style="color:#000000"><span 
class="ectt-1200">()</span></span> 
<span class="label"><a 
 id="x1-22009r8"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">cal</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">add</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">prodid</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">-//</span></span><span style="color:#669900"><span 
class="ectt-1200">Taskoverflow</span></span><span style="color:#669900"> </span><span style="color:#669900"><span 
class="ectt-1200">Calendar</span></span><span style="color:#669900"><span 
class="ectt-1200">//</span></span><span style="color:#669900"><span 
class="ectt-1200">mxm</span></span><span style="color:#669900"><span 
class="ectt-1200">.</span></span><span style="color:#669900"><span 
class="ectt-1200">dk</span></span><span style="color:#669900"><span 
class="ectt-1200">//</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">)</span></span> 
<span class="label"><a 
 id="x1-22010r9"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">cal</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">add</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">version</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">2.0</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">)</span></span> 
<span class="label"><a 
 id="x1-22011r10"></a></span> 
<span class="label"><a 
 id="x1-22012r11"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">time</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">sleep</span></span><span style="color:#000000"><span 
class="ectt-1200">(50)</span></span> 
<span class="label"><a 
 id="x1-22013r12"></a></span> 
<span class="label"><a 
 id="x1-22014r13"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#006699"><span 
class="ectt-1200">for</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">task</span></span><span style="color:#000000"> </span><span style="color:#006699"><span 
class="ectt-1200">in</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">tasks</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span> 
<span class="label"><a 
 id="x1-22015r14"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">event</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">icalendar</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">Event</span></span><span style="color:#000000"><span 
class="ectt-1200">()</span></span> 
<span class="label"><a 
 id="x1-22016r15"></a></span> 
<span class="label"><a 
 id="x1-22017r16"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">event</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">add</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">uid</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">task</span></span><span style="color:#000000"><span 
class="ectt-1200">[</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">id</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">])</span></span> 
<span class="label"><a 
 id="x1-22018r17"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">event</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">add</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">summary</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">task</span></span><span style="color:#000000"><span 
class="ectt-1200">[</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">title</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">])</span></span> 
<span class="label"><a 
 id="x1-22019r18"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">event</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">add</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">description</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">task</span></span><span style="color:#000000"><span 
class="ectt-1200">[</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">description</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">])</span></span> 
<span class="label"><a 
 id="x1-22020r19"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">event</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">add</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">dtstart</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">datetime</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">datetime</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">strptime</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#000000"><span 
class="ectt-1200">task</span></span><span style="color:#000000"><span 
class="ectt-1200">[</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">deadline_at</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">],</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">%</span></span><span style="color:#669900"><span 
class="ectt-1200">Y</span></span><span style="color:#669900"><span 
class="ectt-1200">-%</span></span><span style="color:#669900"><span 
class="ectt-1200">m</span></span><span style="color:#669900"><span 
class="ectt-1200">-%</span></span><span style="color:#669900"><span 
class="ectt-1200">dT</span></span><span style="color:#669900"><span 
class="ectt-1200">%</span></span><span style="color:#669900"><span 
class="ectt-1200">H</span></span><span style="color:#669900"><span 
class="ectt-1200">:%</span></span><span style="color:#669900"><span 
class="ectt-1200">M</span></span><span style="color:#669900"><span 
class="ectt-1200">:%</span></span><span style="color:#669900"><span 
class="ectt-1200">S</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">)</span></span><span style="color:#000000"><span 
class="ectt-1200">)</span></span> 
<span class="label"><a 
 id="x1-22021r20"></a></span> 
<span class="label"><a 
 id="x1-22022r21"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">cal</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">add_component</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#000000"><span 
class="ectt-1200">event</span></span><span style="color:#000000"><span 
class="ectt-1200">)</span></span> 
<span class="label"><a 
 id="x1-22023r22"></a></span> 
<span class="label"><a 
 id="x1-22024r23"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#006699"><span 
class="ectt-1200">return</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">cal</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">to_ical</span></span><span style="color:#000000"><span 
class="ectt-1200">()</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">decode</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">utf</span></span><span style="color:#669900"><span 
class="ectt-1200">-8</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">)</span></span>
 
<span class="label"><a 
 id="x1-22025r24"></a></span></pre>
   </div>
<!--l. 728--><p class="indent" >   Now you should be able to test your application.
      </p><ol  class="enumerate1" >
<li 
  class="enumerate" id="x1-22027x1">
      <!--l. 730--><p class="noindent" >Start it with docker-compose.  </p><div class="framedenv" id="shaded*-1">
      <!--l. 731-->
      <pre class="lstlisting" id="listing-25"><span class="label"><a 
 id="x1-22028r1"></a></span><span style="color:#000000"><span 
class="ectt-1200">$</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">docker</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">compose</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">up</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"><span 
class="ectt-1200">build</span></span><span 
class="ectt-1200">&#x00A0;</span></pre>
      
      </div>
      </li>
<li 
  class="enumerate" id="x1-22030x2">
      <!--l. 732--><p class="noindent" >Open the user interface on <a 
href="http://localhost:6400" class="url" ><span 
class="ectt-1200">http://localhost:6400</span></a> and create some tasks.
      </p></li>
<li 
  class="enumerate" id="x1-22032x3">
      <!--l. 733--><p class="noindent" >Follow the cURL interaction from Section <a 
href="#x1-190006.1">6.1<!--tex4ht:ref: sect:apiext --></a> to generate an appropriate iCal.</p></li></ol>
                                                                                                    
                                                                                                    
<!--l. 736--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">7    </span> <a 
 id="x1-230007"></a>Deploying with SQS</h3>
<!--l. 738--><p class="noindent" >First we will modify our worker so that it can run locally and connect to an SQS queue. We need to create an
appropriate SQS queue.
</p><!--l. 741--><p class="indent" >   </p><div class="framedenv" id="code-1">
<!--l. 741--><p class="indent" >   <span 
class="ectt-1200"> cat sqs.tf</span> </p></div>   <div class="framedenv" id="code-1"><!--l. 741--><pre class="listings" id="listing-26"><span class="label"><a 
 id="x1-23001r1"></a></span><span style="color:#006699"><span 
class="ectt-1200">resource</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">aws_sqs_queue</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">ical_queue</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-23002r2"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">name</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">ical</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-23003r3"></a></span><span style="color:#000000"><span 
class="ectt-1200">}</span></span>
 
<span class="label"><a 
 id="x1-23004r4"></a></span></pre>
   </div>
   <div class="tcolorbox tcolorbox" id="tcolobox-10"> 
<div class="tcolorbox-title">
<!--l. 750--><p class="indent" >   Info</p></div> 
<div class="tcolorbox-content"><!--l. 750--><p class="noindent" >Celery  will  automatically  create  a  queue  if  it  doesn&#8217;t  exist,  however,  we  want  to  manage  it  with
Terraform so it is easier to destroy.  </p> 
</div> 
</div>
<!--l. 752--><p class="indent" >   Now we need to tell our worker to use our SQS queue. To do this we will use the <span 
class="ectt-1200">sqs:// </span>broker URL. This tells
Celery to use SQS. Celery will then attempt to find appropriate AWS credentials to use to authenticate. We could
pass these in as environment variables. However, for convinence we will mount the <span 
class="ectt-1200">credentials </span>file that already
exists within our container.
</p><!--l. 759--><p class="indent" >   </p><div class="framedenv" id="code-1">
<!--l. 759--><p class="indent" >   <span 
class="ectt-1200"> cat docker-compose.yml</span> </p></div>   <div class="framedenv" id="code-1"><!--l. 759--><pre class="listings" id="listing-27"><span class="label"><a 
 id="x1-23005r1"></a></span><span style="color:#000000"><span 
class="ectt-1200">volumes</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span> 
<span class="label"><a 
 id="x1-23006r2"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">./</span></span><span style="color:#000000"><span 
class="ectt-1200">todo</span></span><span style="color:#000000"><span 
class="ectt-1200">:/</span></span><span style="color:#000000"><span 
class="ectt-1200">app</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">todo</span></span> 
<span class="label"><a 
 id="x1-23007r3"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">./</span></span><span style="color:#000000"><span 
class="ectt-1200">credentials</span></span><span style="color:#000000"><span 
class="ectt-1200">:/</span></span><span style="color:#000000"><span 
class="ectt-1200">root</span></span><span style="color:#000000"><span 
class="ectt-1200">/.</span></span><span style="color:#000000"><span 
class="ectt-1200">aws</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">credentials</span></span> 
<span class="label"><a 
 id="x1-23008r4"></a></span><span style="color:#000000"><span 
class="ectt-1200">environment</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span> 
<span class="label"><a 
 id="x1-23009r5"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">CELERY_BROKER_URL</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">sqs</span></span><span style="color:#000000"><span 
class="ectt-1200">://</span></span>
 
<span class="label"><a 
 id="x1-23010r6"></a></span></pre>
   </div>
<!--l. 767--><p class="indent" >   Ensure that you update both the worker and the server. Note that we are using <span 
class="ectt-1200">/root </span>since the container is run
as the root user and Celery will therefore look at <span 
class="ectt-1200">~/.aws/credentials</span>.
</p><!--l. 770--><p class="indent" >   We can use the SQS queue in this state to create tasks and our workers will pick it up. This is often sufficient,
however, in our implementation we have made use of Celery&#8217;s built-in functionality to track jobs with a persistent
data store. This is by use of the <span 
class="ectt-1200">AsyncResult </span>class. If we tried to go to the status or result page for a task we
submitted, we would receive an error.
</p><!--l. 776--><p class="indent" >   To work around this issue, we will use our existing PostgreSQL database as our persistent store to track
tasks.
</p><!--l. 779--><p class="indent" >   We can update our <span 
class="ectt-1200">docker-compose.yml </span>as below to allow Celery to use our PostgreSQL database.
</p><!--l. 781--><p class="indent" >   </p><div class="framedenv" id="code-1">
<!--l. 781--><p class="indent" >   <span 
class="ectt-1200"> cat docker-compose.yml</span> </p></div>   <div class="framedenv" id="code-1"><!--l. 781--><pre class="listings" id="listing-28"><span class="label"><a 
 id="x1-23011r1"></a></span><span style="color:#000000"><span 
class="ectt-1200">environment</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span> 
<span class="label"><a 
 id="x1-23012r2"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">CELERY_RESULT_BACKEND</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">db</span></span><span style="color:#000000"><span 
class="ectt-1200">+</span></span><span style="color:#000000"><span 
class="ectt-1200">postgresql</span></span><span style="color:#000000"><span 
class="ectt-1200">://</span></span><span style="color:#000000"><span 
class="ectt-1200">administrator</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"><span 
class="ectt-1200">verySecretPassword@database</span></span><span style="color:#000000"><span 
class="ectt-1200">:5432/</span></span><span style="color:#000000"><span 
class="ectt-1200">todo</span></span>
 
<span class="label"><a 
 id="x1-23013r3"></a></span></pre>
   </div>
<!--l. 786--><p class="indent" >   This is the same as the <span 
class="ectt-1200">SQLALCHEMY_DATABASE_URI </span>except for <span 
class="ectt-1200">db+ </span>at the start to help Celery identify the type
of data store.
</p><!--l. 788--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">8    </span> <a 
 id="x1-240008"></a>Deploying with ECS</h3>
<!--l. 790--><p class="noindent" >Now we have;
      </p><ol  class="enumerate1" >
<li 
  class="enumerate" id="x1-24002x1">
      <!--l. 792--><p class="noindent" >an SQS queue on AWS,
                                                                                                    
                                                                                                    
      </p></li>
<li 
  class="enumerate" id="x1-24004x2">
      <!--l. 793--><p class="noindent" >a worker Celery container running locally,
      </p></li>
<li 
  class="enumerate" id="x1-24006x3">
      <!--l. 794--><p class="noindent" >a server Flask container running locally, and
      </p></li>
<li 
  class="enumerate" id="x1-24008x4">
      <!--l. 795--><p class="noindent" >a PostgreSQL database running locally.</p></li></ol>
<!--l. 798--><p class="indent" >   Earlier in the practical we showed how to host a container on ECR. In previous practicals we used a hosted
image to deploy containers on ECS or EC2. In previous practicals we also deployed a PostgreSQL database on
RDS.
</p><!--l. 802--><p class="indent" >   We would strongly encourage you to try and deploy all components of our application on AWS infrastructure.
This will be excellent practice for the cloud assignment.
</p>
<!--l. 805--><p class="noindent" ><span class="paragraphHead"><a 
 id="x1-25000"></a><span 
class="Cabin-Bold-tlf-t1-x-x-120">Hints</span></span>
      </p><ol  class="enumerate1" >
<li 
  class="enumerate" id="x1-25002x1">
      <!--l. 807--><p class="noindent" >ECS/EC2 containers will automatically authenticate with your AWS account (so <span 
class="ectt-1200">credentials </span>isn&#8217;t
      required).
      </p></li>
<li 
  class="enumerate" id="x1-25004x2">
      <!--l. 808--><p class="noindent" >Attempt to test each component is deployed correctly individually, e.g. deploy RDS and ensure the
      system works, then deploy the server and ensure the system works, etc.</p></li></ol>
<!--l. 1--><p class="noindent" >
</p>
   <h3 class="likesectionHead"><a 
 id="x1-26000"></a>References</h3>
<!--l. 1--><p class="noindent" >
   </p><div class="thebibliography">
   <p class="bibitem" ><span class="biblabel">
 [1]<span class="bibsp">&#x00A0;&#x00A0;&#x00A0;</span></span><a 
 id="Xevents-notes"></a>R.&#x00A0;Thomas,            &#8220;Event-driven            architecture,&#8221;            April            2022.                                            
<a 
href="https://csse6400.uqcloud.net/handouts/event.pdf" class="url" ><span 
class="ectt-1200">https://csse6400.uqcloud.net/handouts/event.pdf</span></a>.
</p>
   </div>
                                                                                                    
                                                                                                    
   <div class="footnotes"><a 
 id="x1-18002x6"></a>
<!--l. 467--><p class="indent" >       <span class="footnote-mark"><a 
href="#fn1x0-bk" id="fn1x0"><sup class="textsuperscript">1</sup></a></span><span 
class="Cabin-Regular-tlf-t1-">In reality it is not but this is an example of a common use case for asynchronous tasks &#8212; file generation such as PDFs or videos</span>
<span 
class="Cabin-Regular-tlf-t1-">which do take time.</span></p><a 
 id="x1-19002x6.1"></a>
<!--l. 482--><p class="noindent" ><span class="footnote-mark"><a 
href="#fn2x0-bk" id="fn2x0"><sup class="textsuperscript">2</sup></a></span><span 
class="Cabin-Regular-tlf-t1-">Ideally a POST procedural endpoint should use a verb like </span><span 
class="ectt-1000">/generate</span><span 
class="Cabin-Regular-tlf-t1-">.</span></p>                                                                                                </div>
 
</body></html> 

                                                                                                    


