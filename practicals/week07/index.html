<?xml version="1.0" encoding="iso-8859-1" ?> 
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">  
<!--http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd-->  
<html xmlns="http://www.w3.org/1999/xhtml"  
> 
<head> <title>Events &amp; Worker Queues</title> 
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /> 
<meta name="generator" content="TeX4ht (https://tug.org/tex4ht/)" /> 
<meta name="originator" content="TeX4ht (https://tug.org/tex4ht/)" /> 
<!-- fn-in,html,htex4ht,xhtml --> 
<meta name="src" content="main.tex" /> 
<link rel="stylesheet" type="text/css" href="main.css" /> 
<link rel="stylesheet" href="https://latex.now.sh/style.css"> 
<link rel="stylesheet" href="/notes.css"> 
<style>body {max-width: 100ch;} 
dl dd {text-align: left}</style> 
</head><body 
>
   <div class="maketitle"><a 
 id="Q1-1-1"></a>
_________________________________________________________________________________________________
<h1 class="titleHead">Events &amp; Worker Queues</h1>                                                             Software Architecture
   <div class="date" >April 14, 2026</div>                                                                                                 <div class="author" >Evan Hughes, Brae Webb &amp; Richard
Thomas</div>
____________________________________________________________________________________________
   <span 
class="Cabin-Regular-tlf-t1-">Last Updated on 2025/04/14 </span></div>
   <hr class="figure" /><div class="figure" 
>
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    
<!--l. 19--><p class="noindent" ><img 
src="images/event-driven.png" alt="PIC"  
width="420" height="420"  />
                                                                                                    
                                                                                                    
</p>
   </div><hr class="endfigure" />
   <div class="tcolorbox tcolorbox" id="tcolobox-1">     
<div class="tcolorbox-title">
<!--l. 25--><p class="indent" >   Aside</p></div> 
<div class="tcolorbox-content"><!--l. 25--><p class="noindent" >Github       Classroom       links       for       this       practical       can       be       found       on       Edstem       
<a 
href="https://edstem.org/au/courses/21491/discussion/2429006" class="url" ><span 
class="ectt-1200">https://edstem.org/au/courses/21491/discussion/2429006</span></a> </p> 
</div> 
</div>
   
   <h3 class="sectionHead"><span class="titlemark">1    </span> <a 
 id="x1-10001"></a>This Week</h3>
<!--l. 28--><p class="noindent" >Our goal is to: </p>
      <ul class="itemize1">
      <li class="itemize">
      <!--l. 30--><p class="noindent" >Explore events and worker queues in the context of AWS.
      </p></li>
      <li class="itemize">
      <!--l. 31--><p class="noindent" >Deploy our own TaskOverflow container on AWS Elastic Container Registry (ECS).
      </p></li>
      <li class="itemize">
      <!--l. 32--><p class="noindent" >Develop an event-based architecture to generate a calendar from tasks in TaskOverflow.</p></li></ul>
   
   <h3 class="sectionHead"><span class="titlemark">2    </span> <a 
 id="x1-20002"></a>Event Processing</h3>
<!--l. 37--><p class="noindent" >As we saw in Event-Driven Architectures <span class="cite">[<a 
href="#Xevents-notes">1</a>]</span>, event processing enables us to build highly scalable and extensible
systems. In this practical we will get our hands dirty with event processing using AWS SQS. AWS SQS is a service
which acts as an event broker.
   
</p>
   <h4 class="subsectionHead"><span class="titlemark">2.1    </span> <a 
 id="x1-30002.1"></a>Technologies</h4>
<!--l. 44--><p class="noindent" >There are other technologies that can be useful in developing an event-based architecture. The following is a
non-exhaustive list of services native to AWS.
   
</p>
   <h5 class="subsubsectionHead"><span class="titlemark">2.1.1    </span> <a 
 id="x1-40002.1.1"></a>AWS SQS</h5>
<!--l. 49--><p class="noindent" >AWS provides the Simple Queue Service, SQS, which offers a simple and fully managed message queue service.
There are two flavours of SQS to be aware of.
      </p><dl class="description"><dt class="description"><a 
 id="x1-4001x2.1.1"></a>
<span 
class="Cabin-Bold-tlf-t1-x-x-120">Standard message queues</span> </dt><dd 
class="description">
      <!--l. 53--><p class="noindent" >allow for greater scalability by providing higher through-put. However, standard message queues in
      SQS are not exactly queues, messages are not first in first out, they are best-effort ordered.
                                                                                                    
                                                                                                    
      </p></dd><dt class="description"><a 
 id="x1-4002x2.1.1"></a>
<span 
class="Cabin-Bold-tlf-t1-x-x-120">FIFO message queues</span> </dt><dd 
class="description">
      <!--l. 57--><p class="noindent" >guarantees that messages are First in First Out.</p></dd></dl>
   
   <h5 class="subsubsectionHead"><span class="titlemark">2.1.2    </span> <a 
 id="x1-50002.1.2"></a>AWS SNS</h5>
<!--l. 61--><p class="noindent" >
      Amazon Simple Notification Service (Amazon SNS) is a fully managed messaging service for
      both application-to-application (A2A) and application-to-person (A2P) communication.
      </p><!--l. 64--><p class="noindent" >The A2A pub/sub functionality provides topics for high-throughput, push-based, many-to-many
      messaging between distributed systems, microservices, and event-driven serverless applications.
      Using Amazon SNS topics, your publisher systems can fanout messages to a large number of
      subscriber systems, including Amazon SQS queues, AWS Lambda functions, HTTPS endpoints,
      and Amazon Kinesis Data Firehose, for parallel processing. The A2P functionality enables you
      to send messages to users at scale via SMS, mobile push, and email.<span class="footnote-mark"><a 
href="#fn1x0" id="fn1x0-bk"><sup class="textsuperscript">1</sup></a></span><a 
 id="x1-5001f1"></a>
                                                                                             </p><!--l. 75--><p class="noindent" >&#8211;
                                                                                          AWS
   
</p>
   <h5 class="subsubsectionHead"><span class="titlemark">2.1.3    </span> <a 
 id="x1-60002.1.3"></a>AWS MQ / Apache ActiveMQ / RabbitMQ</h5>
<!--l. 79--><p class="noindent" >
      Amazon MQ is a managed message broker service for <a 
href="https://activemq.apache.org/" >Apache ActiveMQ</a><span class="footnote-mark"><a 
href="#fn2x0" id="fn2x0-bk"><sup class="textsuperscript">2</sup></a></span><a 
 id="x1-6001f2"></a>
      and <a 
href="https://www.rabbitmq.com/" >RabbitMQ</a><span class="footnote-mark"><a 
href="#fn3x0" id="fn3x0-bk"><sup class="textsuperscript">3</sup></a></span><a 
 id="x1-6003f3"></a>
      that  makes  it  easy  to  set  up  and  operate  message  brokers  on  AWS.  Amazon  MQ  reduces
      your  operational  responsibilities  by  managing  the  provisioning,  setup,  and  maintenance  of
      message  brokers  for  you.  Because  Amazon  MQ  connects  to  your  current  applications  with
      industry-standard APIs and protocols, you can easily migrate to AWS without having to rewrite
      code.
                                                                                             </p><!--l. 86--><p class="noindent" >&#8211;
                                                                                          AWS
</p>
   <div class="tcolorbox tcolorbox" id="tcolobox-2">     
<div class="tcolorbox-title">
<!--l. 89--><p class="indent" >   Aside</p></div> 
<div class="tcolorbox-content"><!--l. 89--><p class="noindent" >Not available in the Learner Lab environment. </p> 
</div> 
</div>
   
   <h5 class="subsubsectionHead"><span class="titlemark">2.1.4    </span> <a 
 id="x1-70002.1.4"></a>AWS MSK ( Managed Streaming for Apache Kafka )</h5>
<!--l. 92--><p class="noindent" >
                                                                                                    
                                                                                                    
      Amazon Managed Streaming for <a 
href="https://kafka.apache.org/" >Apache Kafka</a><span class="footnote-mark"><a 
href="#fn4x0" id="fn4x0-bk"><sup class="textsuperscript">4</sup></a></span><a 
 id="x1-7001f4"></a>
      (Amazon MSK) is a fully managed service that enables you to build and run applications that
      use Apache Kafka to process streaming data. Amazon MSK provides the control-plane operations,
      such as those for creating, updating, and deleting clusters. It lets you use Apache Kafka data-plane
      operations, such as those for producing and consuming data It runs open-source versions of
      Apache Kafka. This means existing applications, tooling, and plugins from partners and the
      Apache Kafka community are supported without requiring changes to application code. You
      can use Amazon MSK to create clusters that use any of the Apache Kafka versions listed under
      Supported Apache Kafka versions.
                                                                                             </p><!--l. 102--><p class="noindent" >&#8211;
                                                                                          AWS
</p>
   <div class="tcolorbox tcolorbox" id="tcolobox-3">     
<div class="tcolorbox-title">
<!--l. 105--><p class="indent" >   Aside</p></div> 
<div class="tcolorbox-content"><!--l. 105--><p class="noindent" >Not available in the lab environments. </p> 
</div> 
</div>
   
   <h5 class="subsubsectionHead"><span class="titlemark">2.1.5    </span> <a 
 id="x1-80002.1.5"></a>Redis</h5>
<!--l. 108--><p class="noindent" >
      Redis, which stands for Remote Dictionary Server, is a fast, open source, in-memory, key-value
      data  store.  The  project  started  when  Salvatore  Sanfilippo,  the  original  developer  of  Redis,
      wanted to improve the scalability of his Italian startup. From there, he developed Redis, which
      is now used as a database, cache, message broker, and queue.
      </p><!--l. 117--><p class="noindent" >Redis delivers sub-millisecond response times, enabling millions of requests per second for
      real-time applications in industries like gaming, ad-tech, financial services, healthcare, and IoT.
      Today, Redis is one of the most popular open source engines today, named the &#8220;Most Loved&#8221;
      database by Stack Overflow for five consecutive years. Because of its fast performance, Redis is
      a popular choice for caching, session management, gaming, leaderboards, real-time analytics,
      geospatial, ride-hailing, chat/messaging, media streaming, and pub/sub apps.
      </p><!--l. 124--><p class="noindent" >AWS  offers  two  fully  managed  services  to  run  Redis.  Amazon  MemoryDB  for  Redis  is  a
      Redis-compatible, durable, in-memory database service that delivers ultra-fast performance.
      Amazon ElastiCache for Redis is a fully managed caching service that accelerates data access
      from primary databases and data stores with microsecond latency. Furthermore, ElastiCache
      also offers support for Memcached, another popular open source caching engine.
                                                                                             </p><!--l. 129--><p class="noindent" >&#8211;
                                                                                          AWS
</p>
   <div class="tcolorbox tcolorbox" id="tcolobox-4">     
<div class="tcolorbox-title">
<!--l. 132--><p class="indent" >   Aside</p></div> 
<div class="tcolorbox-content"><!--l. 132--><p class="noindent" >Not available in the lab environments. </p> 
</div> 
</div>
   
   <h3 class="sectionHead"><span class="titlemark">3    </span> <a 
 id="x1-90003"></a>Talking to the Simple Queue Service (SQS)</h3>
   <div class="tcolorbox tcolorbox" id="tcolobox-5">     
<div class="tcolorbox-title">
                                                                                                    
                                                                                                    
<!--l. 140--><p class="indent" >   Info</p></div> 
<div class="tcolorbox-content"><!--l. 140--><p class="noindent" >This section is intended to be demonstrated by your practical tutor. You may work through it on your
own if you wish.  </p> 
</div> 
</div>
<!--l. 142--><p class="noindent" >We will demonstrate working with the two queue flavours of AWS SQS. A standard queue, named
<span 
class="ectt-1200">csse6400_prac </span>and a FIFO queue, named <span 
class="ectt-1200">csse6400_prac.fifo</span>. The Terraform code below can be used to
create these two queues.
</p><!--l. 151--><p class="indent" >   </p><div class="framedenv" id="code-1">
<!--l. 151--><p class="indent" >   <span 
class="ectt-1200">» cat q-demo.tf</span> </p></div>   <div class="framedenv" id="code-1"><!--l. 151--><pre class="listings" id="listing-1"><span class="label"><a 
 id="x1-9001r1"></a></span><span style="color:#006699"><span 
class="ectt-1200">terraform</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-9002r2"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#006699"><span 
class="ectt-1200">required_providers</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-9003r3"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">aws</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-9004r4"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">source</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">hashicorp</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">aws</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-9005r5"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">version</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">~&#x003E;</span></span><span style="color:#669900"> </span><span style="color:#669900"><span 
class="ectt-1200">5.0</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-9006r6"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">}</span></span> 
<span class="label"><a 
 id="x1-9007r7"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">}</span></span> 
<span class="label"><a 
 id="x1-9008r8"></a></span><span style="color:#000000"><span 
class="ectt-1200">}</span></span> 
<span class="label"><a 
 id="x1-9009r9"></a></span> 
<span class="label"><a 
 id="x1-9010r10"></a></span><span style="color:#006699"><span 
class="ectt-1200">provider</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">aws</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-9011r11"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">region</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">us</span></span><span style="color:#669900"><span 
class="ectt-1200">-</span></span><span style="color:#669900"><span 
class="ectt-1200">east</span></span><span style="color:#669900"><span 
class="ectt-1200">-1</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-9012r12"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">shared_credentials_files</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">[</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">./</span></span><span style="color:#669900"><span 
class="ectt-1200">credentials</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">]</span></span> 
<span class="label"><a 
 id="x1-9013r13"></a></span><span style="color:#000000"><span 
class="ectt-1200">}</span></span> 
<span class="label"><a 
 id="x1-9014r14"></a></span> 
<span class="label"><a 
 id="x1-9015r15"></a></span><span style="color:#006699"><span 
class="ectt-1200">resource</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">aws_sqs_queue</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">our_first_mailbox</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-9016r16"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">name</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">csse6400_prac</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-9017r17"></a></span><span style="color:#000000"><span 
class="ectt-1200">}</span></span> 
<span class="label"><a 
 id="x1-9018r18"></a></span> 
<span class="label"><a 
 id="x1-9019r19"></a></span><span style="color:#006699"><span 
class="ectt-1200">resource</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">aws_sqs_queue</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">our_first_fifo</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-9020r20"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">name</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">csse6400_prac</span></span><span style="color:#669900"><span 
class="ectt-1200">.</span></span><span style="color:#669900"><span 
class="ectt-1200">fifo</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-9021r21"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">fifo_queue</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">true</span></span> 
<span class="label"><a 
 id="x1-9022r22"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">content_based_deduplication</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">true</span></span> 
<span class="label"><a 
 id="x1-9023r23"></a></span><span style="color:#000000"><span 
class="ectt-1200">}</span></span> 
<span class="label"><a 
 id="x1-9024r24"></a></span> 
<span class="label"><a 
 id="x1-9025r25"></a></span><span style="color:#006699"><span 
class="ectt-1200">output</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">mailbox</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-9026r26"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">value</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">aws_sqs_queue</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">our_first_mailbox</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">arn</span></span> 
<span class="label"><a 
 id="x1-9027r27"></a></span><span style="color:#000000"><span 
class="ectt-1200">}</span></span> 
<span class="label"><a 
 id="x1-9028r28"></a></span> 
<span class="label"><a 
 id="x1-9029r29"></a></span><span style="color:#006699"><span 
class="ectt-1200">output</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">fifo</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-9030r30"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">value</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">aws_sqs_queue</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">our_first_fifo</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">arn</span></span> 
<span class="label"><a 
 id="x1-9031r31"></a></span><span style="color:#000000"><span 
class="ectt-1200">}</span></span>
 
<span class="label"><a 
 id="x1-9032r32"></a></span></pre>
   </div>
<!--l. 185--><p class="indent" >   Now that we have provisioned the queues, we can have a look at them in the AWS Console. In the
main AWS dashboard you can search for &#8220;SQS&#8221; to find these queues. You should reach a page like
this:
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    
<!--l. 190--><p class="noindent" ><img 
src="images/sqspanel.png" alt="PIC"  
width="525" height="525"  />
                                                                                                    
                                                                                                    
</p>
   </div><hr class="endfigure" />
<!--l. 193--><p class="indent" >   Like the EC2 and RDS dashboards, we can browse the queue configurations and metrics.
   
</p>
   <h4 class="subsectionHead"><span class="titlemark">3.1    </span> <a 
 id="x1-100003.1"></a>Queue Command-line Interface</h4>
<!--l. 209--><p class="noindent" >We have provided a small Docker container to demonstrate the difference between the implementations. First we
must retrieve our AWS credentials and setup our environment.
</p><!--l. 212--><p class="indent" >   Grab the AWS credentials from the Learner Lab, but instead of creating a credentials file we will use
environment variables.
</p><!--l. 215--><p class="indent" >   To do this, create an environment file for our Docker container to read so that it can access AWS. Create an
<span 
class="ectt-1200">aws.env </span>file in the current directory and edit the contents so that it looks similar to the example below. It is
important that the environment variable names are capitalised. The AWS key values will be from the credentials
shown in your Learner Lab environment.
</p>
   <div class="framedenv" id="code-1">
<!--l. 220--><pre class="listings" id="listing-2"><span class="label"><a 
 id="x1-10001r1"></a></span><span style="color:#000000"><span 
class="ectt-1200">TERM</span></span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"><span 
class="ectt-1200">xterm</span></span><span style="color:#000000"><span 
class="ectt-1200">-256</span></span><span style="color:#000000"><span 
class="ectt-1200">color</span></span> 
<span class="label"><a 
 id="x1-10002r2"></a></span><span style="color:#000000"><span 
class="ectt-1200">AWS_ACCESS_KEY_ID</span></span><span style="color:#000000"><span 
class="ectt-1200">=...</span></span> 
<span class="label"><a 
 id="x1-10003r3"></a></span><span style="color:#000000"><span 
class="ectt-1200">AWS_SECRET_ACCESS_KEY</span></span><span style="color:#000000"><span 
class="ectt-1200">=...</span></span> 
<span class="label"><a 
 id="x1-10004r4"></a></span><span style="color:#000000"><span 
class="ectt-1200">AWS_SESSION_TOKEN</span></span><span style="color:#000000"><span 
class="ectt-1200">=...</span></span>
 
<span class="label"><a 
 id="x1-10005r5"></a></span></pre>
   </div>
   <div class="framedenv" id="code-1">
<!--l. 227--><pre class="listings" id="listing-3"><span class="label"><a 
 id="x1-10006r1"></a></span><span style="color:#000000"><span 
class="ectt-1200">$</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">docker</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">run</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"><span 
class="ectt-1200">rm</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">it</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"><span 
class="ectt-1200">env</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">file</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">aws</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">env</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">ghcr</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">io</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">csse6400</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">queue</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"><span 
class="ectt-1200">main</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"><span 
class="ectt-1200">name</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">test</span></span><span style="color:#000000"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"><span 
class="ectt-1200">client</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">name</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">Client</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">1"</span></span> 
<span class="label"><a 
 id="x1-10007r2"></a></span> 
<span class="label"><a 
 id="x1-10008r3"></a></span> 
<span class="label"><a 
 id="x1-10009r4"></a></span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">__________</span></span> 
<span class="label"><a 
 id="x1-10010r5"></a></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">|</span></span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">\</span></span><span style="color:#000000"><span 
class="ectt-1200">XX</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">|</span></span> 
<span class="label"><a 
 id="x1-10011r6"></a></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">|</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">T</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">\/</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">T</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">|</span></span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">University</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">Queensland</span></span> 
<span class="label"><a 
 id="x1-10012r7"></a></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">|</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">XX</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"><span 
class="ectt-1200">XX</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">|</span></span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">Faculty</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">EAIT</span></span> 
<span class="label"><a 
 id="x1-10013r8"></a></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">T</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">L</span></span><span style="color:#000000"><span 
class="tctt-1200">'</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">/\</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="tctt-1200">'</span></span><span style="color:#000000"><span 
class="ectt-1200">J</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">T</span></span> 
<span class="label"><a 
 id="x1-10014r9"></a></span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">\</span></span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">XX</span></span><span style="color:#000000"><span 
class="ectt-1200">\</span></span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">CSSE6400</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">Queue</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">Prac</span></span> 
<span class="label"><a 
 id="x1-10015r10"></a></span><span style="color:#000000"><span 
class="ectt-1200">@</span></span><span style="color:#000000"><span 
class="ectt-1200">\</span></span><span style="color:#000000"><span 
class="ectt-1200">_</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="tctt-1200">'</span></span><span style="color:#000000"><span 
class="ectt-1200">____</span></span><span style="color:#000000"><span 
class="tctt-1200">'</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">_</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">@</span></span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">csse6400</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">uqcloud</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">net</span></span> 
<span class="label"><a 
 id="x1-10016r11"></a></span><span style="color:#000000"><span 
class="ectt-1200">\</span></span><span style="color:#000000"><span 
class="ectt-1200">_X</span></span><span style="color:#000000"><span 
class="ectt-1200">\</span></span><span style="color:#000000"><span 
class="ectt-1200">_</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">__</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">_</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">X_</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span> 
<span class="label"><a 
 id="x1-10017r12"></a></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">\=/\----/\=/</span></span> 
<span class="label"><a 
 id="x1-10018r13"></a></span> 
<span class="label"><a 
 id="x1-10019r14"></a></span> 
<span class="label"><a 
 id="x1-10020r15"></a></span> 
<span class="label"><a 
 id="x1-10021r16"></a></span><span style="color:#000000"><span 
class="ectt-1200">Unable</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">to</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">find</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">a</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">Queue</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">by</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">this</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">name</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">test</span></span>
 
<span class="label"><a 
 id="x1-10022r17"></a></span></pre>
   </div>
   
   <h4 class="subsectionHead"><span class="titlemark">3.2    </span> <a 
 id="x1-110003.2"></a>SQS Standard</h4>
<!--l. 249--><p class="noindent" >The &#8220;standard&#8221; offering of SQS does not guarantee order or &#8220;only once delivery&#8221;. We will create a message
publisher and a message subscriber.
</p>
   <div class="tcolorbox tcolorbox" id="tcolobox-6">     
<div class="tcolorbox-title">
<!--l. 255--><p class="indent" >   Info</p></div> 
<div class="tcolorbox-content"><!--l. 255--><p class="noindent" >For the rest of this practical you will require multiple terminals. Make sure these are all in the same
folder so we can reuse the <span 
class="ectt-1200">aws.env </span>file.  </p> 
</div> 
</div>
<!--l. 257--><p class="indent" >   To create the subscriber run the following command:
</p>
   <div class="framedenv" id="shaded*-1">
   <!--l. 261-->
<pre class="lstlisting" id="listing-4"><span class="label"><a 
 id="x1-11001r1"></a></span><span style="color:#000000"><span 
class="ectt-1200">$</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">docker</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">run</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"><span 
class="ectt-1200">rm</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">it</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"><span 
class="ectt-1200">env</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">file</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">aws</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">env</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">ghcr</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">io</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">csse6400</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">queue</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"><span 
class="ectt-1200">main</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"><span 
class="ectt-1200">name</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">csse6400_prac</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"><span 
class="ectt-1200">client</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">name</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">Client</span></span><span style="color:#669900"> </span><span style="color:#669900"><span 
class="ectt-1200">1</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"><span 
class="ectt-1200">receive</span></span><span style="color:#000000"> </span><span 
class="ectt-1200">&#x00A0;</span></pre>
   </div>
   <hr class="figure" /><div class="figure" 
>
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    
<!--l. 264--><p class="noindent" ><img 
src="images/stacksub.png" alt="PIC"  
width="525" height="525"  />
                                                                                                    
                                                                                                    
</p>
   </div><hr class="endfigure" />
<!--l. 267--><p class="indent" >   Now start a publisher in another terminal.
</p>
   <div class="framedenv" id="shaded*-1">
   <!--l. 271-->
<pre class="lstlisting" id="listing-5"><span class="label"><a 
 id="x1-11002r1"></a></span><span style="color:#000000"><span 
class="ectt-1200">$</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">docker</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">run</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"><span 
class="ectt-1200">rm</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">it</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"><span 
class="ectt-1200">env</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">file</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">aws</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">env</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">ghcr</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">io</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">csse6400</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">queue</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"><span 
class="ectt-1200">main</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"><span 
class="ectt-1200">name</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">csse6400_prac</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"><span 
class="ectt-1200">client</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">name</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">Client</span></span><span style="color:#669900"> </span><span style="color:#669900"><span 
class="ectt-1200">1</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span 
class="ectt-1200">&#x00A0;</span></pre>
   </div>
   <hr class="figure" /><div class="figure" 
>
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    
<!--l. 274--><p class="noindent" ><img 
src="images/stackpub.png" alt="PIC"  
width="525" height="525"  />
                                                                                                    
                                                                                                    
</p>
   </div><hr class="endfigure" />
<!--l. 277--><p class="indent" >   When the publisher connects to the queue it will put 100 messages of increasing increment into the
queue. On the subscriber we will be able to see the messages being received, an example is provided
below:
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    
<!--l. 281--><p class="noindent" ><img 
src="images/stacksubdata.png" alt="PIC"  
width="525" height="525"  />
                                                                                                    
                                                                                                    
</p>
   </div><hr class="endfigure" />
<!--l. 284--><p class="indent" >   Hopefully, like our example, you can see that some of the messages arrive out of order. Next, add more
publishers and subscribers and experiment with different configurations.
</p>
   <div class="tcolorbox tcolorbox" id="tcolobox-7">     
<div class="tcolorbox-title">
<!--l. 290--><p class="indent" >   Info</p></div> 
<div class="tcolorbox-content"><!--l. 290--><p class="noindent" >When making multiple publishers, you may want to change the client-name CLI parameter, so you
can keep track of when the messages arrived at the subscribers.  </p> 
</div> 
</div>
   
   <h4 class="subsectionHead"><span class="titlemark">3.3    </span> <a 
 id="x1-120003.3"></a>SQS FIFO</h4>
<!--l. 294--><p class="noindent" >Now we will experiment with the FIFO based service offered by SQS. Like before, we will start a subscriber but
make sure the name of the queue matches the FIFO queue we created in Terraform.
</p>
   <div class="framedenv" id="shaded*-1">
   <!--l. 299-->
<pre class="lstlisting" id="listing-6"><span class="label"><a 
 id="x1-12001r1"></a></span><span style="color:#000000"><span 
class="ectt-1200">$</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">docker</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">run</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"><span 
class="ectt-1200">rm</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">it</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"><span 
class="ectt-1200">env</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">file</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">aws</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">env</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">ghcr</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">io</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">csse6400</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">queue</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"><span 
class="ectt-1200">main</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"><span 
class="ectt-1200">name</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">csse6400_prac</span></span><span style="color:#669900"><span 
class="ectt-1200">.</span></span><span style="color:#669900"><span 
class="ectt-1200">fifo</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"><span 
class="ectt-1200">client</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">name</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">Client</span></span><span style="color:#669900"> </span><span style="color:#669900"><span 
class="ectt-1200">1</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"><span 
class="ectt-1200">receive</span></span><span style="color:#000000"> </span><span 
class="ectt-1200">&#x00A0;</span></pre>
   </div>
<!--l. 301--><p class="indent" >   Now start a publisher in another terminal.
</p>
   <div class="framedenv" id="shaded*-1">
   <!--l. 305-->
<pre class="lstlisting" id="listing-7"><span class="label"><a 
 id="x1-12002r1"></a></span><span style="color:#000000"><span 
class="ectt-1200">$</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">docker</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">run</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"><span 
class="ectt-1200">rm</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">it</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"><span 
class="ectt-1200">env</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">file</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">aws</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">env</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">ghcr</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">io</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">csse6400</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">queue</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"><span 
class="ectt-1200">main</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"><span 
class="ectt-1200">name</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">csse6400_prac</span></span><span style="color:#669900"><span 
class="ectt-1200">.</span></span><span style="color:#669900"><span 
class="ectt-1200">fifo</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"><span 
class="ectt-1200">client</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">name</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">Client</span></span><span style="color:#669900"> </span><span style="color:#669900"><span 
class="ectt-1200">1</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span 
class="ectt-1200">&#x00A0;</span></pre>
   </div>
   <hr class="figure" /><div class="figure" 
>
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    
<!--l. 308--><p class="noindent" ><img 
src="images/fifopub.png" alt="PIC"  
width="525" height="525"  />
                                                                                                    
                                                                                                    
</p>
   </div><hr class="endfigure" />
<!--l. 311--><p class="indent" >   On the subscriber we now see the messages arriving in the order which is expected.
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    
<!--l. 314--><p class="noindent" ><img 
src="images/fifosub.png" alt="PIC"  
width="525" height="525"  />
                                                                                                    
                                                                                                    
</p>
   </div><hr class="endfigure" />
<!--l. 317--><p class="indent" >   If we re-run the publisher though, we may not see any new messages make it to the consumer. This is because
we have asked AWS to de-duplicate messages where it can. You can see this in FIFO queue&#8217;s dashboard
Monitoring tab. The queue test code has a CLI parameter which prepends a string to the message. Re-run the test
code using <span 
class="ectt-1200">&#8211;prepend "A-" </span>to send non-duplicate messages.
</p><!--l. 323--><p class="indent" >   As before try experimenting with different publisher / subscriber configurations to see how they
behave.
</p>
   <div class="tcolorbox tcolorbox" id="tcolobox-8">     
<div class="tcolorbox-title">
<!--l. 328--><p class="indent" >   Info</p></div> 
<div class="tcolorbox-content"><!--l. 328--><p class="noindent" >When making multiple publishers, you may want to change the client-name CLI parameter, so you
can keep track of when the messages arrived at the subscribers.  </p> 
</div> 
</div>
   <div class="tcolorbox tcolorbox" id="tcolobox-9">     
<div class="tcolorbox-title">
<!--l. 332--><p class="indent" >   Warning</p></div> 
<div class="tcolorbox-content"><!--l. 332--><p class="noindent" ><span 
class="Cabin-Bold-tlf-t1-x-x-120">Please remember to </span><span 
class="ectt-1200">terraform destroy </span><span 
class="Cabin-Bold-tlf-t1-x-x-120">to delete your resources!</span>  </p> 
</div> 
</div>
   
   <h3 class="sectionHead"><span class="titlemark">4    </span> <a 
 id="x1-130004"></a>Worker Queues</h3>
<!--l. 337--><p class="noindent" >One good use case for queues is for distributing work to scale to demand. In this exercise we encourage you to
have a look at these widely used libraries to see how you could integrate them into a distributed
system.
</p>
      <ul class="itemize1">
      <li class="itemize">
      <!--l. 342--><p class="noindent" >Python: <a 
href="https://docs.celeryq.dev/en/stable/" >Celery</a><span class="footnote-mark"><a 
href="#fn5x0" id="fn5x0-bk"><sup class="textsuperscript">5</sup></a></span><a 
 id="x1-13001f5"></a>
      </p></li>
      <li class="itemize">
      <!--l. 343--><p class="noindent" >Java: <a 
href="https://www.rabbitmq.com/tutorials/tutorial-one-java" >RabbitMQ</a><span class="footnote-mark"><a 
href="#fn6x0" id="fn6x0-bk"><sup class="textsuperscript">6</sup></a></span><a 
 id="x1-13003f6"></a></p></li></ul>
<!--l. 346--><p class="indent" >   The two libraries above are integrated into many popular application frameworks. Today we will use Celery to
create a simple worker queue for TaskOverflow.
   
</p>
   <h4 class="subsectionHead"><span class="titlemark">4.1    </span> <a 
 id="x1-140004.1"></a>Celery</h4>
<!--l. 351--><p class="noindent" >Celery is a Python library which allows you to create a worker queue. It is popular and used in many large scale
applications. It is also relatively easy to use and has comprehensive documentation.
   
</p>
   <h3 class="sectionHead"><span class="titlemark">5    </span> <a 
 id="x1-150005"></a>Task Calendar</h3>
<!--l. 358--><p class="noindent" >TaskOverflow will use Celery to distribute the work of generating a calendar view of tasks, as this could be a time-intensive
task.<span class="footnote-mark"><a 
href="#fn7x0" id="fn7x0-bk"><sup class="textsuperscript">7</sup></a></span><a 
 id="x1-15001f7"></a>
This will be done by a worker which will run in a separate container. The TaskOverflow server will place job
                                                                                                    
                                                                                                    
requests on the Celery queue. The worker will pick-up jobs and generate the calendar. The webserver can then
serve the calendar to the user.
</p><!--l. 367--><p class="indent" >   Calendar generation occurs asynchronously with this architecture. The user will not have to wait for the
calendar view to be generated and the web server can handle other requests.
   
</p>
   <h4 class="subsectionHead"><span class="titlemark">5.1    </span> <a 
 id="x1-160005.1"></a>API Extension</h4>
<!--l. 373--><p class="noindent" >We will extend our existing API with the following endpoints.
</p><!--l. 375--><p class="indent" >
      </p><dl class="description"><dt class="description"><a 
 id="x1-16001x5.1"></a>
<span 
class="Cabin-Bold-tlf-t1-x-x-120">POST /todos/ical</span> </dt><dd 
class="description">
      <!--l. 376--><p class="noindent" >Create an asynchronous calendar generation job.<span class="footnote-mark"><a 
href="#fn8x0" id="fn8x0-bk"><sup class="textsuperscript">8</sup></a></span><a 
 id="x1-16002f8"></a>
      </p></dd><dt class="description"><a 
 id="x1-16004x5.1"></a>
<span 
class="Cabin-Bold-tlf-t1-x-x-120">GET /todos/ical/{task_id}/status</span> </dt><dd 
class="description">
      <!--l. 378--><p class="noindent" >Check the status of the generation job.
      </p></dd><dt class="description"><a 
 id="x1-16005x5.1"></a>
<span 
class="Cabin-Bold-tlf-t1-x-x-120">GET /todos/ical/{task_id}/result</span> </dt><dd 
class="description">
      <!--l. 379--><p class="noindent" >Download the generated iCal file when it is ready.</p></dd></dl>
<!--l. 382--><p class="noindent" >An example interaction with the API might look like:
</p>
   <div class="framedenv" id="code-1">
<!--l. 385--><pre class="listings" id="listing-8"><span class="label"><a 
 id="x1-16006r1"></a></span><span style="color:#000000"><span 
class="ectt-1200">$</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">curl</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">X</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">POST</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">http</span></span><span style="color:#000000"><span 
class="ectt-1200">://</span></span><span style="color:#000000"><span 
class="ectt-1200">localhost</span></span><span style="color:#000000"><span 
class="ectt-1200">:6400/</span></span><span style="color:#000000"><span 
class="ectt-1200">api</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">v1</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">todos</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">ical</span></span> 
<span class="label"><a 
 id="x1-16007r2"></a></span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-16008r3"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">task_id</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">2</span></span><span style="color:#669900"><span 
class="ectt-1200">e80aefd</span></span><span style="color:#669900"><span 
class="ectt-1200">-4</span></span><span style="color:#669900"><span 
class="ectt-1200">a69</span></span><span style="color:#669900"><span 
class="ectt-1200">-4</span></span><span style="color:#669900"><span 
class="ectt-1200">a94</span></span><span style="color:#669900"><span 
class="ectt-1200">-</span></span><span style="color:#669900"><span 
class="ectt-1200">b23a</span></span><span style="color:#669900"><span 
class="ectt-1200">-45</span></span><span style="color:#669900"><span 
class="ectt-1200">f2b8110988</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span> 
<span class="label"><a 
 id="x1-16009r4"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">task_url</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">http</span></span><span style="color:#669900"><span 
class="ectt-1200">://</span></span><span style="color:#669900"><span 
class="ectt-1200">localhost</span></span><span style="color:#669900"><span 
class="ectt-1200">:6400/</span></span><span style="color:#669900"><span 
class="ectt-1200">api</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">v1</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">todos</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">ical</span></span><span style="color:#669900"><span 
class="ectt-1200">/2</span></span><span style="color:#669900"><span 
class="ectt-1200">e80aefd</span></span><span style="color:#669900"><span 
class="ectt-1200">-4</span></span><span style="color:#669900"><span 
class="ectt-1200">a69</span></span><span style="color:#669900"><span 
class="ectt-1200">-4</span></span><span style="color:#669900"><span 
class="ectt-1200">a94</span></span><span style="color:#669900"><span 
class="ectt-1200">-</span></span><span style="color:#669900"><span 
class="ectt-1200">b23a</span></span><span style="color:#669900"><span 
class="ectt-1200">-45</span></span><span style="color:#669900"><span 
class="ectt-1200">f2b8110988</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">status</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-16010r5"></a></span><span style="color:#000000"><span 
class="ectt-1200">}</span></span> 
<span class="label"><a 
 id="x1-16011r6"></a></span><span style="color:#000000"><span 
class="ectt-1200">$</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">curl</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">X</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">GET</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">http</span></span><span style="color:#000000"><span 
class="ectt-1200">://</span></span><span style="color:#000000"><span 
class="ectt-1200">localhost</span></span><span style="color:#000000"><span 
class="ectt-1200">:6400/</span></span><span style="color:#000000"><span 
class="ectt-1200">api</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">v1</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">todos</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">ical</span></span><span style="color:#000000"><span 
class="ectt-1200">/2</span></span><span style="color:#000000"><span 
class="ectt-1200">e80aefd</span></span><span style="color:#000000"><span 
class="ectt-1200">-4</span></span><span style="color:#000000"><span 
class="ectt-1200">a69</span></span><span style="color:#000000"><span 
class="ectt-1200">-4</span></span><span style="color:#000000"><span 
class="ectt-1200">a94</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">b23a</span></span><span style="color:#000000"><span 
class="ectt-1200">-45</span></span><span style="color:#000000"><span 
class="ectt-1200">f2b8110988</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">status</span></span> 
<span class="label"><a 
 id="x1-16012r7"></a></span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-16013r8"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">result_url</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">http</span></span><span style="color:#669900"><span 
class="ectt-1200">://</span></span><span style="color:#669900"><span 
class="ectt-1200">localhost</span></span><span style="color:#669900"><span 
class="ectt-1200">:6400/</span></span><span style="color:#669900"><span 
class="ectt-1200">api</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">v1</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">todos</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">ical</span></span><span style="color:#669900"><span 
class="ectt-1200">/2</span></span><span style="color:#669900"><span 
class="ectt-1200">e80aefd</span></span><span style="color:#669900"><span 
class="ectt-1200">-4</span></span><span style="color:#669900"><span 
class="ectt-1200">a69</span></span><span style="color:#669900"><span 
class="ectt-1200">-4</span></span><span style="color:#669900"><span 
class="ectt-1200">a94</span></span><span style="color:#669900"><span 
class="ectt-1200">-</span></span><span style="color:#669900"><span 
class="ectt-1200">b23a</span></span><span style="color:#669900"><span 
class="ectt-1200">-45</span></span><span style="color:#669900"><span 
class="ectt-1200">f2b8110988</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">result</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span> 
<span class="label"><a 
 id="x1-16014r9"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">task_id</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">2</span></span><span style="color:#669900"><span 
class="ectt-1200">e80aefd</span></span><span style="color:#669900"><span 
class="ectt-1200">-4</span></span><span style="color:#669900"><span 
class="ectt-1200">a69</span></span><span style="color:#669900"><span 
class="ectt-1200">-4</span></span><span style="color:#669900"><span 
class="ectt-1200">a94</span></span><span style="color:#669900"><span 
class="ectt-1200">-</span></span><span style="color:#669900"><span 
class="ectt-1200">b23a</span></span><span style="color:#669900"><span 
class="ectt-1200">-45</span></span><span style="color:#669900"><span 
class="ectt-1200">f2b8110988</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span> 
<span class="label"><a 
 id="x1-16015r10"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">task_status</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">PENDING</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-16016r11"></a></span><span style="color:#000000"><span 
class="ectt-1200">}</span></span> 
<span class="label"><a 
 id="x1-16017r12"></a></span><span style="color:#000000"><span 
class="ectt-1200">$</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">curl</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">X</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">GET</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">http</span></span><span style="color:#000000"><span 
class="ectt-1200">://</span></span><span style="color:#000000"><span 
class="ectt-1200">localhost</span></span><span style="color:#000000"><span 
class="ectt-1200">:6400/</span></span><span style="color:#000000"><span 
class="ectt-1200">api</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">v1</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">todos</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">ical</span></span><span style="color:#000000"><span 
class="ectt-1200">/2</span></span><span style="color:#000000"><span 
class="ectt-1200">e80aefd</span></span><span style="color:#000000"><span 
class="ectt-1200">-4</span></span><span style="color:#000000"><span 
class="ectt-1200">a69</span></span><span style="color:#000000"><span 
class="ectt-1200">-4</span></span><span style="color:#000000"><span 
class="ectt-1200">a94</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">b23a</span></span><span style="color:#000000"><span 
class="ectt-1200">-45</span></span><span style="color:#000000"><span 
class="ectt-1200">f2b8110988</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">status</span></span> 
<span class="label"><a 
 id="x1-16018r13"></a></span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-16019r14"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">result_url</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">http</span></span><span style="color:#669900"><span 
class="ectt-1200">://</span></span><span style="color:#669900"><span 
class="ectt-1200">localhost</span></span><span style="color:#669900"><span 
class="ectt-1200">:6400/</span></span><span style="color:#669900"><span 
class="ectt-1200">api</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">v1</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">todos</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">ical</span></span><span style="color:#669900"><span 
class="ectt-1200">/2</span></span><span style="color:#669900"><span 
class="ectt-1200">e80aefd</span></span><span style="color:#669900"><span 
class="ectt-1200">-4</span></span><span style="color:#669900"><span 
class="ectt-1200">a69</span></span><span style="color:#669900"><span 
class="ectt-1200">-4</span></span><span style="color:#669900"><span 
class="ectt-1200">a94</span></span><span style="color:#669900"><span 
class="ectt-1200">-</span></span><span style="color:#669900"><span 
class="ectt-1200">b23a</span></span><span style="color:#669900"><span 
class="ectt-1200">-45</span></span><span style="color:#669900"><span 
class="ectt-1200">f2b8110988</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">result</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span> 
<span class="label"><a 
 id="x1-16020r15"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">task_id</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">2</span></span><span style="color:#669900"><span 
class="ectt-1200">e80aefd</span></span><span style="color:#669900"><span 
class="ectt-1200">-4</span></span><span style="color:#669900"><span 
class="ectt-1200">a69</span></span><span style="color:#669900"><span 
class="ectt-1200">-4</span></span><span style="color:#669900"><span 
class="ectt-1200">a94</span></span><span style="color:#669900"><span 
class="ectt-1200">-</span></span><span style="color:#669900"><span 
class="ectt-1200">b23a</span></span><span style="color:#669900"><span 
class="ectt-1200">-45</span></span><span style="color:#669900"><span 
class="ectt-1200">f2b8110988</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span> 
<span class="label"><a 
 id="x1-16021r16"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">task_status</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">SUCCESS</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-16022r17"></a></span><span style="color:#000000"><span 
class="ectt-1200">}</span></span> 
<span class="label"><a 
 id="x1-16023r18"></a></span><span style="color:#000000"><span 
class="ectt-1200">$</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">curl</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">X</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">GET</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">http</span></span><span style="color:#000000"><span 
class="ectt-1200">://</span></span><span style="color:#000000"><span 
class="ectt-1200">localhost</span></span><span style="color:#000000"><span 
class="ectt-1200">:6400/</span></span><span style="color:#000000"><span 
class="ectt-1200">api</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">v1</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">todos</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">ical</span></span><span style="color:#000000"><span 
class="ectt-1200">/2</span></span><span style="color:#000000"><span 
class="ectt-1200">e80aefd</span></span><span style="color:#000000"><span 
class="ectt-1200">-4</span></span><span style="color:#000000"><span 
class="ectt-1200">a69</span></span><span style="color:#000000"><span 
class="ectt-1200">-4</span></span><span style="color:#000000"><span 
class="ectt-1200">a94</span></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">b23a</span></span><span style="color:#000000"><span 
class="ectt-1200">-45</span></span><span style="color:#000000"><span 
class="ectt-1200">f2b8110988</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">result</span></span> 
<span class="label"><a 
 id="x1-16024r19"></a></span><span style="color:#000000"><span 
class="ectt-1200">BEGIN</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"><span 
class="ectt-1200">VCALENDAR</span></span> 
<span class="label"><a 
 id="x1-16025r20"></a></span><span style="color:#000000"><span 
class="ectt-1200">VERSION</span></span><span style="color:#000000"><span 
class="ectt-1200">:2.0</span></span> 
<span class="label"><a 
 id="x1-16026r21"></a></span><span style="color:#000000"><span 
class="ectt-1200">PRODID</span></span><span style="color:#000000"><span 
class="ectt-1200">:-//</span></span><span style="color:#000000"><span 
class="ectt-1200">Taskoverflow</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">Calendar</span></span><span style="color:#000000"><span 
class="ectt-1200">//</span></span><span style="color:#000000"><span 
class="ectt-1200">mxm</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">dk</span></span><span style="color:#000000"><span 
class="ectt-1200">//</span></span> 
<span class="label"><a 
 id="x1-16027r22"></a></span><span style="color:#000000"><span 
class="ectt-1200">BEGIN</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"><span 
class="ectt-1200">VEVENT</span></span> 
<span class="label"><a 
 id="x1-16028r23"></a></span><span style="color:#000000"><span 
class="ectt-1200">SUMMARY</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"><span 
class="ectt-1200">Project</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">Proposal</span></span> 
<span class="label"><a 
 id="x1-16029r24"></a></span><span style="color:#000000"><span 
class="ectt-1200">DTSTART</span></span><span style="color:#000000"><span 
class="ectt-1200">:20230403</span></span><span style="color:#000000"><span 
class="ectt-1200">T140000</span></span> 
<span class="label"><a 
 id="x1-16030r25"></a></span><span style="color:#000000"><span 
class="ectt-1200">UID</span></span><span style="color:#000000"><span 
class="ectt-1200">:1</span></span> 
<span class="label"><a 
 id="x1-16031r26"></a></span><span style="color:#000000"><span 
class="ectt-1200">DESCRIPTION</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"><span 
class="ectt-1200">CSSE6400</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">Project</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">Proposal</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">Due</span></span> 
<span class="label"><a 
 id="x1-16032r27"></a></span><span style="color:#000000"><span 
class="ectt-1200">END</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"><span 
class="ectt-1200">VEVENT</span></span> 
<span class="label"><a 
 id="x1-16033r28"></a></span><span style="color:#000000"><span 
class="ectt-1200">END</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"><span 
class="ectt-1200">VCALENDAR</span></span>
 
<span class="label"><a 
 id="x1-16034r29"></a></span></pre>
   </div>
<!--l. 416--><p class="noindent" >We will stub out the implementation of these endpoints for now.    </p><div class="framedenv" id="code-1">
<!--l. 418--><p class="indent" >   <span 
class="ectt-1200">» cat todo/views/routes.py</span> </p></div>   <div class="framedenv" id="code-1"><!--l. 418--><pre class="listings" id="listing-9"><span class="label"><a 
 id="x1-16035r1"></a></span><span style="color:#000000"><span 
class="ectt-1200">@api</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">route</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">todos</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">ical</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">methods</span></span><span style="color:#000000"><span 
class="ectt-1200">=[</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#669900"><span 
class="ectt-1200">POST</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#000000"><span 
class="ectt-1200">])</span></span> 
<span class="label"><a 
 id="x1-16036r2"></a></span><span style="color:#006699"><span 
class="ectt-1200">def</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">create_ical</span></span><span style="color:#000000"><span 
class="ectt-1200">()</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span> 
<span class="label"><a 
 id="x1-16037r3"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#006699"><span 
class="ectt-1200">pass</span></span> 
<span class="label"><a 
 id="x1-16038r4"></a></span> 
<span class="label"><a 
 id="x1-16039r5"></a></span><span style="color:#000000"><span 
class="ectt-1200">@api</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">route</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">todos</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">ical</span></span><span style="color:#669900"><span 
class="ectt-1200">/&#x003C;</span></span><span style="color:#669900"><span 
class="ectt-1200">task_id</span></span><span style="color:#669900"><span 
class="ectt-1200">&#x003E;/</span></span><span style="color:#669900"><span 
class="ectt-1200">status</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">methods</span></span><span style="color:#000000"><span 
class="ectt-1200">=[</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#669900"><span 
class="ectt-1200">GET</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#000000"><span 
class="ectt-1200">])</span></span> 
<span class="label"><a 
 id="x1-16040r6"></a></span><span style="color:#006699"><span 
class="ectt-1200">def</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">get_task</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#000000"><span 
class="ectt-1200">task_id</span></span><span style="color:#000000"><span 
class="ectt-1200">)</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span> 
<span class="label"><a 
 id="x1-16041r7"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#006699"><span 
class="ectt-1200">pass</span></span> 
<span class="label"><a 
 id="x1-16042r8"></a></span> 
<span class="label"><a 
 id="x1-16043r9"></a></span><span style="color:#000000"><span 
class="ectt-1200">@api</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">route</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">todos</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">ical</span></span><span style="color:#669900"><span 
class="ectt-1200">/&#x003C;</span></span><span style="color:#669900"><span 
class="ectt-1200">task_id</span></span><span style="color:#669900"><span 
class="ectt-1200">&#x003E;/</span></span><span style="color:#669900"><span 
class="ectt-1200">result</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">methods</span></span><span style="color:#000000"><span 
class="ectt-1200">=[</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#669900"><span 
class="ectt-1200">GET</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#000000"><span 
class="ectt-1200">])</span></span> 
<span class="label"><a 
 id="x1-16044r10"></a></span><span style="color:#006699"><span 
class="ectt-1200">def</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">get_calendar</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#000000"><span 
class="ectt-1200">task_id</span></span><span style="color:#000000"><span 
class="ectt-1200">)</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span> 
<span class="label"><a 
 id="x1-16045r11"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#006699"><span 
class="ectt-1200">pass</span></span>
 
<span class="label"><a 
 id="x1-16046r12"></a></span></pre>
   </div>
   
   <h4 class="subsectionHead"><span class="titlemark">5.2    </span> <a 
 id="x1-170005.2"></a>Queue and Workers</h4>
<!--l. 434--><p class="noindent" >Next we will modify our <span 
class="ectt-1200">docker-compose.yml </span>to include a local queuing service called Redis. Later we will use
AWS SQS, but as Celery supports multiple queues, we can use this to make the local development easier.
</p><div class="framedenv" id="code-1">
<!--l. 438--><p class="indent" >   <span 
class="ectt-1200">» cat docker-compose.yml</span> </p></div>   <div class="framedenv" id="code-1"><!--l. 438--><pre class="listings" id="listing-10"><span class="label"><a 
 id="x1-17001r1"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">redis</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span> 
<span class="label"><a 
 id="x1-17002r2"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">image</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">redis</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"><span 
class="ectt-1200">latest</span></span> 
<span class="label"><a 
 id="x1-17003r3"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">restart</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">always</span></span> 
<span class="label"><a 
 id="x1-17004r4"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">ports</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span> 
<span class="label"><a 
 id="x1-17005r5"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">"6379:6379"</span></span>
 
<span class="label"><a 
 id="x1-17006r6"></a></span></pre>
   </div>
<!--l. 446--><p class="noindent" >Now that we have a queue, we will create the worker that accepts jobs from the queue. We will create this worker
in <span 
class="ectt-1200">todo/tasks/ical.py</span>.    </p><div class="framedenv" id="code-1">
<!--l. 451--><p class="indent" >   <span 
class="ectt-1200">» cat todo/tasks/ical.py</span> </p></div>   <div class="framedenv" id="code-1"><!--l. 451--><pre class="listings" id="listing-11"><span class="label"><a 
 id="x1-17007r1"></a></span><span style="color:#006699"><span 
class="ectt-1200">import</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">os</span></span> 
<span class="label"><a 
 id="x1-17008r2"></a></span> 
<span class="label"><a 
 id="x1-17009r3"></a></span><span style="color:#006699"><span 
class="ectt-1200">from</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">celery</span></span><span style="color:#000000"> </span><span style="color:#006699"><span 
class="ectt-1200">import</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">Celery</span></span> 
<span class="label"><a 
 id="x1-17010r4"></a></span> 
<span class="label"><a 
 id="x1-17011r5"></a></span><span style="color:#000000"><span 
class="ectt-1200">celery</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">Celery</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#000000"><span 
class="ectt-1200">__name__</span></span><span style="color:#000000"><span 
class="ectt-1200">)</span></span> 
<span class="label"><a 
 id="x1-17012r6"></a></span><span style="color:#000000"><span 
class="ectt-1200">celery</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">conf</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">broker_url</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">os</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">environ</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">get</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">CELERY_BROKER_URL</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">)</span></span> 
<span class="label"><a 
 id="x1-17013r7"></a></span><span style="color:#000000"><span 
class="ectt-1200">celery</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">conf</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">result_backend</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">os</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">environ</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">get</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">CELERY_RESULT_BACKEND</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">)</span></span> 
<span class="label"><a 
 id="x1-17014r8"></a></span><span style="color:#000000"><span 
class="ectt-1200">celery</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">conf</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">task_default_queue</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">os</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">environ</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">get</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">CELERY_DEFAULT_QUEUE</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">ical</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">)</span></span> 
<span class="label"><a 
 id="x1-17015r9"></a></span> 
<span class="label"><a 
 id="x1-17016r10"></a></span><span style="color:#000000"><span 
class="ectt-1200">@celery</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">task</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#000000"><span 
class="ectt-1200">name</span></span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">ical</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">)</span></span> 
<span class="label"><a 
 id="x1-17017r11"></a></span><span style="color:#006699"><span 
class="ectt-1200">def</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">create_ical</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#000000"><span 
class="ectt-1200">tasks</span></span><span style="color:#000000"><span 
class="ectt-1200">)</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span> 
<span class="label"><a 
 id="x1-17018r12"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#006699"><span 
class="ectt-1200">return</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">Hello</span></span><span style="color:#669900"> </span><span style="color:#669900"><span 
class="ectt-1200">World</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span>
 
<span class="label"><a 
 id="x1-17019r13"></a></span></pre>
                                                                                                    
                                                                                                    
   </div>
<!--l. 466--><p class="noindent" >Note that we are getting a URL from the environment variables: <span 
class="ectt-1200">CELERY_BROKER_URL </span>and <span 
class="ectt-1200">CELERY_RESULT_BACKEND</span>.
We need to remember to set these variables in whichever environment the service is run.
</p><!--l. 471--><p class="indent" >   We need to install Celery. We will do this in the same poetry environment as the Flask server, as we will later
require our Flask server to use Celery to put jobs into the task queue.
</p>
   <div class="framedenv" id="shaded*-1">
   <!--l. 475-->
<pre class="lstlisting" id="listing-12"><span class="label"><a 
 id="x1-17020r1"></a></span><span style="color:#000000"><span 
class="ectt-1200">$</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">poetry</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">add</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">celery</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">redis</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">celery</span></span><span style="color:#000000"><span 
class="ectt-1200">[</span></span><span style="color:#000000"><span 
class="ectt-1200">sqs</span></span><span style="color:#000000"><span 
class="ectt-1200">]</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">boto3</span></span><span 
class="ectt-1200">&#x00A0;</span></pre>
   </div>
<!--l. 477--><p class="noindent" >The above will install the Celery core and Redis and AWS SQS drivers for communication.
</p><!--l. 480--><p class="indent" >   We will now start our local Redis queue and our worker to ensure that they can communicate.
</p>
   <div class="framedenv" id="shaded*-1">
   <!--l. 482-->
<pre class="lstlisting" id="listing-13"><span class="label"><a 
 id="x1-17021r1"></a></span><span style="color:#000000"><span 
class="ectt-1200">$</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">docker</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">compose</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">up</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">redis</span></span><span 
class="ectt-1200">&#x00A0;</span></pre>
   </div>
   <div class="framedenv" id="code-1">
<!--l. 484--><pre class="listings" id="listing-14"><span class="label"><a 
 id="x1-17022r1"></a></span><span style="color:#000000"><span 
class="ectt-1200">$</span></span><span style="color:#000000"> </span><span style="color:#006699"><span 
class="ectt-1200">export</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">CELERY_BROKER_URL</span></span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"><span 
class="ectt-1200">redis</span></span><span style="color:#000000"><span 
class="ectt-1200">://</span></span><span style="color:#000000"><span 
class="ectt-1200">localhost</span></span><span style="color:#000000"><span 
class="ectt-1200">:6379</span></span> 
<span class="label"><a 
 id="x1-17023r2"></a></span><span style="color:#000000"><span 
class="ectt-1200">$</span></span><span style="color:#000000"> </span><span style="color:#006699"><span 
class="ectt-1200">export</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">CELERY_RESULT_BACKEND</span></span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"><span 
class="ectt-1200">redis</span></span><span style="color:#000000"><span 
class="ectt-1200">://</span></span><span style="color:#000000"><span 
class="ectt-1200">localhost</span></span><span style="color:#000000"><span 
class="ectt-1200">:6379</span></span> 
<span class="label"><a 
 id="x1-17024r3"></a></span><span style="color:#000000"><span 
class="ectt-1200">$</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">poetry</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">run</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">python3</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">m</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">celery</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"><span 
class="ectt-1200">app</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">todo</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">tasks</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">ical</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">worker</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"><span 
class="ectt-1200">loglevel</span></span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"><span 
class="ectt-1200">info</span></span>
 
<span class="label"><a 
 id="x1-17025r4"></a></span></pre>
   </div>
<!--l. 490--><p class="indent" >   You should see something like the below. This indicates that the worker has successfully subscribed to the
queue and is ready to accept events.       </p><div class="framedenv" id="code-1">
<!--l. 493--><pre class="listings" id="listing-15"><span class="label"><a 
 id="x1-17026r1"></a></span><span style="color:#000000"><span 
class="ectt-1200">--------------</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">celery@uqrthoxx</span></span><span style="color:#000000"><span 
class="ectt-1200">-8811</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">v5</span></span><span style="color:#000000"><span 
class="ectt-1200">.5.1</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#000000"><span 
class="ectt-1200">immunity</span></span><span style="color:#000000"><span 
class="ectt-1200">)</span></span> 
<span class="label"><a 
 id="x1-17027r2"></a></span><span style="color:#000000"><span 
class="ectt-1200">---</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">*****</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">-----</span></span> 
<span class="label"><a 
 id="x1-17028r3"></a></span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">*******</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">----</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">Windows</span></span><span style="color:#000000"><span 
class="ectt-1200">-11-10.0.26100-</span></span><span style="color:#000000"><span 
class="ectt-1200">SP0</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">2025-04-11</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">14:02:30</span></span> 
<span class="label"><a 
 id="x1-17029r4"></a></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">***</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">---</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">---</span></span> 
<span class="label"><a 
 id="x1-17030r5"></a></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">**</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">----------</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">[</span></span><span style="color:#000000"><span 
class="ectt-1200">config</span></span><span style="color:#000000"><span 
class="ectt-1200">]</span></span> 
<span class="label"><a 
 id="x1-17031r6"></a></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">**</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">----------</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">.&#x003E;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">app</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">todo</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">tasks</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">ical</span></span><span style="color:#000000"><span 
class="ectt-1200">:0</span></span><span style="color:#000000"><span 
class="ectt-1200">x11c87792210</span></span> 
<span class="label"><a 
 id="x1-17032r7"></a></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">**</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">----------</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">.&#x003E;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">transport</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">redis</span></span><span style="color:#000000"><span 
class="ectt-1200">://</span></span><span style="color:#000000"><span 
class="ectt-1200">localhost</span></span><span style="color:#000000"><span 
class="ectt-1200">:6379//</span></span> 
<span class="label"><a 
 id="x1-17033r8"></a></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">**</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">----------</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">.&#x003E;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">results</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">redis</span></span><span style="color:#000000"><span 
class="ectt-1200">://</span></span><span style="color:#000000"><span 
class="ectt-1200">localhost</span></span><span style="color:#000000"><span 
class="ectt-1200">:6379/</span></span> 
<span class="label"><a 
 id="x1-17034r9"></a></span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">***</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">---</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">---</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">.&#x003E;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">concurrency</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#000000"><span 
class="ectt-1200">prefork</span></span><span style="color:#000000"><span 
class="ectt-1200">)</span></span> 
<span class="label"><a 
 id="x1-17035r10"></a></span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">*******</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">----</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">.&#x003E;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">task</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">events</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">OFF</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#000000"><span 
class="ectt-1200">enable</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"><span 
class="ectt-1200">E</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">to</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">monitor</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">tasks</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">in</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">this</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">worker</span></span><span style="color:#000000"><span 
class="ectt-1200">)</span></span> 
<span class="label"><a 
 id="x1-17036r11"></a></span><span style="color:#000000"><span 
class="ectt-1200">---</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">*****</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">-----</span></span> 
<span class="label"><a 
 id="x1-17037r12"></a></span><span style="color:#000000"><span 
class="ectt-1200">--------------</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">[</span></span><span style="color:#000000"><span 
class="ectt-1200">queues</span></span><span style="color:#000000"><span 
class="ectt-1200">]</span></span> 
<span class="label"><a 
 id="x1-17038r13"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">.&#x003E;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">ical</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">exchange</span></span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"><span 
class="ectt-1200">ical</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#000000"><span 
class="ectt-1200">direct</span></span><span style="color:#000000"><span 
class="ectt-1200">)</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">key</span></span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"><span 
class="ectt-1200">celery</span></span> 
<span class="label"><a 
 id="x1-17039r14"></a></span> 
<span class="label"><a 
 id="x1-17040r15"></a></span> 
<span class="label"><a 
 id="x1-17041r16"></a></span><span style="color:#000000"><span 
class="ectt-1200">[</span></span><span style="color:#000000"><span 
class="ectt-1200">tasks</span></span><span style="color:#000000"><span 
class="ectt-1200">]</span></span> 
<span class="label"><a 
 id="x1-17042r17"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">ical</span></span> 
<span class="label"><a 
 id="x1-17043r18"></a></span> 
<span class="label"><a 
 id="x1-17044r19"></a></span><span style="color:#000000"><span 
class="ectt-1200">[2025-04-11</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">14:02:30,382:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">INFO</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">MainProcess</span></span><span style="color:#000000"><span 
class="ectt-1200">]</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">Connected</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">to</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">redis</span></span><span style="color:#000000"><span 
class="ectt-1200">://</span></span><span style="color:#000000"><span 
class="ectt-1200">localhost</span></span><span style="color:#000000"><span 
class="ectt-1200">:6379//</span></span> 
<span class="label"><a 
 id="x1-17045r20"></a></span><span style="color:#000000"><span 
class="ectt-1200">[2025-04-11</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">14:02:30,388:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">INFO</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">MainProcess</span></span><span style="color:#000000"><span 
class="ectt-1200">]</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">mingle</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">searching</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">for</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">neighbors</span></span> 
<span class="label"><a 
 id="x1-17046r21"></a></span><span style="color:#000000"><span 
class="ectt-1200">[2025-04-11</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">14:02:31,428:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">INFO</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">MainProcess</span></span><span style="color:#000000"><span 
class="ectt-1200">]</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">mingle</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">all</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">alone</span></span> 
<span class="label"><a 
 id="x1-17047r22"></a></span><span style="color:#000000"><span 
class="ectt-1200">[2025-04-11</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">14:02:31,506:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">INFO</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">MainProcess</span></span><span style="color:#000000"><span 
class="ectt-1200">]</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">celery@uqrthoxx</span></span><span style="color:#000000"><span 
class="ectt-1200">-8811</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">ready</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span> 
<span class="label"><a 
 id="x1-17048r23"></a></span><span style="color:#000000"><span 
class="ectt-1200">...</span></span>
 
<span class="label"><a 
 id="x1-17049r24"></a></span></pre>
   </div>
<!--l. 519--><p class="indent" >   Finally, we will run Celery inside a new container. For this we will modify our <span 
class="ectt-1200">docker-compose.yml </span>file.
</p><div class="framedenv" id="code-1">
<!--l. 522--><p class="indent" >   <span 
class="ectt-1200">» cat docker-compose.yml</span> </p></div>   <div class="framedenv" id="code-1"><!--l. 522--><pre class="listings" id="listing-16"><span class="label"><a 
 id="x1-17050r1"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">worker</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span> 
<span class="label"><a 
 id="x1-17051r2"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">build</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span> 
<span class="label"><a 
 id="x1-17052r3"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">context</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">.</span></span> 
<span class="label"><a 
 id="x1-17053r4"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">dockerfile</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">Dockerfile</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">dev</span></span> 
<span class="label"><a 
 id="x1-17054r5"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">restart</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">always</span></span> 
<span class="label"><a 
 id="x1-17055r6"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">environment</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span> 
<span class="label"><a 
 id="x1-17056r7"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">CELERY_BROKER_URL</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">redis</span></span><span style="color:#000000"><span 
class="ectt-1200">://</span></span><span style="color:#000000"><span 
class="ectt-1200">redis</span></span><span style="color:#000000"><span 
class="ectt-1200">:6379</span></span> 
<span class="label"><a 
 id="x1-17057r8"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">CELERY_RESULT_BACKEND</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">redis</span></span><span style="color:#000000"><span 
class="ectt-1200">://</span></span><span style="color:#000000"><span 
class="ectt-1200">redis</span></span><span style="color:#000000"><span 
class="ectt-1200">:6379</span></span> 
<span class="label"><a 
 id="x1-17058r9"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">command</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">poetry</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">run</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">celery</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"><span 
class="ectt-1200">app</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">todo</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">tasks</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">ical</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">worker</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"><span 
class="ectt-1200">loglevel</span></span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"><span 
class="ectt-1200">info</span></span>
 
<span class="label"><a 
 id="x1-17059r10"></a></span></pre>
   </div>
<!--l. 534--><p class="indent" >   Note that we are re-using the same image development image as the Flask server. This makes sense since it
shares very similar dependencies. It would make sense to separate the dependencies between the two containers
as they grow larger.
</p><!--l. 538--><p class="indent" >   We are overriding the command to run when the container starts to use the celery command. We have also
remembered to set the environment variables appropriately. We have to use the domain name of the redis
image instead of the localhost because redis is not running on our localhost. Earlier we were able to
pretend it was because the redis port, 6379, was being forwarded from our localhost to our redis
container.
   
</p>
   <h4 class="subsectionHead"><span class="titlemark">5.3    </span> <a 
 id="x1-180005.3"></a>Creating Tasks</h4>
                                                                                                    
                                                                                                    
<!--l. 545--><p class="noindent" >We will now return to our Flask server. We will modify our new endpoints to use Celery to create tasks and add
them to the task queue.    </p><div class="framedenv" id="code-1">
<!--l. 548--><p class="indent" >   <span 
class="ectt-1200">» cat todo/views/routes.py</span> </p></div>   <div class="framedenv" id="code-1"><!--l. 548--><pre class="listings" id="listing-17"><span class="label"><a 
 id="x1-18001r1"></a></span><span style="color:#006699"><span 
class="ectt-1200">from</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">celery</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">result</span></span><span style="color:#000000"> </span><span style="color:#006699"><span 
class="ectt-1200">import</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">AsyncResult</span></span> 
<span class="label"><a 
 id="x1-18002r2"></a></span><span style="color:#006699"><span 
class="ectt-1200">from</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">todo</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">tasks</span></span><span style="color:#000000"> </span><span style="color:#006699"><span 
class="ectt-1200">import</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">ical</span></span> 
<span class="label"><a 
 id="x1-18003r3"></a></span> 
<span class="label"><a 
 id="x1-18004r4"></a></span><span style="color:#000000"><span 
class="ectt-1200">...</span></span> 
<span class="label"><a 
 id="x1-18005r5"></a></span> 
<span class="label"><a 
 id="x1-18006r6"></a></span><span style="color:#000000"><span 
class="ectt-1200">@api</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">route</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">todos</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">ical</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">methods</span></span><span style="color:#000000"><span 
class="ectt-1200">=[</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#669900"><span 
class="ectt-1200">POST</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#000000"><span 
class="ectt-1200">])</span></span> 
<span class="label"><a 
 id="x1-18007r7"></a></span><span style="color:#006699"><span 
class="ectt-1200">def</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">create_ical</span></span><span style="color:#000000"><span 
class="ectt-1200">()</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span> 
<span class="label"><a 
 id="x1-18008r8"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">todos</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">Todo</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">query</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">order_by</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#000000"><span 
class="ectt-1200">Todo</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">created_at</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">desc</span></span><span style="color:#000000"><span 
class="ectt-1200">()</span></span><span style="color:#000000"><span 
class="ectt-1200">)</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#006699"><span 
class="ectt-1200">all</span></span><span style="color:#000000"><span 
class="ectt-1200">()</span></span> 
<span class="label"><a 
 id="x1-18009r9"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">todo_input</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">[]</span></span> 
<span class="label"><a 
 id="x1-18010r10"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#006699"><span 
class="ectt-1200">for</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">todo</span></span><span style="color:#000000"> </span><span style="color:#006699"><span 
class="ectt-1200">in</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">todos</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span> 
<span class="label"><a 
 id="x1-18011r11"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">todo_input</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">append</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#000000"><span 
class="ectt-1200">todo</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">to_dict</span></span><span style="color:#000000"><span 
class="ectt-1200">()</span></span><span style="color:#000000"><span 
class="ectt-1200">)</span></span> 
<span class="label"><a 
 id="x1-18012r12"></a></span> 
<span class="label"><a 
 id="x1-18013r13"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">task</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">ical</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">create_ical</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">delay</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#000000"><span 
class="ectt-1200">todo_input</span></span><span style="color:#000000"><span 
class="ectt-1200">)</span></span> 
<span class="label"><a 
 id="x1-18014r14"></a></span> 
<span class="label"><a 
 id="x1-18015r15"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">result</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-18016r16"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#669900"><span 
class="ectt-1200">task_id</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">task</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#006699"><span 
class="ectt-1200">id</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span> 
<span class="label"><a 
 id="x1-18017r17"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#669900"><span 
class="ectt-1200">task_url</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">f</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#669900"><span 
class="ectt-1200">{</span></span><span style="color:#669900"><span 
class="ectt-1200">request</span></span><span style="color:#669900"><span 
class="ectt-1200">.</span></span><span style="color:#669900"><span 
class="ectt-1200">host_url</span></span><span style="color:#669900"><span 
class="ectt-1200">}</span></span><span style="color:#669900"><span 
class="ectt-1200">api</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">v1</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">todos</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">ical</span></span><span style="color:#669900"><span 
class="ectt-1200">/{</span></span><span style="color:#669900"><span 
class="ectt-1200">task</span></span><span style="color:#669900"><span 
class="ectt-1200">.</span></span><span style="color:#669900"><span 
class="ectt-1200">id</span></span><span style="color:#669900"><span 
class="ectt-1200">}/</span></span><span style="color:#669900"><span 
class="ectt-1200">status</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span> 
<span class="label"><a 
 id="x1-18018r18"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">}</span></span> 
<span class="label"><a 
 id="x1-18019r19"></a></span> 
<span class="label"><a 
 id="x1-18020r20"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#006699"><span 
class="ectt-1200">return</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">jsonify</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#000000"><span 
class="ectt-1200">result</span></span><span style="color:#000000"><span 
class="ectt-1200">)</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">202</span></span> 
<span class="label"><a 
 id="x1-18021r21"></a></span> 
<span class="label"><a 
 id="x1-18022r22"></a></span><span style="color:#000000"><span 
class="ectt-1200">@api</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">route</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">todos</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">ical</span></span><span style="color:#669900"><span 
class="ectt-1200">/&#x003C;</span></span><span style="color:#669900"><span 
class="ectt-1200">task_id</span></span><span style="color:#669900"><span 
class="ectt-1200">&#x003E;/</span></span><span style="color:#669900"><span 
class="ectt-1200">status</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">methods</span></span><span style="color:#000000"><span 
class="ectt-1200">=[</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#669900"><span 
class="ectt-1200">GET</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#000000"><span 
class="ectt-1200">])</span></span> 
<span class="label"><a 
 id="x1-18023r23"></a></span><span style="color:#006699"><span 
class="ectt-1200">def</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">get_task</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#000000"><span 
class="ectt-1200">task_id</span></span><span style="color:#000000"><span 
class="ectt-1200">)</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span> 
<span class="label"><a 
 id="x1-18024r24"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">task_result</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">AsyncResult</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#000000"><span 
class="ectt-1200">task_id</span></span><span style="color:#000000"><span 
class="ectt-1200">)</span></span> 
<span class="label"><a 
 id="x1-18025r25"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">result</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-18026r26"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">task_id</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">task_id</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span> 
<span class="label"><a 
 id="x1-18027r27"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">task_status</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">task_result</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">status</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span> 
<span class="label"><a 
 id="x1-18028r28"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">result_url</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">f</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#669900"><span 
class="ectt-1200">{</span></span><span style="color:#669900"><span 
class="ectt-1200">request</span></span><span style="color:#669900"><span 
class="ectt-1200">.</span></span><span style="color:#669900"><span 
class="ectt-1200">host_url</span></span><span style="color:#669900"><span 
class="ectt-1200">}</span></span><span style="color:#669900"><span 
class="ectt-1200">api</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">v1</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">todos</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">ical</span></span><span style="color:#669900"><span 
class="ectt-1200">/{</span></span><span style="color:#669900"><span 
class="ectt-1200">task_id</span></span><span style="color:#669900"><span 
class="ectt-1200">}/</span></span><span style="color:#669900"><span 
class="ectt-1200">result</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span> 
<span class="label"><a 
 id="x1-18029r29"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">}</span></span> 
<span class="label"><a 
 id="x1-18030r30"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#006699"><span 
class="ectt-1200">return</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">jsonify</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#000000"><span 
class="ectt-1200">result</span></span><span style="color:#000000"><span 
class="ectt-1200">)</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">200</span></span> 
<span class="label"><a 
 id="x1-18031r31"></a></span> 
<span class="label"><a 
 id="x1-18032r32"></a></span><span style="color:#000000"><span 
class="ectt-1200">@api</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">route</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">todos</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">ical</span></span><span style="color:#669900"><span 
class="ectt-1200">/&#x003C;</span></span><span style="color:#669900"><span 
class="ectt-1200">task_id</span></span><span style="color:#669900"><span 
class="ectt-1200">&#x003E;/</span></span><span style="color:#669900"><span 
class="ectt-1200">result</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">methods</span></span><span style="color:#000000"><span 
class="ectt-1200">=[</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#669900"><span 
class="ectt-1200">GET</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#000000"><span 
class="ectt-1200">])</span></span> 
<span class="label"><a 
 id="x1-18033r33"></a></span><span style="color:#006699"><span 
class="ectt-1200">def</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">get_calendar</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#000000"><span 
class="ectt-1200">task_id</span></span><span style="color:#000000"><span 
class="ectt-1200">)</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span> 
<span class="label"><a 
 id="x1-18034r34"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">task_result</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">AsyncResult</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#000000"><span 
class="ectt-1200">task_id</span></span><span style="color:#000000"><span 
class="ectt-1200">)</span></span> 
<span class="label"><a 
 id="x1-18035r35"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#006699"><span 
class="ectt-1200">if</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">task_result</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">status</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">==</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#669900"><span 
class="ectt-1200">SUCCESS</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span> 
<span class="label"><a 
 id="x1-18036r36"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#006699"><span 
class="ectt-1200">return</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">task_result</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">result</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">200,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#669900"><span 
class="ectt-1200">Content</span></span><span style="color:#669900"><span 
class="ectt-1200">-</span></span><span style="color:#669900"><span 
class="ectt-1200">Type</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#669900"><span 
class="ectt-1200">text</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">calendar</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#000000"><span 
class="ectt-1200">}</span></span> 
<span class="label"><a 
 id="x1-18037r37"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#006699"><span 
class="ectt-1200">else</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span> 
<span class="label"><a 
 id="x1-18038r38"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#006699"><span 
class="ectt-1200">return</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">jsonify</span></span><span style="color:#000000"><span 
class="ectt-1200">({</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#669900"><span 
class="ectt-1200">error</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#669900"><span 
class="ectt-1200">Task</span></span><span style="color:#669900"> </span><span style="color:#669900"><span 
class="ectt-1200">not</span></span><span style="color:#669900"> </span><span style="color:#669900"><span 
class="ectt-1200">finished</span></span><span style="color:#669900"><span 
class="tctt-1200">'</span></span><span style="color:#000000"><span 
class="ectt-1200">})</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">404</span></span>
 
<span class="label"><a 
 id="x1-18039r39"></a></span></pre>
   </div>
<!--l. 589--><p class="indent" >   The variable that we create as tasks and pass to the delay method is the JSON data that is stored with the
event. It is then deserialized from JSON and passed as a variable to the <span 
class="ectt-1200">create_ical </span>function. Celery is able to
create impressive abstractions so that message passing over a task queue looks almost like regular function
calls.
</p><!--l. 593--><p class="indent" >   Before we can successfully use this endpoint to get our important &#8220;Hello World&#8221; result, we need to configure
the server to talk to our Redis container. Add the Celery environment variables to the <span 
class="ectt-1200">app</span>&#8217;s <span 
class="ectt-1200">environment </span>in
<span 
class="ectt-1200">docker-compose.yml</span>.    </p><div class="framedenv" id="code-1">
<!--l. 597--><p class="indent" >   <span 
class="ectt-1200">» cat docker-compose.yml</span> </p></div>   <div class="framedenv" id="code-1"><!--l. 597--><pre class="listings" id="listing-18"><span class="label"><a 
 id="x1-18040r1"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">environment</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span> 
<span class="label"><a 
 id="x1-18041r2"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">CELERY_BROKER_URL</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">redis</span></span><span style="color:#000000"><span 
class="ectt-1200">://</span></span><span style="color:#000000"><span 
class="ectt-1200">redis</span></span><span style="color:#000000"><span 
class="ectt-1200">:6379</span></span> 
<span class="label"><a 
 id="x1-18042r3"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">CELERY_RESULT_BACKEND</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">redis</span></span><span style="color:#000000"><span 
class="ectt-1200">://</span></span><span style="color:#000000"><span 
class="ectt-1200">redis</span></span><span style="color:#000000"><span 
class="ectt-1200">:6379</span></span>
 
<span class="label"><a 
 id="x1-18043r4"></a></span></pre>
   </div>
<!--l. 603--><p class="indent" >   You should now be able to start the server and worker with <span 
class="ectt-1200">docker compose</span>.
</p>
   <div class="framedenv" id="shaded*-1">
   <!--l. 605-->
<pre class="lstlisting" id="listing-19"><span class="label"><a 
 id="x1-18044r1"></a></span><span style="color:#000000"><span 
class="ectt-1200">$</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">docker</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">compose</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">up</span></span><span 
class="ectt-1200">&#x00A0;</span></pre>
   </div>
<!--l. 607--><p class="indent" >   You can now send a POST request to the <span 
class="ectt-1200">/api/v1/todos/ical </span>endpoint to start a job and follow the
subsequent URLs to see the result of the job.
   
</p>
   <h4 class="subsectionHead"><span class="titlemark">5.4    </span> <a 
 id="x1-190005.4"></a>Creating the Calendar</h4>
<!--l. 612--><p class="noindent" >Once we have confirmed that the task queue can communicate with our worker, we can return to the calendar
generation. We will use the <span 
class="ectt-1200">icalendar </span>library for this.
</p>
   <div class="framedenv" id="shaded*-1">
   <!--l. 616-->
<pre class="lstlisting" id="listing-20"><span class="label"><a 
 id="x1-19001r1"></a></span><span style="color:#000000"><span 
class="ectt-1200">$</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">poetry</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">add</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">icalendar</span></span><span 
class="ectt-1200">&#x00A0;</span></pre>
   </div><!--l. 619--><p class="indent" ></p><div class="framedenv" id="code-1">
<!--l. 619--><p class="indent" >   <span 
class="ectt-1200">» cat todo/tasks/ical.py</span> </p></div>   <div class="framedenv" id="code-1"><!--l. 619--><pre class="listings" id="listing-21"><span class="label"><a 
 id="x1-19002r1"></a></span><span style="color:#006699"><span 
class="ectt-1200">import</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">icalendar</span></span> 
<span class="label"><a 
 id="x1-19003r2"></a></span><span style="color:#006699"><span 
class="ectt-1200">import</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">time</span></span> 
<span class="label"><a 
 id="x1-19004r3"></a></span><span style="color:#006699"><span 
class="ectt-1200">import</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">datetime</span></span> 
<span class="label"><a 
 id="x1-19005r4"></a></span> 
<span class="label"><a 
 id="x1-19006r5"></a></span><span style="color:#000000"><span 
class="ectt-1200">...</span></span> 
<span class="label"><a 
 id="x1-19007r6"></a></span> 
<span class="label"><a 
 id="x1-19008r7"></a></span><span style="color:#006699"><span 
class="ectt-1200">def</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">create_ical</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#000000"><span 
class="ectt-1200">tasks</span></span><span style="color:#000000"><span 
class="ectt-1200">)</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span> 
<span class="label"><a 
 id="x1-19009r8"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">cal</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">icalendar</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">Calendar</span></span><span style="color:#000000"><span 
class="ectt-1200">()</span></span> 
<span class="label"><a 
 id="x1-19010r9"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">cal</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">add</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">prodid</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">-//</span></span><span style="color:#669900"><span 
class="ectt-1200">Taskoverflow</span></span><span style="color:#669900"> </span><span style="color:#669900"><span 
class="ectt-1200">Calendar</span></span><span style="color:#669900"><span 
class="ectt-1200">//</span></span><span style="color:#669900"><span 
class="ectt-1200">mxm</span></span><span style="color:#669900"><span 
class="ectt-1200">.</span></span><span style="color:#669900"><span 
class="ectt-1200">dk</span></span><span style="color:#669900"><span 
class="ectt-1200">//</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">)</span></span> 
<span class="label"><a 
 id="x1-19011r10"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">cal</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">add</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">version</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">2.0</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">)</span></span> 
<span class="label"><a 
 id="x1-19012r11"></a></span> 
<span class="label"><a 
 id="x1-19013r12"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">time</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">sleep</span></span><span style="color:#000000"><span 
class="ectt-1200">(50)</span></span> 
<span class="label"><a 
 id="x1-19014r13"></a></span> 
<span class="label"><a 
 id="x1-19015r14"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#006699"><span 
class="ectt-1200">for</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">task</span></span><span style="color:#000000"> </span><span style="color:#006699"><span 
class="ectt-1200">in</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">tasks</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span> 
<span class="label"><a 
 id="x1-19016r15"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">event</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">icalendar</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">Event</span></span><span style="color:#000000"><span 
class="ectt-1200">()</span></span> 
<span class="label"><a 
 id="x1-19017r16"></a></span> 
<span class="label"><a 
 id="x1-19018r17"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">event</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">add</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">uid</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">task</span></span><span style="color:#000000"><span 
class="ectt-1200">[</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">id</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">])</span></span> 
<span class="label"><a 
 id="x1-19019r18"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">event</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">add</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">summary</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">task</span></span><span style="color:#000000"><span 
class="ectt-1200">[</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">title</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">])</span></span> 
<span class="label"><a 
 id="x1-19020r19"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">event</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">add</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">description</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">task</span></span><span style="color:#000000"><span 
class="ectt-1200">[</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">description</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">])</span></span> 
<span class="label"><a 
 id="x1-19021r20"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">event</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">add</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">dtstart</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">datetime</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">datetime</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">strptime</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#000000"><span 
class="ectt-1200">task</span></span><span style="color:#000000"><span 
class="ectt-1200">[</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">deadline_at</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">],</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">%</span></span><span style="color:#669900"><span 
class="ectt-1200">Y</span></span><span style="color:#669900"><span 
class="ectt-1200">-%</span></span><span style="color:#669900"><span 
class="ectt-1200">m</span></span><span style="color:#669900"><span 
class="ectt-1200">-%</span></span><span style="color:#669900"><span 
class="ectt-1200">dT</span></span><span style="color:#669900"><span 
class="ectt-1200">%</span></span><span style="color:#669900"><span 
class="ectt-1200">H</span></span><span style="color:#669900"><span 
class="ectt-1200">:%</span></span><span style="color:#669900"><span 
class="ectt-1200">M</span></span><span style="color:#669900"><span 
class="ectt-1200">:%</span></span><span style="color:#669900"><span 
class="ectt-1200">S</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">)</span></span><span style="color:#000000"><span 
class="ectt-1200">)</span></span> 
<span class="label"><a 
 id="x1-19022r21"></a></span> 
<span class="label"><a 
 id="x1-19023r22"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">cal</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">add_component</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#000000"><span 
class="ectt-1200">event</span></span><span style="color:#000000"><span 
class="ectt-1200">)</span></span> 
<span class="label"><a 
 id="x1-19024r23"></a></span> 
<span class="label"><a 
 id="x1-19025r24"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#006699"><span 
class="ectt-1200">return</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">cal</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">to_ical</span></span><span style="color:#000000"><span 
class="ectt-1200">()</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">decode</span></span><span style="color:#000000"><span 
class="ectt-1200">(</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">utf</span></span><span style="color:#669900"><span 
class="ectt-1200">-8</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">)</span></span>
 
<span class="label"><a 
 id="x1-19026r25"></a></span></pre>
   </div>
<!--l. 646--><p class="indent" >   Now you should be able to test your application.
      </p><ol  class="enumerate1" >
<li 
  class="enumerate" id="x1-19028x1">
      <!--l. 648--><p class="noindent" >Start it with <span 
class="ectt-1200">docker compose</span>.  </p><div class="framedenv" id="shaded*-1">
      <!--l. 649-->
      <pre class="lstlisting" id="listing-22"><span class="label"><a 
 id="x1-19029r1"></a></span><span style="color:#000000"><span 
class="ectt-1200">$</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">docker</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">compose</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">up</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">--</span></span><span style="color:#000000"><span 
class="ectt-1200">build</span></span><span 
class="ectt-1200">&#x00A0;</span></pre>
      
                                                                                                    
                                                                                                    
      </div>
      </li>
<li 
  class="enumerate" id="x1-19031x2">
      <!--l. 650--><p class="noindent" >Open the user interface on <a 
href="http://localhost:6400" class="url" ><span 
class="ectt-1200">http://localhost:6400</span></a> and create some tasks.
      </p></li>
<li 
  class="enumerate" id="x1-19033x3">
      <!--l. 651--><p class="noindent" >Follow the cURL interaction from Section <a 
href="#x1-160005.1">5.1<!--tex4ht:ref: sect:apiext --></a> to generate an appropriate iCal.</p></li></ol>
   
   <h3 class="sectionHead"><span class="titlemark">6    </span> <a 
 id="x1-200006"></a>Deploying with SQS</h3>
<!--l. 657--><p class="noindent" >First we will modify our worker so that it can run locally and connect to an SQS queue. We need to create an
appropriate SQS queue.    </p><div class="framedenv" id="code-1">
<!--l. 660--><p class="indent" >   <span 
class="ectt-1200">» cat sqs.tf</span> </p></div>   <div class="framedenv" id="code-1"><!--l. 660--><pre class="listings" id="listing-23"><span class="label"><a 
 id="x1-20001r1"></a></span><span style="color:#006699"><span 
class="ectt-1200">terraform</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-20002r2"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#006699"><span 
class="ectt-1200">required_providers</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-20003r3"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">aws</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-20004r4"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">source</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">hashicorp</span></span><span style="color:#669900"><span 
class="ectt-1200">/</span></span><span style="color:#669900"><span 
class="ectt-1200">aws</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-20005r5"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">version</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">~&#x003E;</span></span><span style="color:#669900"> </span><span style="color:#669900"><span 
class="ectt-1200">5.0</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-20006r6"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">}</span></span> 
<span class="label"><a 
 id="x1-20007r7"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">}</span></span> 
<span class="label"><a 
 id="x1-20008r8"></a></span><span style="color:#000000"><span 
class="ectt-1200">}</span></span> 
<span class="label"><a 
 id="x1-20009r9"></a></span> 
<span class="label"><a 
 id="x1-20010r10"></a></span><span style="color:#006699"><span 
class="ectt-1200">provider</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">aws</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-20011r11"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">region</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">us</span></span><span style="color:#669900"><span 
class="ectt-1200">-</span></span><span style="color:#669900"><span 
class="ectt-1200">east</span></span><span style="color:#669900"><span 
class="ectt-1200">-1</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-20012r12"></a></span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">shared_credentials_files</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">[</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">./</span></span><span style="color:#669900"><span 
class="ectt-1200">credentials</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">]</span></span> 
<span class="label"><a 
 id="x1-20013r13"></a></span><span style="color:#000000"><span 
class="ectt-1200">}</span></span> 
<span class="label"><a 
 id="x1-20014r14"></a></span> 
<span class="label"><a 
 id="x1-20015r15"></a></span><span style="color:#006699"><span 
class="ectt-1200">resource</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">aws_sqs_queue</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">ical_queue</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">{</span></span> 
<span class="label"><a 
 id="x1-20016r16"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">name</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">=</span></span><span style="color:#000000"> </span><span style="color:#669900"><span 
class="ectt-1200">"</span></span><span style="color:#669900"><span 
class="ectt-1200">ical</span></span><span style="color:#669900"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-20017r17"></a></span><span style="color:#000000"><span 
class="ectt-1200">}</span></span>
 
<span class="label"><a 
 id="x1-20018r18"></a></span></pre>
   </div>
   <div class="tcolorbox tcolorbox" id="tcolobox-10"> 
<div class="tcolorbox-title">
<!--l. 682--><p class="indent" >   Info</p></div> 
<div class="tcolorbox-content"><!--l. 682--><p class="noindent" >Celery will automatically create a queue if it does not exist, however, we want to manage it with
Terraform so it is easier to destroy.  </p> 
</div> 
</div>
<!--l. 684--><p class="indent" >   Now we need to tell our worker to use our SQS queue. To do this we will use the <span 
class="ectt-1200">sqs:// </span>broker URL.
This tells Celery to use SQS. Celery will then attempt to find appropriate AWS credentials to use to
authenticate.
   
</p>
   <h4 class="subsectionHead"><span class="titlemark">6.1    </span> <a 
 id="x1-210006.1"></a>Environment Variables</h4>
<!--l. 691--><p class="noindent" >We can pass the credentials in as environment variables, using the <span 
class="ectt-1200">aws.env </span>file we created in section
<a 
href="#x1-100003.1">3.1<!--tex4ht:ref: sec:q-cli --></a>.</p><!--l. 695--><p class="indent" ></p><div class="framedenv" id="code-1">
<!--l. 695--><p class="indent" >   <span 
class="ectt-1200">» cat docker-compose.yml</span> </p></div>   <div class="framedenv" id="code-1"><!--l. 695--><pre class="listings" id="listing-24"><span class="label"><a 
 id="x1-21001r1"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">volumes</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span> 
<span class="label"><a 
 id="x1-21002r2"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">./</span></span><span style="color:#000000"><span 
class="ectt-1200">todo</span></span><span style="color:#000000"><span 
class="ectt-1200">:/</span></span><span style="color:#000000"><span 
class="ectt-1200">app</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">todo</span></span> 
<span class="label"><a 
 id="x1-21003r3"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">env_file</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">"</span></span><span style="color:#000000"><span 
class="ectt-1200">aws</span></span><span style="color:#000000"><span 
class="ectt-1200">.</span></span><span style="color:#000000"><span 
class="ectt-1200">env</span></span><span style="color:#000000"><span 
class="ectt-1200">"</span></span> 
<span class="label"><a 
 id="x1-21004r4"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">environment</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span> 
<span class="label"><a 
 id="x1-21005r5"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">CELERY_BROKER_URL</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">sqs</span></span><span style="color:#000000"><span 
class="ectt-1200">://</span></span>
 
<span class="label"><a 
 id="x1-21006r6"></a></span></pre>
   </div>
<!--l. 703--><p class="indent" >   Ensure that you update both the worker and the server (app).
   
</p>
   <h4 class="subsectionHead"><span class="titlemark">6.2    </span> <a 
 id="x1-220006.2"></a>Credentials File</h4>
<!--l. 707--><p class="noindent" >It is also possible to mount the <span 
class="ectt-1200">credentials </span>file that already exists within our container.    </p><div class="framedenv" id="code-1">
<!--l. 709--><p class="indent" >   <span 
class="ectt-1200">» cat docker-compose.yml</span> </p></div>   <div class="framedenv" id="code-1"><!--l. 709--><pre class="listings" id="listing-25"><span class="label"><a 
 id="x1-22001r1"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">volumes</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span> 
<span class="label"><a 
 id="x1-22002r2"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">./</span></span><span style="color:#000000"><span 
class="ectt-1200">todo</span></span><span style="color:#000000"><span 
class="ectt-1200">:/</span></span><span style="color:#000000"><span 
class="ectt-1200">app</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">todo</span></span> 
<span class="label"><a 
 id="x1-22003r3"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">-</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">./</span></span><span style="color:#000000"><span 
class="ectt-1200">credentials</span></span><span style="color:#000000"><span 
class="ectt-1200">:/</span></span><span style="color:#000000"><span 
class="ectt-1200">root</span></span><span style="color:#000000"><span 
class="ectt-1200">/.</span></span><span style="color:#000000"><span 
class="ectt-1200">aws</span></span><span style="color:#000000"><span 
class="ectt-1200">/</span></span><span style="color:#000000"><span 
class="ectt-1200">credentials</span></span> 
<span class="label"><a 
 id="x1-22004r4"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">environment</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span> 
<span class="label"><a 
 id="x1-22005r5"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">CELERY_BROKER_URL</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">sqs</span></span><span style="color:#000000"><span 
class="ectt-1200">://</span></span>
 
<span class="label"><a 
 id="x1-22006r6"></a></span></pre>
   </div>
<!--l. 717--><p class="indent" >   Note that we are using <span 
class="ectt-1200">/root </span>since the container is run as the root user and Celery will therefore look at
<span 
class="ectt-1200">~/.aws/credentials</span>.
   
                                                                                                    
                                                                                                    
</p>
   <h4 class="subsectionHead"><span class="titlemark">6.3    </span> <a 
 id="x1-230006.3"></a>Tracking Jobs</h4>
<!--l. 721--><p class="noindent" >We can use the SQS queue in this state to create tasks and our workers will pick it up. This is often sufficient,
however, in our implementation we have made use of Celery&#8217;s built-in functionality to track jobs with a persistent
data store. This is by use of the <span 
class="ectt-1200">AsyncResult </span>class. If we tried to go to the status or result page for a task we
submitted, we would receive an error.
</p><!--l. 727--><p class="indent" >   To work around this issue, we will use our existing PostgreSQL database as our persistent store to track
tasks.
</p><!--l. 730--><p class="indent" >   We can update our <span 
class="ectt-1200">docker-compose.yml </span>as below to allow Celery to use our PostgreSQL database.
</p><div class="framedenv" id="code-1">
<!--l. 732--><p class="indent" >   <span 
class="ectt-1200">» cat docker-compose.yml</span> </p></div>   <div class="framedenv" id="code-1"><!--l. 732--><pre class="listings" id="listing-26"><span class="label"><a 
 id="x1-23001r1"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">environment</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span> 
<span class="label"><a 
 id="x1-23002r2"></a></span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span 
class="ectt-1200">&#x00A0;</span><span style="color:#000000"><span 
class="ectt-1200">CELERY_RESULT_BACKEND</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="ectt-1200">db</span></span><span style="color:#000000"><span 
class="ectt-1200">+</span></span><span style="color:#000000"><span 
class="ectt-1200">postgresql</span></span><span style="color:#000000"><span 
class="ectt-1200">://</span></span><span style="color:#000000"><span 
class="ectt-1200">administrator</span></span><span style="color:#000000"><span 
class="ectt-1200">:</span></span><span style="color:#000000"><span 
class="ectt-1200">verySecretPassword@database</span></span><span style="color:#000000"><span 
class="ectt-1200">:5432/</span></span><span style="color:#000000"><span 
class="ectt-1200">todo</span></span>
 
<span class="label"><a 
 id="x1-23003r3"></a></span></pre>
   </div>
<!--l. 737--><p class="indent" >   This is the same as the <span 
class="ectt-1200">SQLALCHEMY_DATABASE_URI</span>, except for <span 
class="ectt-1200">db+ </span>at the start to help Celery identify the type
of data store.
   
</p>
   <h3 class="sectionHead"><span class="titlemark">7    </span> <a 
 id="x1-240007"></a>Deploying with ECS</h3>
<!--l. 743--><p class="noindent" >Now we have a
      </p><ol  class="enumerate1" >
<li 
  class="enumerate" id="x1-24002x1">
      <!--l. 745--><p class="noindent" >SQS queue on AWS,
      </p></li>
<li 
  class="enumerate" id="x1-24004x2">
      <!--l. 746--><p class="noindent" >Celery worker container running locally,
      </p></li>
<li 
  class="enumerate" id="x1-24006x3">
      <!--l. 747--><p class="noindent" >Flask server container running locally, and
      </p></li>
<li 
  class="enumerate" id="x1-24008x4">
      <!--l. 748--><p class="noindent" >PostgreSQL database running locally.</p></li></ol>
<!--l. 751--><p class="indent" >   In the week 5 practical we demonstrated how to host a container on ECR, and how to use that hosted image
to deploy containers on ECS. In that practical we also deployed a PostgreSQL database on RDS
<span class="cite">[<a 
href="#Xprac-week5">2</a>]</span>.
</p><!--l. 755--><p class="indent" >   We strongly encourage you to try and deploy all components of the TaskOverflow application
on AWS infrastructure. This will be excellent practice for the final stage of the cloud infrastructure
assignment.
   
                                                                                                    
                                                                                                    
</p>
<!--l. 758--><p class="noindent" ><span class="paragraphHead"><a 
 id="x1-25000"></a><span 
class="Cabin-Bold-tlf-t1-x-x-120">Hints</span></span>
      </p><ol  class="enumerate1" >
<li 
  class="enumerate" id="x1-25002x1">
      <!--l. 760--><p class="noindent" >ECS/EC2 containers will automatically authenticate with your AWS account, so the <span 
class="ectt-1200">credentials </span>file
      is not required.
      </p></li>
<li 
  class="enumerate" id="x1-25004x2">
      <!--l. 762--><p class="noindent" >Attempt to test each component is deployed correctly individually, e.g. deploy RDS and ensure the
      system works, then deploy the server and ensure the system works, etc.</p></li></ol>
   
   <h3 class="likesectionHead"><a 
 id="x1-26000"></a>References</h3>
<!--l. 1--><p class="noindent" >
   </p><div class="thebibliography">
   <p class="bibitem" ><span class="biblabel">
 [1]<span class="bibsp">&#x00A0;&#x00A0;&#x00A0;</span></span><a 
 id="Xevents-notes"></a>R.&#x00A0;Thomas,           &#8220;Event-driven           architecture,&#8221;           March           2023.                                          
<a 
href="https://csse6400.uqcloud.net/handouts/event.pdf" class="url" ><span 
class="ectt-1200">https://csse6400.uqcloud.net/handouts/event.pdf</span></a>.
   </p>
   <p class="bibitem" ><span class="biblabel">
 [2]<span class="bibsp">&#x00A0;&#x00A0;&#x00A0;</span></span><a 
 id="Xprac-week5"></a>E.&#x00A0;Hughes,                        B.&#x00A0;Webb,                        and                        R.&#x00A0;Thomas,                        &#8220;Database
   &amp; container deployment,&#8221; vol.&#x00A0;5 of <span 
class="Cabin-Italic-tlf-t1-x-x-120">CSSE6400 Practicals</span>, The University of Queensland, March 2025. 
<a 
href="https://csse6400.uqcloud.net/practicals/week05.pdf" class="url" ><span 
class="ectt-1200">https://csse6400.uqcloud.net/practicals/week05.pdf</span></a>.
</p>
   </div>
   <div class="footnotes"><aside role="doc-footnote" class="footnotetext">
<!--l. 73--><p class="noindent" ><a 
 id="x1-5002x2.1.2"></a><span class="footnote-mark"><a 
href="#fn1x0-bk" id="fn1x0"><sup class="textsuperscript">1</sup></a></span><span 
class="Cabin-Regular-tlf-t1-">Please do not try to create a spam service in your AWS account.</span></p></aside> 
<aside role="doc-footnote" class="footnotetext">
<!--l. 80--><p class="noindent" ><a 
 id="x1-6002x2.1.3"></a><span class="footnote-mark"><a 
href="#fn2x0-bk" id="fn2x0"><sup class="textsuperscript">2</sup></a></span><a 
href="https://activemq.apache.org/" class="url" ><span 
class="ectt-1000">https://activemq.apache.org/</span></a></p></aside> 
<aside role="doc-footnote" class="footnotetext">
<!--l. 81--><p class="noindent" ><a 
 id="x1-6004x2.1.3"></a><span class="footnote-mark"><a 
href="#fn3x0-bk" id="fn3x0"><sup class="textsuperscript">3</sup></a></span><a 
href="https://www.rabbitmq.com/" class="url" ><span 
class="ectt-1000">https://www.rabbitmq.com/</span></a></p></aside> 
<aside role="doc-footnote" class="footnotetext">
<!--l. 93--><p class="noindent" ><a 
 id="x1-7002x2.1.4"></a><span class="footnote-mark"><a 
href="#fn4x0-bk" id="fn4x0"><sup class="textsuperscript">4</sup></a></span><a 
href="https://kafka.apache.org/" class="url" ><span 
class="ectt-1000">https://kafka.apache.org/</span></a></p></aside> 
<aside role="doc-footnote" class="footnotetext">
<!--l. 342--><p class="noindent" ><a 
 id="x1-13002x4"></a><span class="footnote-mark"><a 
href="#fn5x0-bk" id="fn5x0"><sup class="textsuperscript">5</sup></a></span><a 
href="https://docs.celeryq.dev/en/stable/" class="url" ><span 
class="ectt-1000">https://docs.celeryq.dev/en/stable/</span></a></p></aside> 
<aside role="doc-footnote" class="footnotetext">
<!--l. 343--><p class="noindent" ><a 
 id="x1-13004x4"></a><span class="footnote-mark"><a 
href="#fn6x0-bk" id="fn6x0"><sup class="textsuperscript">6</sup></a></span><a 
href="https://www.rabbitmq.com/tutorials/tutorial-one-java" class="url" ><span 
class="ectt-1000">https://www.rabbitmq.com/tutorials/tutorial-one-java</span></a></p></aside> 
 <aside role="doc-footnote" class="footnotetext">
<!--l. 361--><p class="noindent" ><a 
 id="x1-15002x5"></a><span class="footnote-mark"><a 
href="#fn7x0-bk" id="fn7x0"><sup class="textsuperscript">7</sup></a></span><span 
class="Cabin-Regular-tlf-t1-">In reality it is not, but this is an example of a common use case for asynchronous tasks &#8212; file generation such as PDFs or videos</span>
<span 
class="Cabin-Regular-tlf-t1-">which do take time.</span></p></aside> 
<aside role="doc-footnote" class="footnotetext">
<!--l. 377--><p class="noindent" ><a 
 id="x1-16003x5.1"></a><span class="footnote-mark"><a 
href="#fn8x0-bk" id="fn8x0"><sup class="textsuperscript">8</sup></a></span><span 
class="Cabin-Regular-tlf-t1-">Ideally a POST procedural endpoint should use a verb like </span><span 
class="ectt-1000">/generate</span><span 
class="Cabin-Regular-tlf-t1-">.</span></p></aside> 
                                                                                                </div>
 
</body></html> 

                                                                                                    


